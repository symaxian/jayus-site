<p>
	In the canvas below some primitive shapes are controlled by an instance of the Box2D physics engine.
	<br>
	By checking the "Show geometry" checkbox below you can see the geometry associated with each entity.
</p>
<div id="jayus"></div>
<p>
	<p>
		<label><input type="checkbox" id="toggleDebug"> Show geometry</label>
	</p>
	<dl class="dl-horizontal">
		<dt>Orange shape</dt>
		<dd>
			The bounds, this is the "physical" region taken up by the entity, and what is tested against for a cursor hit.
		</dd>
		<dt>Yellow rectangle</dt>
		<dd>
			The frame, this is the axis-aligned rectangle that encompasses the entity's bounds.
		</dd>
		<dt>Green rectangle</dt>
		<dd>
			The scope, this is the axis-aligned rectangle that encompasses every pixel modified by rendering the shape.
			<br>Most developers will not use this.
		</dd>
		<dt>Red dot</dt>
		<dd>
			The anchor point, this point is the global position of the entity the point at which the entity's transformations are anchored.
			<br>The anchor point is most often specified as a position relative to the frame, with (0,0) being at the top-left, and (1,1) at the bottom-right.
		</dd>
	</dl>
</p>

<script type='text/javascript'>

			// Initialize jayus
			jayus.init();

			// Create and set the display
			display = new jayus.Display(600,400);
			display.setInto(document.getElementById('jayus'))

			// Create some aliases for Box2D modules
			b2Vec2 = Box2D.Common.Math.b2Vec2;
			b2AABB = Box2D.Collision.b2AABB;
			b2BodyDef = Box2D.Dynamics.b2BodyDef;
			b2Body = Box2D.Dynamics.b2Body;
			b2FixtureDef = Box2D.Dynamics.b2FixtureDef;
			b2Fixture = Box2D.Dynamics.b2Fixture;
			b2World = Box2D.Dynamics.b2World;
			b2MassData = Box2D.Collision.Shapes.b2MassData;
			b2PolygonShape = Box2D.Collision.Shapes.b2PolygonShape;
			b2CircleShape = Box2D.Collision.Shapes.b2CircleShape;
			b2DebugDraw = Box2D.Dynamics.b2DebugDraw;
			b2MouseJointDef =  Box2D.Dynamics.Joints.b2MouseJointDef;

			// Create a Box2D world with some gravity
			world = new b2World(new b2Vec2(0,40),true);
			// And set it on the display
			display.setWorld(world);

			// Create a surface for Box2D to draw debug info onto
			var b2DebugSurface = new jayus.Surface(display.getWidth(),display.getHeight());
			// Add the Box2D debug surface onto the display
			display.addChild(b2DebugSurface);

			// Create and configure the Box2D debugDraw object
			var debugDraw = new b2DebugDraw();
			debugDraw.SetSprite(b2DebugSurface.getContext());
			debugDraw.SetDrawScale(1.0);
			debugDraw.SetFillAlpha(0.5);
			debugDraw.SetLineThickness(1.0);
			debugDraw.SetFlags(b2DebugDraw.e_shapeBit | b2DebugDraw.e_jointBit);
			world.SetDebugDraw(debugDraw);

			var fixDef = new b2FixtureDef;
			fixDef.density = 1.0;
			fixDef.friction = 0.5;
			fixDef.restitution = 0.5;
			
			var bodyDef = new b2BodyDef;
			
			// A

			var w = display.w,
				h = display.h;

			// Use a static polygon body
			bodyDef.type = b2Body.b2_staticBody;
			fixDef.shape = new b2PolygonShape;
			// The top/botom walls
			fixDef.shape.SetAsBox(w, 2);
			bodyDef.position.Set(0, 0);
			world.CreateBody(bodyDef).CreateFixture(fixDef);
			bodyDef.position.Set(0, h);
			world.CreateBody(bodyDef).CreateFixture(fixDef);
			// The left/right walls
			fixDef.shape.SetAsBox(2, h);
			bodyDef.position.Set(0, 0);
			world.CreateBody(bodyDef).CreateFixture(fixDef);
			bodyDef.position.Set(w, 0);
			world.CreateBody(bodyDef).CreateFixture(fixDef);


			//create some objects
			bodyDef.type = b2Body.b2_dynamicBody;

			// Create items to move around the display

			items = [];

			items.push(text = new jayus.Text('Hello!',60).style({ stroke: 'black' }).setId('text'));
			text.move(20,20);

			fixDef.shape = new b2PolygonShape;
			var scale = 0.5;
			fixDef.shape.SetAsBox(text.getWidth()*scale,text.getHeight()*scale);
			bodyDef.position.x = text.getX()*scale;
			bodyDef.position.y = text.getY()*scale;
			X = world.CreateBody(bodyDef);
			X.CreateFixture(fixDef);

			text.setBody(X);



			box1 = new jayus.StyledShape(new jayus.Rectangle(0,0,80,60),{ stroke: 'blue' });
			items.push(box1);
			box1.move(100,100);

			fixDef.shape = new b2PolygonShape;
			var scale = 0.5;
			fixDef.shape.SetAsBox(box1.getWidth()*scale,box1.getHeight()*scale);
			bodyDef.position.x = box1.getX()*scale;
			bodyDef.position.y = box1.getY()*scale;
			X = world.CreateBody(bodyDef);
			X.CreateFixture(fixDef);

			box1.setBody(X);




			display.addChild.apply(display,items);



			for(var i=0;i<items.length;i++){

				items[i].debugRenderer = jayus.debug.defaultDebugRenderer;

				items[i].handle({

					cursorEnter: function(){
						if(this.id === 'text'){
							this.style({ lineWidth: 2 })
						}
						else if(this.id === 'star'){
							this.style({ lineWidth: 3 });
						}
					},

					cursorMove: function(e){
						if(this.dragging){
							this.move(e.deltaX, e.deltaY);
						}
					},

					cursorLeave: function(e){
						if(this.id === 'text' || this.id === 'star'){
							this.style({ lineWidth: 1 });
						}
						else if(this.id === 'buttonBg'){
							this.style({ lineWidth: 1 });
						}
					},

					scroll: function(e){
						if(e.deltaY < 0){
							this.scale(1.2);
						}
						else if(e.deltaY > 0){
							this.scale(0.8);
						}
						return true;
					},

					leftPress: function(){
						this.dragging = true;
						if(this.id === 'text' || this.id === 'star'){
							this.style({ fill: 'yellow' });
						}
						jayus.interceptNextEvent('leftRelease',function(){
							this.dragging = false;
							if(this.id === 'text' || this.id === 'star'){
								this.style({ fill: undefined });
							}
						},{ context: this });
						return true;
					},

					rightPress: function(){
						return true;
					},

					middlePress: function(){
						this.setAnchorAt(jayus.cursor.x-this.getLeft(),jayus.cursor.y-this.getTop());
						return true;
					}

				});
			}

			jayus.handle({

				cursorMove: function(e){
					// Check if were rotating an entity
					if(rotatingEntity !== null){
						var diff = new jayus.Vec2(jayus.cursor.y-rotatingEntity.getY(),jayus.cursor.x-rotatingEntity.getX());
						var rot = Math.atan2(diff.x,diff.y);
						rotatingEntity.setRotation(rotatingEntity.startRotation+rotatingEntity.startCursorRotation+rot);
					}
				}

			});

			jayus.start();

</script>