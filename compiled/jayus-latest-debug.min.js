function overloadArgumentCount(a,c){return overloadArgumentCount.verifySubFunctions?function(){if("function"===typeof a[arguments.length])return a[arguments.length].apply(this,arguments);if("string"===typeof c)throw new TypeError('Overloaded function "'+c+'" has no sub-function available for argument count: '+arguments.length);throw new TypeError("Overloaded function has no sub-function available for argument count: "+arguments.length);}:function(){return a[arguments.length].apply(this,arguments)}}
function overloadArgumentType(a,c){return overloadArgumentType.verifySubFunctions?function(b){if("function"===typeof a[typeof b])return a[typeof b].apply(this,arguments);if("string"===typeof c)throw new TypeError('Overloaded function "'+c+'" has no sub-function available for argument type: '+typeof b);throw new TypeError("Overloaded function has no sub-function available for argument type: "+typeof b);}:function(b){return a[typeof b].apply(this,arguments)}}
overloadArgumentCount.verifySubFunctions=!0;overloadArgumentType.verifySubFunctions=!0;/*


 Copyright ? 2011 Jonathon Reesor

 This file is part of Jayus.

 Jayus is free software: you can redistribute it and/or modify
 it under the terms of the GNU General Public License as published by
 the Free Software Foundation, either version 3 of the License, or
 (at your option) any later version.

 Jayus is distributed in the hope that it will be useful,
 but WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 GNU General Public License for more details.

 You should have received a copy of the GNU General Public License
 along with Jayus.  If not, see <http://www.gnu.org/licenses/>.
*/
jayus={running:false,frameIntervalRunning:false,lastFrameTime:0,interval:null,useReqAnimFrame:true,framerate:60,displays:[],hasFocus:false,focusedDisplay:null,cursorFocus:null,animators:[],frameEventData:{},fontCache:{},fontCacheMaxChar:255,DIRTY:{VISIBILITY:1,POSITION:2,SIZE:4,TRANSFORMS:8,CONTENT:16,STYLE:32,BACKGROUND:16,FRAME:6,SCOPE:2+4+8,ALL:127},SHAPES:{LIST:-1,CUSTOM:0,POINT:1,CIRCLE:2,RECTANGLE:4,POLYGON:8,PATH:16},intersectTest:function jayus_intersectTest(a,b){var i,temp,ctx,ret,at=a.shapeType,
bt=b.shapeType;while(!at){if(a.getBounds()===a)throw new Error("jayus.intersectTest() - a.getBounds() === a, indefinite loop would result");a=a.getBounds();at=a.shapeType}while(!bt){if(b.getBounds()===b)throw new Error("jayus.intersectTest() - b.getBounds() === b, indefinite loop would result");b=b.getBounds();bt=b.shapeType}if(at===-1){for(i=0;i<a.items.length;i++)if(this.intersectTest(a[i],b))return true;return false}if(bt===-1){for(i=0;i<b.items.length;i++)if(this.intersectTest(a,b[i]))return true;
return false}if(at>bt){temp=a;a=b;b=temp}switch(a.shapeType+b.shapeType){case 1+1:return a.x===b.x&&a.y===b.y;case 1+2:return b.intersectsAt(a.x,a.y);case 2+2:return(a.x-b.x)*(a.x-b.x)+(a.y-b.y)*(a.y-b.y)<=(a.radius+b.radius)*(a.radius+b.radius);case 1+4:return b.intersectsAt(a.x,a.y);case 2+4:var x=Math.abs(a.x-(b.x+b.width/2)),y=Math.abs(a.y-(b.y+b.height/2));if(x>b.width/2+a.radius)return false;if(y>b.height/2+a.radius)return false;if(x<=b.width/2)return true;if(y<=b.height/2)return true;return(x-
b.width/2)*(x-b.width/2)+(y-b.height/2)*(y-b.height/2)<=a.radius*a.radius;case 4+4:return!(a.x+a.width<b.x||a.y+a.height<b.y||a.x>b.x+b.width||a.y>b.y+b.height);case 1+8:return b.intersectsAt(a.x,a.y);case 2+8:throw new Error("TODO: Circle intersects Polygon");case 4+8:throw new Error("TODO: Rectangle intersects Polygon");case 1+8:throw new Error("TODO: Polygon intersects Polygon");case 1+16:return b.intersectsAt(a.x,a.y);case 2+16:throw new Error("TODO: Circle intersects Path");case 4+16:throw new Error("TODO: Rectangle intersects Path");
case 8+16:throw new Error("TODO: Polygon intersects Path");case 16+16:throw new Error("TODO: Circle intersects Path");}},distance:function Point_distance(a,b){this.debug.matchArguments("jayus.distance",arguments,"a",13,"b",13);var x=a.x-b.x,y=a.y-b.y;return Math.sqrt(x*x+y*y)},copyObject:function jayus_copyObject(src){this.debug.match("jayus.copyObject",src,"src",5);return this.applyObject(src,{})},applyObject:function jayus_applyObject(src,dest){this.debug.matchArguments("jayus.applyObject",arguments,
"src",5,"dest",5);for(var item in src)if(src.hasOwnProperty(item))dest[item]=src[item];return dest},createClass:function jayus_createClass(props){var constructor=function(){this.init.apply(this,arguments)};if(typeof jayus.debug.className==="string")constructor=eval("(function "+jayus.debug.className+"(){this.init.apply(this,arguments);})");jayus.debug.className=null;constructor.prototype=props;if(typeof constructor.prototype.init!=="function")constructor.prototype.init=function(){};constructor.init=
function HelperInit(object,args){constructor.prototype.init.apply(object,args)};constructor.extend=jayus.extendMethod;return constructor},extendMethod:function jayus_extendMethod(props){var constructor=function(){this.init.apply(this,arguments)};if(typeof jayus.debug.className==="string")constructor=eval("(function "+jayus.debug.className+"(){this.init.apply(this,arguments);})");jayus.debug.className=null;constructor.prototype=Object.create(this.prototype);jayus.applyObject(props,constructor.prototype);
if(typeof constructor.prototype.init!=="function")constructor.prototype.init=function(){};constructor.init=function HelperInit(object,args){constructor.prototype.init.apply(object,args)};constructor.extend=jayus.extendMethod;return constructor},init:function jayus_init(){var elem=document.createElement("canvas");if(!(typeof elem.getContext==="function"&&typeof elem.getContext("2d")==="object"))throw new Error("Fatal error, browser does not support the canvas element, unable to initiate Jayus");this.applyObject(this.Responder.prototype,
this);this.addDefaultHandlers();this.ua=this.detectBrowser();this.ua.lineDash=typeof this.getContext().setLineDash==="function";window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame;this.ua.requestAnimationFrame=typeof window.requestAnimationFrame==="function";this.keyboard.init();this.colors.cssNames=[];for(var i=0;i<this.colors.displayNames.length;i++)this.colors.cssNames.push(this.colors.displayNames[i].replace(" ",
"").replace(" ","").toLowerCase());this.initialized=true},detectBrowser:function jayus_detectBrowser(){var dataBrowser=[{src:navigator.userAgent,str:"Chrome",id:"Chrome"},{src:navigator.userAgent,str:"OmniWeb",ver:"OmniWeb/",id:"OmniWeb"},{src:navigator.vendor,str:"Apple",id:"Safari",ver:"Version"},{prop:window.opera,id:"Opera",ver:"Version"},{src:navigator.vendor,str:"iCab",id:"iCab"},{src:navigator.vendor,str:"KDE",id:"Konqueror"},{src:navigator.userAgent,str:"Firefox",id:"Firefox"},{src:navigator.vendor,
str:"Camino",id:"Camino"},{src:navigator.userAgent,str:"Netscape",id:"Netscape"},{src:navigator.userAgent,str:"MSIE",id:"Explorer",ver:"MSIE"},{src:navigator.userAgent,str:"Gecko",id:"Mozilla",ver:"rv"},{src:navigator.userAgent,str:"Mozilla",id:"Netscape",ver:"Mozilla"}];var dataOS=[{src:navigator.platform,str:"Win",id:"Windows"},{src:navigator.platform,str:"Mac",id:"Mac"},{src:navigator.userAgent,str:"iPhone",id:"iPhone/iPod"},{src:navigator.platform,str:"Linux",id:"Linux"}];var verString;var searchString=
function(data){for(var i=0;i<data.length;i++){var dataString=data[i].src;var dataProp=data[i].prop;verString=data[i].ver||data[i].id;if(dataString){if(dataString.indexOf(data[i].str)!==-1)return data[i].id}else if(dataProp)return data[i].id}};var searchVersion=function(dataString){var index=dataString.indexOf(verString);if(index!==-1)return parseFloat(dataString.substring(index+verString.length+1))};return{browser:searchString(dataBrowser)||null,version:searchVersion(navigator.userAgent)||searchVersion(navigator.appVersion)||
null,OS:searchString(dataOS)||null}},start:function jayus_start(){if(this.initialized)if(!this.running){this.running=true;if(!this.useReqAnimFrame||!this.ua.requestAnimationFrame)this.interval=setInterval(jayus.step,1E3/this.framerate);if(!this.frameIntervalRunning){this.lastFrameTime=Date.now();this.frameIntervalRunning=true;this.step()}}else console.warn("jayus.start() - Jayus is already running");else console.warn("jayus.start() - Jayus is not initialized")},stop:function jayus_stop(){if(this.running){this.running=
false;clearInterval(this.interval)}else console.warn("jayus.stop() - Called when not running")},step:function jayus_step(){if(jayus.running){if(jayus.useReqAnimFrame&&jayus.ua.requestAnimationFrame)window.requestAnimationFrame(jayus.step);var i,item,now=Date.now(),elapsedMilliSecs=now-jayus.lastFrameTime,elapsedSecs=elapsedMilliSecs/1E3;jayus.fps=1E3/elapsedMilliSecs;jayus.lastFrameTime=now;jayus.frameEventData.elapsed=elapsedSecs;if(!jayus.isHandler.frame||!jayus.fire("frame",jayus.frameEventData)){jayus.chart.begin("cursor");
for(i=0;i<jayus.displays.length;i++){item=jayus.displays[i];if(item.hasPendingMousemoveEvent){item.processPendingMousemove();item.hasPendingMousemoveEvent=false}}jayus.chart.end();jayus.chart.begin("animation");for(i=0;i<jayus.animators.length;i++)jayus.animators[i].tick(now,elapsedSecs);jayus.chart.end();if(jayus.box2d.enabled)jayus.box2d.step(elapsedSecs);jayus.chart.begin("render");for(i=0;i<jayus.displays.length;i++){item=jayus.displays[i];if(item.dirtied)item.refreshBuffer()}if(jayus.box2d.enabled)jayus.box2d.drawDebug();
jayus.chart.end();jayus.chart.update()}}else jayus.frameIntervalRunning=false},addDefaultHandlers:function jayus_addDefaultHandlers(){jayus.addHandler("keyPress",function(e){if(e.key==="grave"&&e.event.ctrlKey){if(jayus.chart.isVisible())jayus.chart.hide();else jayus.chart.show();return true}});jayus.addHandler("keyPress",function(e){if(e.key==="backslash"){lol=Cel.wrappers[0].exportChart();document.body.appendChild(lol);return true}})},chart:{routines:{render:{description:"Rendering",time:0,color:"saddlebrown"},
box2d:{description:"Box2D updating",time:0,color:"blue"},animation:{description:"Animation",time:0,color:"orange"},cursor:{description:"Cursor events",time:0,color:"Chartreuse"}},routineNameStack:[],routineTimeStack:[],routineInitStack:[],markColor:"grey",markFont:"10px sans-serif",display:null,graphSurface:null,topMS:40,index:0,width:500,height:380,visible:false,initialized:false,windowSize:120,windowIndex:0,barHeight:20,barSpacing:10,routineData:{},getRoutineColor:function jayus_chart_getRoutineColor(name){switch(name){case "render":return"saddlebrown";
case "box2d":return"blue";case "cursor":return"Chartreuse";case "animation":return"orange"}return"white"},begin:function jayus_chart_begin(routine){this.routineNameStack.push(routine);this.routineTimeStack.push(Date.now());this.routineInitStack.push(0)},end:function jayus_chart_end(){var time=Date.now()-this.routineTimeStack.pop(),name=this.routineNameStack.pop(),inits=this.routineInitStack.pop(),data,i;if(typeof this.routines[name]!=="object")this.routines[name]={description:"",time:0,color:"red"};
if(this.initialized){data=this.routineData[name];if(data===undefined){data={visible:true,latencies:[],averageLatency:0,inits:[],initTotal:0,color:this.getRoutineColor(name),bar:new jayus.Scene(0,this.barHeight),label:new jayus.Text(name[0].toUpperCase()+name.slice(1),"16px sans-serif",{fill:"black"}),tag:new jayus.Text("","12px sans-serif",{fill:"black"})};data.bar.setBg({fill:data.color});for(i=0;i<this.windowSize;i++){data.latencies.push(0);data.inits.push(0)}this.routineData[name]=data;this.graph2.children.add(data.bar,
data.label,data.tag)}data.time+=time;data.latencyTotal-=data.latencies[this.windowIndex];data.latencies[this.windowIndex]=time;data.inits+=inits}this.routines[name].time+=time},tallyInit:function jayus_chart_tallyInit(type){this.routineInitStack[this.routineInitStack.length-1]++},isVisible:function jayus_chart_isVisible(){return this.initialized&&this.display.visible},show:function jayus_chart_show(){if(!this.initialized){this.vBox=new jayus.vBox;this.vBox.setOrigin(2,0).setSize(this.width,this.height);
this.topLabel=new jayus.Text("","13px sans-serif",{fill:"#DDD"});this.graph=new jayus.Scene;this.graph.setOptimizedBuffering(false);this.graph2=(new jayus.Scene).setBg({fill:"dimgrey"});this.graph2.setOptimizedBuffering(false);this.vBox.children.add(this.topLabel,this.graph,this.graph2);this.graphSurface=new jayus.Surface(this.graph.width,this.graph.height);this.graph.children.add(this.graphSurface);this.graph.addHandler("resized",function(){var addLabel=function(ms){var y=jayus.chart.graph.height-
ms/jayus.chart.topMS*jayus.chart.graph.height,line=new jayus.PaintedShape(new jayus.Polygon.Line(0,Math.floor(y)+0.5,jayus.chart.graph.width,Math.floor(y)+0.5),{stroke:"dimgrey"}),text=(new jayus.Text(ms+" ms","10px sans-serif",{fill:"dimgrey"})).setOrigin(4,y-12);jayus.chart.graph.children.update(ms+"line",line.setId(ms+"line")).update(ms+"text",text.setId(ms+"text"))};addLabel(16);addLabel(33);jayus.chart.graphSurface.setHeight(this.height)});this.graph.fire("resized");this.display=new jayus.Display(this.width,
this.height);this.display.children.add(this.vBox);var canvas=this.display.canvas,beingMoved=false,startX,startY;canvas.onmousemove=function(e){if(beingMoved){canvas.style.left=e.pageX-startX+"px";canvas.style.top=e.pageY-startY+"px"}};canvas.onmousedown=function(e){beingMoved=true;startX=e.layerX;startY=e.layerY};canvas.onmouseup=function(){beingMoved=false};canvas.style.position="absolute";canvas.style.border="#aaa 1px solid";canvas.style.backgroundColor="black";this.display.setCursor("move");document.body.appendChild(canvas);
canvas.style.left="50px";canvas.style.top="50px";this.initialized=true}this.display.show()},hide:function jayus_chart_hide(){if(this.initialized){this.display.hide();this.graphSurface.clear();this.index=0}},mark:function jayus_chart_mark(text){if(this.isVisible()){var ctx=this.graphSurface.context,metrics=jayus.measureText(text,this.markFont);ctx.fillStyle=this.markColor;ctx.fillRect(this.index,0,1,this.graph.height-0.5);ctx.fillText(text,this.index-metrics.width-2,metrics.ascent)}},order:["render",
"box2d","animation","cursor"],update:function jayus_chart_update(){if(this.isVisible()){var ctx=this.graphSurface.context,y=this.graphSurface.height,i,routine,data,width,height;if(this.routineData.render.time===0)this.routineData.render.time=1;var labelColumnWidth=0;var totalLatency=0;var routineNames=[];for(routine in this.routineData){data=this.routineData[routine];routineNames.push(routine);data.averageLatency=jayus.math.average(data.latencies);totalLatency+=data.averageLatency;width=data.label.width;
if(width>labelColumnWidth)labelColumnWidth=width;data.visible=data.averageLatency>0}labelColumnWidth+=10;routineNames.sort(function(a,b){return jayus.chart.routineData[a].averageLatency<jayus.chart.routineData[b].averageLatency});for(i=0;i<routineNames.length;i++){data=this.routineData[routineNames[i]];height=Math.floor(data.time/this.topMS*this.graph.height);ctx.fillStyle=data.color;ctx.fillRect(this.index,y-height,1,height-0.5);y-=height;data.time=0;data.inits=0}ctx.clearRect(this.index+1,0,2,this.graph.height);
this.index++;if(this.index===this.graph.width)this.index=-1;this.topLabel.setText("Framerate: "+(jayus.fps+"").substr(0,4));for(i=0;i<routineNames.length;i++){data=this.routineData[routineNames[i]];var bar=data.bar;var offset=10+i*(this.barSpacing+this.barHeight);if(data.visible){bar.setOrigin(labelColumnWidth,offset);bar.setWidth(data.averageLatency/totalLatency*(this.graph2.width-labelColumnWidth));data.label.setOrigin(5,bar.y+bar.height/2-data.label.height/2);data.tag.setText(Math.round(data.averageLatency)+
" ms");data.tag.setOrigin(bar.x+bar.width-data.tag.width-10,bar.y+bar.height/2-data.tag.height/2);bar.show();data.label.show();data.tag.show()}else{bar.hide();data.label.hide();data.tag.hide()}}this.windowIndex++;if(this.windowIndex===this.windowSize)this.windowIndex=0;this.graphSurface.dirty(jayus.DIRTY.ALL);this.display.refreshBuffer()}}},getFontDescriptor:function jayus_getFontDescriptor(font){this.debug.match("jayus.getFontDescriptor",font,"font",2);if(!this.isFontCached(font))this.cacheFont(font);
return this.fontCache[font]},cacheFont:function jayus_cacheFont(font){this.debug.match("jayus.cacheFont",font,"font",2);var i,ctx,charWidths,descriptor;if(!this.isFontCached(font)){charWidths=[];ctx=this.getContext();ctx.save();ctx.font=font;for(i=0;i<this.fontCacheMaxChar+1;i++)charWidths[i]=ctx.measureText(String.fromCharCode(i)).width;ctx.restore();descriptor=this.getVerticalFontMetrics(font);descriptor.charWidths=charWidths;this.fontCache[font]=descriptor}},cacheFonts:function jayus_cacheFonts(fonts){this.debug.matchArray("jayus.cacheFonts",
fonts,"fonts",2);for(var i=0;i<fonts.length;i++)this.cacheFont(fonts[i])},isFontCached:function jayus_isFontCached(font){this.debug.match("jayus.isFontCached",font,"font",2);return typeof this.fontCache[font]==="object"},measureText:function jayus_measureText(text,font){return this.measureTextOnto(text,font,{})},measureTextOnto:function jayus_measureTextOnto(text,font,ret){this.debug.matchArguments("jayus.measureTextOnto",arguments,"text",2,"font",2,"ret",5);this.cacheFont(font);var descriptor=jayus.fontCache[font],
charWidths=descriptor.charWidths,i,width=0;for(i=0;i<text.length;i++)width+=charWidths[text.charCodeAt(i)];ret.width=width;ret.ascent=descriptor.ascent;ret.descent=descriptor.descent;ret.height=descriptor.height;return ret},getVerticalFontMetrics:function jayus_getVerticalFontMetrics(font){var result={},text=document.createElement("span"),block=document.createElement("div"),div=document.createElement("div");text.style.font=font;text.innerText="Hg";block.style.display="inline-block";block.style.width=
"1px";block.style.height="0";div.appendChild(text);div.appendChild(block);document.body.appendChild(div);try{block.style.verticalAlign="baseline";result.ascent=block.offsetTop-text.offsetTop;block.style.verticalAlign="bottom";result.height=block.offsetTop-text.offsetTop;result.descent=result.height-result.ascent}finally{document.body.removeChild(div)}return result},box2d:{enabled:true,scale:0.5,worlds:[],velocityIterations:10,positionIterations:10,physicalEntities:[],addWorld:function jayus_box2d_addWorld(world){jayus.debug.match("jayus.box2d.addWorld",
world,"world",5);this.worlds.push(world)},removeWorld:function jayus_box2d_removeWorld(world){this.worlds.splice(this.worlds.indexOf(this.world),1)},step:function jayus_box2d_step(elapsedSecs){jayus.chart.begin("box2d");var i,world;for(i=0;i<this.worlds.length;i++){world=this.worlds[i];world.Step(elapsedSecs,this.velocityIterations,this.positionIterations);world.ClearForces()}for(i=0;i<this.physicalEntities.length;i++)this.physicalEntities[i].updateFromBody();jayus.chart.end()},drawDebug:function jayus_box2d_drawDebug(){for(var i=
0;i<this.worlds.length;i++)this.worlds[i].DrawDebugData()}},getContext:function jayus_getContext(){if(this.displays.length)return this.displays[0].context;return document.createElement("canvas").getContext("2d")},TYPES:{DEFINED:0,BOOLEAN:1,STRING:2,FUNCTION:3,NUMBER:4,OBJECT:5,ARRAY:6,CONTEXT:7,COLOR:8,BRUSH:9,MATRIX:10,LIST:11,ENTITY:12,POINT:13,CIRCLE:14,POLYGON:15,PATH:16,SURFACE:17,SCENE:18,SHAPE:19,RECTANGLE:20,BUFFER:21,ANIMATOR:22,CANVAS:23},debug:{pauseOnEscape:true,types:["undefined","boolean",
"string","function","number","object","array","Context","Color","Brush","Matrix","List","Entity","Point","Circle","Polygon","Path","Surface","Scene","Shape","Rectangle","Buffer","Animator","Canvas"],is:function jayus_debug_is(type,v){switch(type){case 0:return typeof v!=="undefined";case 1:return typeof v==="boolean";case 2:return typeof v==="string";case 3:return typeof v==="function";case 4:return typeof v==="number"&&isFinite(v);case 5:return typeof v==="object"&&v!==null;case 6:return v instanceof
Array;case 7:return v instanceof CanvasRenderingContext2D;case 9:return typeof v==="object";case 8:case 10:case 11:case 12:case 13:case 14:case 15:case 16:case 17:case 18:return typeof v==="object"&&v instanceof jayus[jayus.debug.types[type]];case 19:return this.is(13,v)||this.is(20,v)||this.is(14,v)||this.is(15,v)||this.is(16,v);case 20:return v instanceof jayus.Rectangle||v.isRect;case 21:if(typeof ImageData==="function")return v instanceof ImageData;return this.is(5,v)&&this.is(4,v.width)&&this.is(4,
v.height)&&this.is(6,v.data);case 22:return!!v.isAnimator;case 23:return v instanceof HTMLCanvasElement}throw new Error("jayus.debug.is() - Unknown type("+jayus.debug.types[type]+") specified");},match:function jayus_debug_match(method,value,name,type){if(!this.is(type,value))throw new TypeError(method+"() - Invalid parameter "+name+this.toString(value)+" sent, "+jayus.debug.types[type]+" required");},matchOptional:function jayus_debug_matchOptional(method,value,name,type){if(typeof value!=="undefined"&&
!this.is(type,value))throw new TypeError(method+"() - Invalid optional parameter "+name+this.toString(value)+" sent, "+jayus.debug.types[type]+" required");},matchArray:function jayus_debug_matchArray(method,value,name,type){if(!this.is(6,value))throw new TypeError(method+"() - Invalid parameter "+name+this.toString(value)+" sent, Array of "+jayus.debug.types[type]+" required");for(var i=0;i<value.length;i++)if(!this.is(type,value[i]))throw new TypeError(method+"() - Invalid parameter "+name+this.toString(value)+
" array sent, element at "+i+"("+value[i]+") is required to be "+jayus.debug.types[type]);},matchArguments:function jayus_debug_matchArguments(name,args){var i,paramName,argValue,paramType;for(i=2;i<arguments.length;i+=2){argValue=args[i/2-1];paramName=arguments[i];paramType=arguments[i+1];if(!this.is(paramType,argValue))throw new TypeError(name+"() - Invalid "+paramName+this.toString(argValue)+" sent, "+jayus.debug.types[paramType]+" required");}},matchArgumentsAs:function jayus_debug_matchArgumentsAs(name,
args,type){var i,paramName,argValue;for(i=3;i<arguments.length;i++){argValue=args[i-3];paramName=arguments[i];if(!this.is(type,argValue))throw new TypeError(name+"() - Invalid "+paramName+this.toString(argValue)+" sent, "+jayus.debug.types[type]+" required");}},matchContext:function jayus_debug_matchContext(method,value){if(!this.is(7,value))throw new TypeError(method+"() - Invalid parameter ctx"+this.toString(value)+" sent, Context required");},matchCoordinate:function jayus_debug_matchCoordinate(method,
x,y){if(!this.is(13,x)&&!this.is(4,x))throw new TypeError(method+"() - Invalid parameter x"+this.toString(x)+" sent, Point or Number required");if(this.is(4,x)&&!this.is(4,y))throw new TypeError(method+"() - Invalid parameter y"+this.toString(y)+" sent, Number required");},matchSize:function jayus_debug_matchSize(method,x,y){if(!this.is(12,x)&&!this.is(4,x))throw new TypeError(method+"() - Invalid parameter width"+this.toString(x)+" sent, Entity or Number required");if(this.is(4,x)&&!this.is(4,y))throw new TypeError(method+
"() - Invalid parameter height"+this.toString(y)+" sent, Number required");},matchRectangle:function jayus_debug_matchRectangle(method,a,b,c,d){switch(arguments.length){case 3:return jayus.debug.matchArguments(method,[a,b],"origin",13,"entity",12);case 4:return jayus.debug.matchArguments(method,[a,b,c],"origin",13,"width",4,"height",4);case 5:return jayus.debug.matchArgumentsAs(method,[a,b,c,d],4,"x","y","width","height")}throw new TypeError(method+"() - Invalid number of arguments sent, 2, 3, or 4 required");
},verifyMethod:function jayus_debug_verifyMethod(object,method){this.matchArguments("jayus.debug.verifyMethod",arguments,"object",5,"method",2);if(!this.is(3,object[method])){console.log(object);throw new TypeError("jayus.debug.verifyMethod() - Object"+this.toString(object)+" does not have method "+method);}},toString:function jayus_debug_toString(v){switch(typeof v){case "undefined":return"(Undefined)";case "boolean":return"(Boolean:"+v+")";case "number":return"(Number:"+v+")";case "string":return'(String:"'+
v+'")';case "object":if(v===null)return"(null)";if(v instanceof Array)return"(Array:["+v+"])";if(typeof v.toString==="function")return v.toString();return"(Object:"+v+")";case "function":return"(Function:"+v+")"}return"(Unknown)"},exposedOriginColor:"blue",exposedBoundsColor:"red",exposedScopeColor:"green",exposedFrameColor:"orange",exposedTransformedDashing:[5,5],defaultDebugRenderer:function jayus_debug_defaultDebugRenderer(ctx){var item;ctx.save();ctx.lineWidth=1;if(this.shapeType===0){item=this.getBounds().alignToCanvas();
item.etchOntoContext(ctx);ctx.strokeStyle=jayus.debug.exposedBoundsColor;ctx.stroke()}ctx.strokeStyle=jayus.debug.exposedScopeColor;item=this.getScope().alignToCanvas();ctx.strokeRect(item.x,item.y,item.width,item.height);if(this.isRect){item=this.getFrame().alignToCanvas();item.etchOntoContext(ctx);ctx.strokeStyle=jayus.debug.exposedFrameColor;ctx.stroke();if(this.isTransformed){ctx.setLineDash(jayus.debug.exposedTransformedDashing);item=this.getUnFrame().alignToCanvas();ctx.strokeRect(item.x,item.y,
item.width,item.height)}}ctx.restore()},showPoint:function jayus_debug_showPoint(display,x,y,duration){if(arguments.length===3)duration=1E3;var spec=new jayus.Scene(3,3);spec.setBg({fill:"red"});spec.setOrigin(x,y);spec.animate().setAlpha(0).setDuration(duration).addHandler("finished",function(){display.children.remove(spec)}).start();display.children.add(spec)},pause:function jayus_debug_pause(){var i,display,ctx;if(jayus.running){jayus.stop();for(i=0;i<jayus.displays.length;i++){display=jayus.displays[i];
ctx=display.context;ctx.save();ctx.setTransform(1,0,0,1,0,0);ctx.fillStyle="rgba(0, 0, 0, 0.5)";ctx.fillRect(0,0,display.width,display.height);ctx.fillStyle="white";ctx.font="24px sans-serif";ctx.textAlign="center";ctx.fillText("Paused",display.width/2,display.height/2);ctx.restore()}}else{for(i=0;i<jayus.displays.length;i++)jayus.displays[i].fullyRefreshBuffer();jayus.start()}}},math:{randomFrom:function jayus_math_randomFrom(array){jayus.debug.match("jayus.math.randomFrom",array,"array",6);if(!array.length)throw new RangeError("jayus.math.randomFrom() - Invalid array"+
jayus.debug.toString(array)+" sent, array or at least length 1 required");return array[this.randomBetween(0,array.length-1)]},randomBetween:function jayus_util_randomBetween(min,max){jayus.debug.matchArgumentsAs("jayus.math.randomBetween",arguments,4,"min","max");return min+Math.floor((max-min+1)*Math.random())},clamp:function jayus_math_clamp(min,num,max){jayus.debug.matchArgumentsAs("jayus.math.clamp",arguments,4,"min","num","max");if(num<min)return min;if(num>max)return max;return num},min:function jayus_math_min(numbers){jayus.debug.matchArray("jayus.math.min",
numbers,"numbers",4);if(!numbers.length)throw new RangeError("jayus.math.min() - Invalid numbers sent"+jayus.debug.toString(numbers)+", length of at least 1 required");var i,value,min=numbers[0];for(i=1;i<numbers.length;i++){value=numbers[i];if(value<min)min=value}return min},max:function jayus_math_max(numbers){jayus.debug.matchArray("jayus.math.max",numbers,"numbers",4);if(!numbers.length)throw new RangeError("jayus.math.max() - Invalid numbers sent"+jayus.debug.toString(numbers)+", length of at least 1 required");
var i,value,max=numbers[0];for(i=1;i<numbers.length;i++){value=numbers[i];if(value>max)max=value}return max},average:function jayus_math_average(numbers){jayus.debug.matchArray("jayus.math.average",numbers,"numbers",4);if(!numbers.length)throw new RangeError("jayus.math.average() - Invalid numbers sent"+jayus.debug.toString(numbers)+", length of at least 1 required");var i,total=0;for(i=0;i<numbers.length;i++)total+=numbers[i];return total/numbers.length},toDegrees:function jayus_math_toDegrees(angle){return angle*
(180/Math.PI)},toRadians:function jayus_math_toRadians(angle){return angle*(Math.PI/180)},vFlipAngle:function jayus_math_vFlipAngle(angle){jayus.debug.match("jayus.math.vFlipAngle",angle,"angle",4);return 2*Math.PI-angle},hFlipAngle:function jayus_math_hFlipAngle(angle){jayus.debug.match("jayus.math.hFlipAngle",angle,"angle",4);angle=Math.PI-angle;if(angle<0)angle+=2*Math.PI;return angle},getCwAngleBetween:function jayus_math_getCwAngleBetween(angle1,angle2){jayus.debug.matchArgumentsAs("jayus.math.getCwAngleBetween",
arguments,4,"angle1","angle2");var distance=angle1-angle2;if(distance<0)distance+=2*Math.PI;return distance},getCcwAngleBetween:function jayus_math_getCcwAngleBetween(angle1,angle2){jayus.debug.matchArgumentsAs("jayus.math.getCcwAngleBetween",arguments,4,"angle1","angle2");var distance=angle2-angle1;if(distance<0)distance+=2*Math.PI;return distance}},colors:{displayNames:["Alice Blue","Antique White","Aqua","Aquamarine","Azure","Beige","Bisque","Black","Blanched Almond","Blue","Blue Violet","Brown",
"Burly Wood","Cadet Blue","Chartreuse","Chocolate","Coral","Cornflower Blue","Cornsilk","Crimson","Cyan","Dark Blue","Dark Cyan","Dark Goldenrod","Dark Grey","Dark Green","Dark Khaki","Dark Magenta","Dark Olive Green","Dark Orange","Dark Orchid","Dark Red","Dark Salmon","Dark Sea Green","Dark Slate Blue","Dark Slate Grey","Dark Turquoise","Dark Violet","Deep Pink","Deep Sky Blue","Dim Grey","Dodger Blue","Firebrick","Floral White","Forest Green","Fuchsia","Gainsboro","Ghost White","Gold","Goldenrod",
"Grey","Green","Green Yellow","Honeydew","Hot Pink","Indian Red","Indigo","Ivory","Khaki","Lavender","Lavender Blush","Lawn Green","Lemon Chiffon","Light Blue","Light Coral","Light Cyan","Light Goldenrod","Light Green","Light Grey","Light Pink","Light Salmon","Light Sea Green","Light Sky Blue","Light Slate Grey","Light Steel Blue","Light Yellow","Lime","Lime Green","Linen","Magenta","Maroon","Medium Aquamarine","Medium Blue","Medium Orchid","Medium Purple","Medium Sea Green","Medium Slate Blue","Medium Spring Green",
"Medium Turquoise","Medium Violet Red","Midnight Blue","Mint Cream","Misty Rose","Moccasin","Navajo White","Navy","Old Lace","Olive","Olive Drab","Orange","Orange Red","Orchid","Pale Goldenrod","Pale Green","Pale Turquoise","Pale Violet Red","Papaya Whip","Peach Puff","Peru","Pink","Plum","Powder Blue","Purple","Red","Rosy Brown","Royal Blue","Saddle Brown","Salmon","Sandy Brown","Sea Green","Seashell","Sienna","Silver","Sky Blue","Slate Blue","Slate Grey","Snow","Spring Green","Steel Blue","Tan",
"Teal","Thistle","Tomato","Turquoise","Violet","Wheat","White","White Smoke","Yellow","Yellow Green"],cssNames:null,redComponents:[240,250,0,127,240,245,255,0,255,0,138,165,222,95,127,210,255,100,255,220,0,0,0,184,169,0,189,139,85,255,153,139,233,143,72,47,0,148,255,0,105,30,178,255,34,255,220,248,255,218,127,0,173,240,255,205,75,255,240,230,255,124,255,173,240,224,250,144,211,255,255,32,135,119,176,255,0,50,250,255,127,102,0,186,147,60,123,0,72,199,25,245,255,255,255,0,253,128,107,255,255,218,238,
152,175,219,255,255,205,255,221,176,127,255,188,65,139,250,244,46,255,160,192,135,106,112,255,0,70,210,0,216,255,64,238,245,255,245,255,154],greenComponents:[248,235,255,255,255,245,228,0,235,0,43,42,184,158,255,105,127,149,248,20,255,0,139,134,169,100,183,0,107,140,50,0,150,188,61,79,206,0,20,191,105,144,34,250,139,0,220,248,215,165,127,127,255,255,105,92,0,255,230,230,240,252,250,216,128,255,250,238,211,182,160,178,206,136,196,255,255,205,240,0,0,205,0,85,112,179,104,250,209,21,25,255,228,228,222,
0,245,128,142,165,69,112,232,251,238,112,239,218,133,192,160,224,127,0,143,105,69,128,164,139,245,82,192,206,90,128,250,255,130,180,128,191,99,225,130,222,255,255,255,205],blueComponents:[255,215,255,212,255,220,196,0,205,255,226,42,135,160,0,30,80,237,220,60,255,139,139,11,169,0,107,139,47,0,204,0,122,143,139,79,209,211,147,255,105,255,34,240,34,255,220,255,0,32,127,127,47,240,180,92,130,240,140,250,245,0,205,230,128,255,210,144,211,193,122,170,250,153,222,224,0,50,230,255,127,170,205,211,219,113,
238,154,204,133,112,250,225,181,173,128,230,0,35,0,0,214,170,152,238,147,213,185,63,203,221,230,0,0,143,225,19,114,96,87,238,45,192,235,205,144,250,127,180,140,128,216,71,208,238,179,255,245,0,50]}};jayus.easing={linear:function jayus_easing_linear(t){return t},easeInQuad:function jayus_easing_easeInQuad(t){return t*t},easeOutQuad:function jayus_easing_easeOutQuad(t){return t*(2-t)},easeInOutQuad:function jayus_easing_easeInOutQuad(t){return((t/=0.5)<1?t*t:(1-t)*(t-3)+1)/2},easeInCubic:function jayus_easing_easeInCubic(t){return t*t*t},easeOutCubic:function jayus_easing_easeOutCubic(t){return--t*t*t+1},easeInOutCubic:function jayus_easing_easeInOutCubic(t){return(t/=0.5)<1?t*t*t/2:(t-=2)*t*t/
2+1},easeInQuart:function jayus_easing_easeInQuart(t){return t*t*t*t},easeOutQuart:function jayus_easing_easeOutQuart(t){return--t*t*t*-t+1},easeInOutQuart:function jayus_easing_easeInOutQuart(t){return(t/=0.5)<1?t*t*t*t/2:1-(t-=2)*t*t*t/2},easeInQuint:function jayus_easing_easeInQuint(t){return t*t*t*t*t},easeOutQuint:function jayus_easing_easeOutQuint(t){return--t*t*t*t*t+1},easeInOutQuint:function jayus_easing_easeInOutQuint(t){return(t/=0.5)<1?t*t*t*t*t/2:(t-=2)*t*t*t*t/2+1},easeInSine:function jayus_easing_easeInSine(t){return 1-
Math.cos(t*Math.PI/2)},easeOutSine:function jayus_easing_easeOutSine(t){return Math.sin(t*Math.PI/2)},easeInOutSine:function jayus_easing_easeInOutSine(t){return 0.5-Math.cos(t*Math.PI)/2},easeInExpo:function jayus_easing_easeInExpo(t){return(t>0)*Math.pow(2,10*t-10)},easeOutExpo:function jayus_easing_easeOutExpo(t){return 1-(t!==1)*Math.pow(2,-10*t)},easeInOutExpo:function jayus_easing_easeInOutExpo(t){if(!t||t===1)return t;return(t/=0.5)<1?Math.pow(2,10*t-10)/2:1-Math.pow(2,10-10*t)/2},easeInCirc:function jayus_easing_easeInCirc(t){return 1-
Math.sqrt(1-t*t)},easeOutCirc:function jayus_easing_easeOutCirc(t){return Math.sqrt(--t*-t+1)},easeInOutCirc:function jayus_easing_easeInOutCirc(t){if((t/=0.5)<1)return-(Math.sqrt(1-t*t)-1)/2;return(Math.sqrt(1-(t-=2)*t)+1)/2},easeInElastic:function jayus_easing_easeInElastic(t){if(!t||t===1)return t;var p=0.3,s=p/(2*Math.PI)*Math.PI/2;return-Math.pow(2,10*--t)*Math.sin((t-s)*2*Math.PI/p)},easeOutElastic:function jayus_easing_easeOutElastic(t){if(!t||t===1)return t;var p=0.3,s=p/(2*Math.PI)*Math.PI/
2;return Math.pow(2,-10*t)*Math.sin((t-s)*2*Math.PI/p)+1},easeInOutElastic:function jayus_easing_easeInOutElastic(t){if(!t||t===1)return t;var p=0.3*1.5,s=p/(2*Math.PI)*Math.PI/2;return(t/=0.5)<1?-Math.pow(2,10*--t)*Math.sin((t-s)*2*Math.PI/p)/2:Math.pow(2,-10*--t)*Math.sin((t-s)*2*Math.PI/p)/2+1},easeInBack:function jayus_easing_easeInBack(t){var s=1.70158;return t*t*(t*(s+1)-s)},easeOutBack:function jayus_easing_easeOutBack(t){var s=1.70158;return--t*t*((s+1)*t+s)+1},easeInOutBack:function jayus_easing_easeInOutBack(t){var s=
1.70158;return(t/=0.5)<1?t*t*(((s*=1.525)+1)*t-s)/2:(t-=2)*t*(((s*=1.525)+1)*t+s)/2+1},easeInBounce:function jayus_easing_easeInBounce(t){return 1-jayus.easing.easeOutBounce(1-t)},easeOutBounce:function jayus_easing_easeOutBounce(t){if(t<1/2.75)return 7.5625*t*t;if(t<2/2.75)return 7.5625*(t-=1.5/2.75)*t+0.75;if(t<2.5/2.75)return 7.5625*(t-=2.25/2.75)*t+0.9375;return 7.5625*(t-=2.625/2.75)*t+0.984375},easeInOutBounce:function jayus_easing_easeInOutBounce(t){return t<0.5?jayus.easing.easeInBounce(t*
2)/2:jayus.easing.easeOutBounce(t*2-1)/2+0.5}};jayus.debug.className="Responder";
jayus.Responder=jayus.createClass({hasHandlers:false,isHandler:null,handlers:null,handle:function Responder_handle(handlers){jayus.debug.match("Entity.handle",handlers,"handlers",5);for(var event in handlers)if(handlers.hasOwnProperty(event))this.addHandler(event,handlers[event]);return this},addHandler:function Responder_addHandler(event,handler,options){jayus.debug.matchArguments("Responder.addHandler",arguments,"event",2,"handler",3);jayus.debug.matchOptional("Responder.addHandler",options,"options",
5);if(!this.hasHandlers){this.hasHandlers=true;this.isHandler={frame:false};this.handlers={}}if(arguments.length===2)options={};options.handler=handler;options.hasContext=typeof options.context==="object";options.interceptor=!!options.interceptor;if(this.isHandler[event])this.handlers[event].push(options);else{this.handlers[event]=[options];this.isHandler[event]=true}return this},interceptNextEvent:function Responder_interceptNextEvent(event,handler,options){jayus.debug.matchArguments("Responder.addHandler",
arguments,"event",2,"handler",3);jayus.debug.matchOptional("Responder.addHandler",options,"options",5);if(arguments.length===2)options={};options.interceptor=true;return this.addHandler(event,handler,options)},removeHandler:function Responder_removeHandler(event,handler){jayus.debug.match("Responder.removeHandler",event,"event",2);if(!jayus.debug.is(3,handler)&&!jayus.debug.is(2,handler))throw new TypeError("Responder.removeHandler() - Invalid handler"+jayus.debug.toString(handler)+" sent, Function or String required.");
if(this.isHandler[event]){if(handler instanceof Function)this.handlers[event].splice(this.handlers[event].indexOf(handler),1);else{var i,id=handler;for(i=0;i<this.handlers[event].length;i++){handler=this.handlers[event][i];if(handler.id===id)this.handlers[event].splice(i,1)}}if(!this.handlers[event].length){delete this.handlers[event];this.isHandler[event]=false}}return this},removeHandlers:function Entity_removeHandlers(event){jayus.debug.match("Entity.removeHandlers",event,"event",2);if(this.isHandler[event]){this.handlers[event]=
[];this.isHandler[event]=false}return this},removeAllHandlers:function Entity_removeAllHandlers(){this.hasHandlers=false;if(typeof this.addDefaultHandlers==="function")this.addDefaultHandlers();return this},fire:function Responder_fire(event,data){jayus.debug.match("Responder.fire",event,"event",2);jayus.debug.matchOptional("Responder.fire",data,"data",5);var i,opts,result;if(this.hasHandlers&&this.isHandler[event])for(i=0;i<this.handlers[event].length;i++){opts=this.handlers[event][i];result=!!opts.handler.call(opts.hasContext?
opts.context:this,data);if(opts.interceptor){this.removeHandler(event,opts.handler);if(!this.isHandler[event])return result}if(result)return true}return false}});jayus.debug.className="Animator";
jayus.Animator=jayus.Responder.extend({isAnimator:true,running:false,duration:1E3,startTime:null,easing:jayus.easing.linear,looped:false,oscillate:false,init:function Animator_init(updater){jayus.debug.match("Animator.init",updater,"updater",3);this.update=updater},start:function Animator_start(){if(!this.running){this.startTime=Date.now();this.running=true;jayus.animators.push(this);this.fire("started");this.update(0)}else console.warn("Animator.start() - Started when already running");return this},
stop:function Animator_stop(){if(this.running){this.running=false;jayus.animators.splice(jayus.animators.indexOf(this),1);this.fire("stopped")}else console.warn("Animator.stop() - Stopped when not running");return this},finish:function Animator_finish(){if(this.running){this.running=false;jayus.animators.splice(jayus.animators.indexOf(this),1);this.update(1);this.fire("finished")}else console.warn("Animator.finish() - Finished when not running");return this},setDuration:function Animator_setDuration(duration){jayus.debug.match("Animator.setDuration",
duration,"duration",4);this.duration=duration;return this},setEasing:function Animator_setEasing(easing){if(typeof easing==="string"){jayus.debug.match("Animator.setEasing",easing,"easing",2);easing=jayus.easing[easing]}else jayus.debug.match("Animator.setEasing",easing,"easing",3);this.easing=easing;return this},tick:function Animator_tick(time){if(time-this.startTime<this.duration){var pos=this.easing((time-this.startTime)/this.duration);if(pos<0)pos=0;if(this.oscillate)if(pos<=0.5)pos*=2;else{pos=
(pos-0.5)*2;pos=1-pos}this.update(pos)}else if(this.looped)this.startTime=Date.now();else this.finish()},setLooped:function Animator_setLooped(on){jayus.debug.match("Animator.setLooped",on,"on",1);this.looped=on;return this},setOscillate:function Animator_setOscillate(on){jayus.debug.match("Animator.setOscillate",on,"on",1);this.oscillate=on;return this}});jayus.debug.className="Animatable";
jayus.Animatable=jayus.createClass({actionsToAnimate:0,animate:function Animatable_animate(){this.actionsToAnimate++;return this}});jayus.debug.className="MethodAnimator";
jayus.MethodAnimator=jayus.Animator.extend({target:null,method:null,initialValue:null,finalValue:null,multipleParameters:false,values:null,init:function MethodAnimator_init(target,method,initialValue,finalValue){jayus.debug.matchArguments("MethodAnimator.init",arguments,"target",5,"method",3,"initialValue",0,"finalValue",0);this.target=target;this.method=method;this.initialValue=initialValue;this.finalValue=finalValue;if(initialValue instanceof Array){this.multipleParameters=true;this.values=[]}},
update:function MethodAnimator_update(pos){if(this.multipleParameters){for(var i=0;i<this.initialValue.length;i++)this.values[i]=this.initialValue[i]+pos*(this.finalValue[i]-this.initialValue[i]);this.method.apply(this.target,this.values)}else this.method.call(this.target,this.initialValue+pos*(this.finalValue-this.initialValue))}});jayus.debug.className="DiscreteAnimator";
jayus.Animator.Discrete=jayus.Animator.extend({count:NaN,updater:null,init:function DiscreteAnimator_init(count,updater){jayus.debug.matchArguments("DiscreteAnimator.init",arguments,"count",4,"updater",3);this.count=count;this.updater=updater},update:function DiscreteAnimator_update(pos){pos=Math.floor(pos*this.count);if(pos===this.count)pos--;this.updater(pos)}});jayus.debug.className="AnimatorSequence";
jayus.Animator.Sequence=jayus.Animator.extend({animators:null,init:function AnimatorSequence_init(){this.animators=new jayus.List;this.animators.typeId=22},update:function AnimatorSequence_update(pos){var count=this.animators.items.length,index=Math.floor(pos*counts);if(index===counts)index--;pos=pos*counts-index;this.animators.items[index].update(pos)}});jayus.debug.className="Dependency";
jayus.Dependency=jayus.Animatable.extend({dependents:null,dependentCount:0,frozen:0,attach:function Dependency_attach(dependent){jayus.debug.match("Dependency.attach",dependent,"dependent",5);if(this.dependentCount)if(this.dependentCount===1)this.dependents=[this.dependents,dependent];else this.dependents.push(dependent);else this.dependents=dependent;this.dependentCount++},detach:function Dependency_detach(dependent){if(this.dependentCount){if(this.dependentCount===1)this.dependents=null;else if(this.dependenCount===
2)this.depdendents=this.dependents[1];else this.dependents.splice(this.dependents.indexOf(dependent),1);this.dependentCount--}},dirty:function Dependency_dirty(type){if(!this.frozen)this.informDependents(type)},informDependents:function Dependency_informDependents(type){if(this.dependentCount)if(this.dependentCount===1){jayus.debug.verifyMethod(this.dependents,"componentDirtied");this.dependents.componentDirtied(this.componentType,this,type)}else for(var i=0;i<this.dependentCount;i++){jayus.debug.verifyMethod(this.dependents[i],
"componentDirtied");this.dependents[i].componentDirtied(this.componentType,this,type)}},forEachDependent:function Dependency_forEachDependent(func,args){if(this.dependentCount===1)func.apply(this.dependents,args);else for(var i=0;i<this.dependentCount;i++)func.apply(this.dependents[i],args)}});jayus.debug.className="List";
jayus.List=jayus.createClass({shapeType:-1,parent:null,items:null,typeId:0,init:function List_init(parent){if(arguments.length===1){jayus.debug.match("List.init",parent,"parent",5);this.parent=parent}this.items=[]},added:function List_added(item){this.parent.listItemAdded(this,item)},addedMany:function List_addedMany(items){this.parent.listItemsAdded(this,items)},removed:function List_removed(item){this.parent.listItemRemoved(this,item)},removedMany:function List_removedMany(items){this.parent.listItemsRemoved(this,items)},
indexOf:function List_indexOf(item){var i;if(typeof item==="string"){jayus.debug.match("List.indexOf",item,"item",0);for(i=0;i<this.items.length;i++)if(this.items[i].id===item)return i;return-1}jayus.debug.match("List.indexOf",item,"item",this.typeId);return this.items.indexOf(item)},has:function List_has(item){jayus.debug.match("List.has",item,"item",this.typeId);return this.items.indexOf(item)>=0},count:function List_count(){return this.items.length},at:function List_at(index){jayus.debug.match("List.at",
index,"index",4);if(0<=index&&index<this.items.length)return this.items[index];return null},get:function List_get(id){jayus.debug.match("List.get",id,"id",0);var i,item;for(i=0;i<this.items.length;i++){item=this.items[i];if(item.id===id)return item}return null},add:function List_add(item){if(arguments.length===1){jayus.debug.match("List.add",item,"item",this.typeId);this.items.push(item);this.added(item)}else{for(var i=0;i<arguments.length;i++)this.items.push(arguments[i]);this.addedMany(arguments)}return this},
append:function List_append(items){jayus.debug.matchArray("List.append",items,"items",this.typeId);for(var i=0;i<items.length;i++)this.items.push(items[i]);this.addedMany(items);return this},insert:function List_insert(item,index){jayus.debug.matchArguments("List.insert",arguments,"item",this.typeId,"index",4);this.items.splice(index,0,item);this.added(item);return this},insertBefore:function List_insertBefore(item,pivot){jayus.debug.matchArguments("List.insertBefore",arguments,"item",this.typeId,
"pivot",this.typeId);var index=this.items.indexOf(pivot);if(index>0){this.items.splice(index-1,0,item);this.added(item)}return this},insertAfter:function List_insertAfter(item,pivot){jayus.debug.matchArguments("List.insertAfter",arguments,"item",this.typeId,"pivot",this.typeId);var index=this.items.indexOf(pivot);if(index!==-1){this.items.splice(index,0,item);this.added(item)}return this},remove:function List_remove(item){jayus.debug.match("List.remove",item,"item",this.typeId);var i,index;if(arguments.length===
1){index=this.items.indexOf(item);if(index>=0){this.items.splice(index,1);this.removed(item)}}else{for(i=0;i<arguments.length;i++){item=arguments[i];index=this.items.indexOf(item);if(index>=0){this.items.splice(index,1);this.removed(item)}}this.removedMany(arguments)}return this},removeAt:function List_removeAt(index){jayus.debug.match("List.removeAt",index,"index",4);if(0<=index&&index<this.items.length){var item=this.items[index];this.items.splice(index,1);this.removed(item)}return this},replace:function List_replace(oldItem,
newItem){if(typeof oldItem==="string")jayus.debug.matchArguments("List.replace",arguments,"oldId",2,"newItem",this.typeId);else jayus.debug.matchArguments("List.replace",arguments,"oldItem",this.typeId,"newItem",this.typeId);return this.replaceAt(this.indexOf(oldItem),newItem)},update:function List_update(oldItem,newItem){if(typeof oldItem==="string")jayus.debug.matchArguments("List.update",arguments,"oldId",2,"newItem",this.typeId);else jayus.debug.matchArguments("List.update",arguments,"oldItem",
this.typeId,"newItem",this.typeId);var index=this.indexOf(oldItem);if(index===-1)this.add(newItem);else this.replaceAt(index,newItem);return this},replaceAt:function List_replaceAt(index,newItem){jayus.debug.matchArguments("List.replaceAt",arguments,"index",4,"newItem",this.typeId);if(index>=0){this.removed(this.items[index]);this.items[index]=newItem;this.added(newItem)}return this},purge:function List_purge(){var items=this.items;this.removedMany(items);this.items=[];return this},onEach:function List_onEach(method,
args){jayus.debug.match("List.onEach",method,"method",2);jayus.debug.matchOptional("List.onEach",args,"args",6);for(var i=0;i<this.items.length;i++)this.items[i][method].apply(this.items[i],args);return this},forEach:function List_forEach(func,args){jayus.debug.match("List.forEach",func,"func",3);jayus.debug.matchOptional("List.forEach",args,"args",6);var i,ret;for(i=0;i<this.items.length;i++){ret=func.apply(this.items[i],args);if(ret!==undefined)return ret}return null}});jayus.debug.className="Color";
jayus.Color=jayus.Dependency.extend({componentType:"COLOR",r:0,g:0,b:0,a:1,init:function Color_init(){if(arguments.length)this.set.apply(this,arguments)},set:function Color_set(r,g,b,a){switch(arguments.length){case 1:g=1;case 2:jayus.debug.matchArguments("Color.set",arguments,"name",2,"alpha",4);var index=jayus.colors.displayNames.indexOf(r);if(index<0)index=jayus.colors.cssNames.indexOf(r);if(index+1)this.set(jayus.colors.redComponents[index],jayus.colors.greenComponents[index],jayus.colors.blueComponents[index],
g);return this;case 3:a=1;case 4:jayus.debug.matchArgumentsAs("Color.set",arguments,4,"r","g","b","a");if(this.actionsToAnimate){this.actionsToAnimate--;return new jayus.MethodAnimator(this,this.set,[this.r,this.g,this.b,this.a],[r,g,b,a])}this.r=r;this.g=g;this.b=b;this.a=a;return this}throw new Error("Color.set() - Invalid number of arguments sent, 1, 2, 3, or 4 required");},setRed:function Color_setRed(value){jayus.debug.match("Color.setRed",value,"value",4);if(this.actionsToAnimate){this.actionsToAnimate--;
return new jayus.MethodAnimator(this,this.setRed,this.r,value)}if(this.r!==value){this.r=value;this.dirty(jayus.DIRTY.STYLE)}return this},setGreen:function Color_setGreen(value){jayus.debug.match("Color.setGreen",value,"value",4);if(this.actionsToAnimate){this.actionsToAnimate--;return new jayus.MethodAnimator(this,this.setGreen,this.g,value)}if(this.g!==value){this.g=value;this.dirty(jayus.DIRTY.STYLE)}return this},setBlue:function Color_setBlue(value){jayus.debug.match("Color.setBlue",value,"value",
4);if(this.actionsToAnimate){this.actionsToAnimate--;return new jayus.MethodAnimator(this,this.setBlue,this.b,value)}if(this.b!==value){this.b=value;this.dirty(jayus.DIRTY.STYLE)}return this},setAlpha:function Color_setAlpha(value){jayus.debug.match("Color.setAlpha",value,"value",4);if(this.actionsToAnimate){this.actionsToAnimate--;return new jayus.MethodAnimator(this,this.setAlpha,this.a,value)}if(this.a!==value){this.a=value;this.dirty(jayus.DIRTY.STYLE)}return this},toString:function Color_toString(){return"(Color:"+
this.r+","+this.g+","+this.b+(this.a-1?","+this.a:"")+")"},toHex:function Color_toHex(){var r=this.r.toString(16),g=this.g.toString(16),b=this.b.toString(16);return"#"+(r.length===1?"0"+r:r)+(g.length===1?"0"+g:g)+(b.length===1?"0"+b:b)},toCSS:function Color_toCSS(){this.a=jayus.math.clamp(0,this.a,1);if(this.a-1)return"rgba("+this.r+","+this.g+","+this.b+","+this.a+")";return"rgb("+this.r+","+this.g+","+this.b+")"},getName:function Color_getName(){var i,table=jayus.colorTable;for(i=0;i<table.count;i++)if(this.r===
table.redComponents[i]&&this.g===table.greenComponents[i]&&this.b===table.blueComponents[i])return table.displayNames[i];return""}});jayus.debug.className="Brush";
jayus.Brush=jayus.Dependency.extend({componentType:"BRUSH",filling:false,stroking:false,fillType:0,strokeType:0,shadowType:0,alpha:1,strokeFirst:false,fill:null,stroke:null,lineWidth:null,lineCap:null,lineJoin:null,miterLimit:null,lineDash:null,lineDashOffset:null,shadow:null,shadowOffsetX:null,shadowOffsetY:null,shadowBlur:null,init:function Brush_init(styling){if(arguments.length){jayus.debug.match("Brush.init",styling,"styling",5);this.apply(styling)}},componentDirtied:function Brush_componentDirtied(componentType,component,
type){this.dirty(jayus.DIRTY.STYLE)},apply:function Brush_apply(styling){jayus.debug.match("Brush.apply",styling,"styling",5);this.frozen++;for(var key in styling)if(styling.hasOwnProperty(key))this["set"+key[0].toUpperCase()+key.slice(1)](styling[key]);this.frozen--;this.dirty(jayus.DIRTY.STYLE);return this},findStyleType:function Brush_findStyleType(style){if(style===null)return 0;if(typeof style==="string")return 1;if(style instanceof CanvasGradient)return 2;if(style instanceof CanvasPattern)return 3;
if(style instanceof jayus.Color)return 4;if(style instanceof jayus.LinearGradient)return 5;if(style instanceof jayus.RadialGradient)return 6;throw new Error("Style.findStyleType() - Invalid fill/stroke style: "+jayus.debug.toString(style));},getNativeStyle:function Brush_getNativeStyle(type,style){if(type<=3)return style;if(type===4)return style.toCSS();if(type===5||type===6)return style.getNative();throw new Error("Style.applyTo() - Invalid fill/stroke type identifier: "+jayus.debug.toString(type));
},applyTo:function Brush_applyTo(ctx){if(this.alpha!==1)ctx.globalAlpha*=this.alpha;if(this.filling)ctx.fillStyle=this.getNativeStyle(this.fillType,this.fill);if(this.stroking){ctx.strokeStyle=this.getNativeStyle(this.strokeType,this.stroke);if(this.lineWidth!==null)ctx.lineWidth=this.lineWidth;if(this.lineCap!==null)ctx.lineCap=this.lineCap;if(this.lineJoin!==null)ctx.lineJoin=this.lineJoin;if(this.miterLimit!==null)ctx.miterLimit=this.miterLimit;if(this.lineDash!==null&&jayus.ua.lineDash){ctx.setLineDash(this.lineDash);
if(this.lineDashOffset!==null)ctx.lineDashOffset=this.lineDashOffset}}if(this.shadowType){if(this.shadowType===1)ctx.shadowColor=this.shadow;else if(this.shadowType===2)ctx.shadowColor=this.shadow.toCSS();else throw new Error("Style.applyTo() - Invalid shadow type identifier: "+jayus.debug.toString(this.shadowType));if(this.shadowOffsetX!==null)ctx.shadowOffsetX=this.shadowOffsetX;if(this.shadowOffsetY!==null)ctx.shadowOffsetY=this.shadowOffsetY;if(this.shadowBlur!==null)ctx.shadowBlur=this.shadowBlur}},
paintShape:function Brush_paintShape(ctx){this.applyTo(ctx);if(this.stroking&&this.strokeFirst)ctx.stroke();if(this.filling)ctx.fill();if(this.stroking&&!this.strokeFirst)ctx.stroke()},paintRect:function Brush_paintRect(ctx,x,y,width,height){ctx.save();this.applyTo(ctx);if(this.stroking&&this.strokeFirst)ctx.strokeRect(x,y,width,height);if(this.filling)ctx.fillRect(x,y,width,height);if(this.stroking&&!this.strokeFirst)ctx.strokeRect(x,y,width,height);ctx.restore()},setAlpha:function Brush_setAlpha(alpha){if(alpha!==
null)jayus.debug.match("Brush.setAlpha",alpha,"alpha",4);if(alpha===null)alpha=1;if(this.alpha!==alpha){this.alpha=alpha;this.dirty(jayus.DIRTY.STYLE)}return this},setFill:function Brush_setFill(style){if(style!==null)jayus.debug.match("Brush.setFill",style,"style",0);if(this.fillType>=4)this.fill.detach(this);this.fill=style;this.fillType=this.findStyleType(style);if(this.fillType>=4)this.fill.attach(this);this.filling=!!this.fillType;this.dirty(jayus.DIRTY.STYLE);return this},setStroke:function Brush_setStroke(style){if(style!==
null)jayus.debug.match("Brush.setStroke",style,"style",0);if(this.strokeType>=4)this.stroke.detach(this);this.stroke=style;this.strokeType=this.findStyleType(style);if(this.strokeType>=4)this.stroke.attach(this);this.stroking=!!this.strokeType;this.dirty(jayus.DIRTY.STYLE);return this},setLineWidth:function Brush_setLineWidth(lineWidth){if(lineWidth!==null)jayus.debug.match("Brush.setLineWidth",lineWidth,"lineWidth",4);if(this.lineWidth!==lineWidth){this.lineWidth=lineWidth;this.dirty(jayus.DIRTY.STYLE)}return this},
setLineCap:function Brush_setLineCap(lineCap){if(lineCap!==null)jayus.debug.match("Brush.setLineCap",lineCap,"lineCap");if(this.lineCap!==lineCap){this.lineCap=lineCap;this.dirty(jayus.DIRTY.STYLE)}return this},setLineJoin:function Brush_setLineJoin(lineJoin){if(lineJoin!==null)jayus.debug.match("Brush.setLineJoin",lineJoin,"lineJoin",2);if(this.lineJoin!==lineJoin){this.lineJoin=lineJoin;this.dirty(jayus.DIRTY.STYLE)}return this},setMiterLimit:function Brush_setMiterLimit(miterLimit){if(miterLimit!==
null)jayus.debug.match("Brush.setMiterLimit",miterLimit,"miterLimit",2);if(this.miterLimit!==miterLimit){this.miterLimit=miterLimit;this.dirty(jayus.DIRTY.STYLE)}return this},setLineDash:function Brush_setLineDash(lineDash){if(lineDash!==null)jayus.debug.matchArray("Style.setLineDash",lineDash,"lineDash",4);this.lineDash=lineDash;this.dirty(jayus.DIRTY.STYLE);return this},setLineDashOffset:function Brush_setLineDashOffset(lineDashOffset){if(lineDashOffset!==null)jayus.debug.match("Brush.setLineDashOffset",
lineDashOffset,"lineDashOffset",4);if(this.lineDashOffset!==lineDashOffset){this.lineDashOffset=lineDashOffset;this.dirty(jayus.DIRTY.STYLE)}return this},setShadow:function Brush_setShadow(shadow){if(shadow!==null)jayus.debug.match("Brush.setShadow",shadow,"shadow",0);if(this.shadowType===2)this.shadow.detach(this);this.shadow=shadow;if(shadow===null)this.shadowType=0;else if(typeof shadow==="string")this.shadowType=1;else if(shadow instanceof jayus.Color){this.shadowType=2;this.shadow.attach(this)}else throw new Error("Style.setShadow() - Invalid shadow style: "+
jayus.debug.toString(shadow));this.dirty(jayus.DIRTY.STYLE);return this},setShadowOffsetX:function Brush_setShadowOffsetX(shadowOffsetX){if(shadowOffsetX!==null)jayus.debug.match("Brush.setShadowOffsetX",shadowOffsetX,"shadowOffsetX",4);if(this.shadowOffsetX!==shadowOffsetX){this.shadowOffsetX=shadowOffsetX;this.dirty(jayus.DIRTY.STYLE)}return this},setShadowOffsetY:function Brush_setShadowOffsetY(shadowOffsetY){if(shadowOffsetY!==null)jayus.debug.match("Brush.setShadowOffsetY",shadowOffsetY,"shadowOffsetY",
4);if(this.shadowOffsetY!==shadowOffsetY){this.shadowOffsetY=shadowOffsetY;this.dirty(jayus.DIRTY.STYLE)}return this},setShadowBlur:function Brush_setShadowBlur(shadowBlur){if(shadowBlur!==null)jayus.debug.match("Brush.setShadowBlur",shadowBlur,"shadowBlur",4);if(this.shadowBlur!==shadowBlur){this.shadowBlur=shadowBlur;this.dirty(jayus.DIRTY.STYLE)}return this}});jayus.debug.className="Gradient";
jayus.Gradient=jayus.Dependency.extend({componentType:"GRADIENT",stopPositions:null,stopColors:null,nativeGradient:null,reformNative:true,componentDirtied:function Gradient_componentDirtied(componentType,component,type){this.reformNative=true;this.dirty(jayus.DIRTY.STYLE)},translate:function LinearGradient_translate(x,y){jayus.debug.matchCoordinate("LinearGradient.translate",x,y);if(arguments.length===1){y=x.y;x=x.x}this.start.translate(x,y);this.end.translate(x,y);this.dirty(jayus.DIRTY.ALL);return this},
addColorStop:function Gradient_addColorStop(position,color){jayus.debug.matchArguments("Gradient.addColorStop",arguments,"position",4,"color",0);this.stopPositions.push(position);this.stopColors.push(color);return this},getNative:function Gradient_getNative(){if(this.reformNative){this.refresh();this.reformNative=false}return this.nativeGradient}});jayus.debug.className="LinearGradient";
jayus.LinearGradient=jayus.Gradient.extend({start:null,end:null,init:overloadArgumentCount({2:function LinearGradient_init(start,end){jayus.debug.matchArguments("LinearGradient.init",arguments,"start",13,"end",13);this.stopPositions=[];this.stopColors=[];this.start=start;this.start.attach(this);this.end=end;this.end.attach(this)},4:function LinearGradient_init(x1,y1,x2,y2){jayus.debug.matchArgumentsAs("LinearGradient.init",arguments,4,"x1","y1","x2","y2");this.init(new jayus.Point(x1,y1),new jayus.Point(x2,
y2))}}),refresh:function LinearGradient_refresh(){var i,color;this.nativeGradient=jayus.getContext().createLinearGradient(this.start.x,this.start.y,this.end.x,this.end.y);for(i=0;i<this.stopPositions.length;i++){color=this.stopColors[i];if(color instanceof jayus.Color)color=color.toCSS();this.nativeGradient.addColorStop(this.stopPositions[i],color)}return this}});jayus.debug.className="RadialGradient";
jayus.RadialGradient=jayus.Gradient.extend({start:null,end:null,init:overloadArgumentCount({2:function RadialGradient_init(start,end){jayus.debug.matchArguments("RadialGradient.init",arguments,"start",14,"end",14);this.stopPositions=[];this.stopColors=[];this.start=start;this.start.attach(this);this.end=end;this.end.attach(this)},4:function RadialGradient_init(start,r1,end,r2){jayus.debug.matchArguments("RadialGradient.init",arguments,"start",13,"r1",4,"end",13,"r2",4);this.init(new jayus.Circle(start,
r1),new jayus.Circle(end,r2))},6:function RadialGradient_init(cx1,cy1,r1,cx2,cy2,r2){jayus.debug.matchArgumentsAs("RadialGradient.init",arguments,4,"cx1","cy1","r1","cx2","cy2","r2");this.init(new jayus.Circle(cx1,cy1,r1),new jayus.Circle(cx2,cy2,r2))}}),refresh:function RadialGradient_refresh(){var i,color;this.nativeGradient=jayus.getContext().createRadialGradient(this.start.x,this.start.y,this.start.radius,this.end.x,this.end.y,this.end.radius);for(i=0;i<this.stopPositions.length;i++){color=this.stopColors[i];
if(color instanceof jayus.Color)color=color.toCSS();this.nativeGradient.addColorStop(this.stopPositions[i],color)}return this}});jayus.debug.className="Matrix";
jayus.Matrix=jayus.createClass({a:1,b:0,tx:0,c:0,d:1,ty:0,init:function Matrix_init(a,b,tx,c,d,ty){if(arguments.length){jayus.debug.matchArgumentsAs("Matrix.init",arguments,4,"a","b","tx","c","d","ty");this.a=a;this.b=b;this.tx=tx;this.c=c;this.d=d;this.ty=ty}},translate:function Matrix_translate(x,y){jayus.debug.matchCoordinate("Matrix.translate",x,y);if(arguments.length===1){y=x.y;x=x.x}this.tx+=this.a*x+this.b*y;this.ty+=this.d*y+this.c*x;return this},scale:function Matrix_scale(x,y){jayus.debug.matchCoordinate("Matrix.scale",
x,y);if(arguments.length===1){y=x.y;x=x.x}this.a*=x;this.c*=x;this.d*=y;this.b*=y;return this},rotate:function Matrix_rotate(angle){jayus.debug.match("Matrix.rotate",angle,"angle",4);var sin=Math.sin(angle),cos=Math.cos(angle);var a=this.a*cos+this.b*sin;this.b=-this.a*sin+this.b*cos;this.a=a;var c=this.d*sin+this.c*cos;this.d=this.d*cos-this.c*sin;this.c=c;return this},multiply:function Matrix_multiply(m1){jayus.debug.match("Matrix.multiply",m1,"m1",10);m2=this;return new jayus.Matrix(m1.a*m2.a+
m1.b*m2.c,m1.a*m2.b+m1.b*m2.d,m1.a*m2.tx+m1.b*m2.ty+m1.tx,m1.c*m2.a+m1.d*m2.c,m1.c*m2.b+m1.d*m2.d,m1.c*m2.tx+m1.d*m2.ty+m1.ty)},transformPoint:function Matrix_transformPoint(x,y){jayus.debug.matchCoordinate("Matrix.transformPoint",x,y);if(arguments.length===1){y=x.y;x=x.x}return this.transformPointOnto(x,y,new jayus.Point)},transformPointOnto:function Matrix_transformPointOnto(x,y,ret){jayus.debug.matchArguments("Matrix.transformPointOnto",arguments,"x",4,"y",4,"ret",13);ret.x=x*this.a+y*this.b+this.tx;
ret.y=x*this.c+y*this.d+this.ty;return ret},inverseTransformPoint:function Matrix_inverseTransformPoint(x,y){jayus.debug.matchCoordinate("Matrix.inverseTransformPoint",x,y);if(arguments.length===1){y=x.y;x=x.x}return this.inverseTransformPointOnto(x,y,new jayus.Point)},inverseTransformPointOnto:function Matrix_inverseTransformPointOnto(x,y,ret){jayus.debug.matchArguments("Matrix.inverseTransformPointOnto",arguments,"x",4,"y",4,"ret",13);var det=this.getDeterminant();if(det){x-=this.tx;y-=this.ty;
ret.x=(x*this.d-y*this.b)/det;ret.y=(y*this.a-x*this.c)/det;return ret}return null},identity:function Matrix_identity(){this.a=this.d=1;this.b=this.tx=this.c=this.ty=0;return this},getDeterminant:function Matrix_getDeterminant(){var det=this.a*this.d-this.b*this.c;if(isFinite(det)&&Math.abs(det)>1.0E-11&&isFinite(this.tx)&&isFinite(this.ty))return det;return null},clone:function Matrix_clone(){jayus.chart.tallyInit("Matrix","Matrix.clone()");return this.cloneOnto(new jayus.Matrix)},cloneOnto:function Matrix_cloneOnto(ret){jayus.debug.match("Matrix.cloneOnto",
ret,"ret",10);ret.init(this.a,this.b,this.tx,this.c,this.d,this.ty);return ret},toString:function Matrix_toString(){return"[ "+this.a+", "+this.b+", "+this.tx+" ]\n"+"[ "+this.b+", "+this.d+", "+this.ty+" ]\n"+"[ "+0+", "+0+", "+1+" ]"},equals:function Matrix_equals(mat){jayus.debug.match("Matrix.equals",mat,"mat",10);return this.a===mat.a&&this.b===mat.b&&this.c===mat.c&&this.d===mat.d&&this.tx===mat.tx&&this.ty===mat.ty},applyToContext:function Matrix_applyToContext(ctx){jayus.debug.matchContext("Matrix.applyToContext",
ctx);ctx.transform(this.a,this.c,this.b,this.d,this.tx,this.ty)}});jayus.debug.className="SizePolicy";jayus.SizePolicy=jayus.createClass({size:0,weight:1,expand:true});jayus.images={images:{},pendingImageCount:0,has:function jayus_images_has(filepath){return typeof this.images[filepath]==="object"},isLoaded:function jayus_images_isLoaded(filepath){return typeof this.images[filepath]==="object"&&(this.images[filepath].loaded||this.images[filepath].tagName==="CANVAS")},get:function jayus_images_get(filepath){if(!this.has(filepath)){console.warn('jayus.images.get() - Image "'+filepath+'" not yet loaded');this.load(filepath)}return this.images[filepath]},setSubimage:function jayus_images_setSubimage(sourceImage,
image,sourceX,sourceY,sourceWidth,sourceHeight){var source=this.get(sourceImage);var canvas=document.createElement("canvas");canvas.width=sourceWidth;canvas.height=sourceHeight;var ctx=canvas.getContext("2d");ctx.drawImage(source,sourceX,sourceY,sourceWidth,sourceHeight,0,0,sourceWidth,sourceHeight);this.images[image]=canvas;return this},load:function jayus_images_load(filepath,handler){if(!this.has(filepath)){if(!jayus.debug.is(2,filepath))throw new TypeError("jayus.images.load() - Invalid filepath"+
jayus.debug.toString(filepath)+" sent as argument "+i+", String required");var image=new Image;image.isSheet=false;image.loaded=false;this.images[filepath]=image;image.onload=function image_onload(){this.loaded=true;jayus.fire("imageLoaded",{filepath:filepath,image:this});jayus.images.pendingImageCount--;if(!jayus.images.pendingImageCount)jayus.fire("imagesLoaded");if(typeof handler==="function")handler(filepath,this)};this.pendingImageCount++;image.src=filepath}},loadAll:function jayus_images_loadAll(filepaths,
handler){var i,count,checkCount;if(arguments.length===1)for(i=0;i<filepaths.length;i++)this.load(filepaths[i]);else if(arguments.length===2){count=filepaths.length;checkCount=function(){count--;if(!count)handler()};for(i=0;i<filepaths.length;i++)this.load(filepaths[i],checkCount)}}};jayus.objects={objects:{},pendingObjectCount:0,has:function jayus_objects_has(filepath){return typeof this.objects[filepath]==="object"&&this.objects[filepath]!==null},get:function jayus_objects_get(filepath){if(!this.has(filepath)){console.warn('jayus.objects.get() - Object "'+filepath+'" not yet loaded');this.load(filepath)}return this.objects[filepath]},load:function jayus_objects_load(filepath,handler){jayus.debug.match("jayus.objects.load",filepath,"filepath",2);jayus.debug.matchOptional("jayus.objects.load",
handler,"handler",3);if(!this.has(filepath)){var req=new XMLHttpRequest;req.filepath=filepath;req.open("get",filepath,true);req.onload=function(){var object=JSON.parse(this.responseText);jayus.objects.objects[this.filepath]=object;if(typeof handler==="function")handler(this.filepath,object,this);jayus.fire("objectLoaded",{filepath:this.filepath,object:object,xhr:this});jayus.objects.pendingObjectCount--;if(!jayus.objects.pendingObjectCount)jayus.fire("objectsLoaded")};this.objects[filepath]=null;
this.pendingObjectCount++;req.send()}else if(arguments.length===2)handler(filepath,this.objects[filepath])},loadAll:function jayus_objects_loadAll(filepaths,handler){var i,count,checkCount;if(arguments.length===1)for(i=0;i<filepaths.length;i++)this.load(filepaths[i]);else if(arguments.length===2){count=filepaths.length;checkCount=function(){count--;if(!count)handler()};for(i=0;i<filepaths.length;i++)this.load(filepaths[i],checkCount)}}};jayus.keyboard={requireFocus:true,pressed:{},keys:[0,0,0,0,0,0,0,0,"backspace","tab",0,0,0,"enter",0,0,"shift","ctrl","alt","break","capsLock",0,0,0,0,0,0,"escape",0,0,0,0,"space","pageUp","pageDown","end","home","left","up","right","down",0,0,0,0,"insert","delete",0,"0","1","2","3","4","5","6","7","8","9",0,0,0,0,0,0,0,"a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","leftWin","rightWin","select",0,0,"num0","num1","num2","num3","num4","num5",
"num6","num7","num8","num9","numMultiply","numAdd",0,"numSubtract","numPeriod","numDivide","f1","f2","f3","f4","f5","f6","f7","f8","f9","f10","f11","f12",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,"numLock","scrollLock",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,"semicolon","equalSign","comma","dash","period","forwardSlash","grave",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,"leftBracket","backslash","rightBracket","quote"],keyPressEventData:{},charTypeEventData:{},
init:function jayus_keyboard_init(){document.addEventListener("keydown",function jayus_onkeydownHandler(e){if(jayus.debug.pauseOnEscape&&e.keyCode===27)jayus.debug.pause();if(jayus.keyboard.requireFocus&&jayus.hasFocus){var key=jayus.keyboard.keys[e.keyCode],data=jayus.keyboard.keyPressEventData;data.event=e;data.key=key;if(jayus.keyboard.pressed[key])return!jayus.fire("keyTap",data);jayus.keyboard.pressed[key]=true;var cancel=jayus.fire("keyPress",data)||jayus.fire("keyTap",data);if(cancel){e.preventDefault();
return false}}});document.addEventListener("keyup",function jayus_onkeyupHandler(e){var key=jayus.keyboard.keys[e.keyCode],data=jayus.keyboard.keyPressEventData;data.event=e;data.key=key;if(jayus.keyboard.pressed[key]){jayus.keyboard.pressed[key]=false;if(jayus.fire("keyRelease",data)){e.preventDefault();return false}}});document.addEventListener("keypress",function jayus_onkeypressHandler(e){if(jayus.keyboard.requireFocus&&jayus.hasFocus){var data=jayus.keyboard.charTypeEventData;data.event=e;data["char"]=
String.fromCharCode(e.charCode);if(jayus.fire("charType",data)){e.preventDefault();return false}}})},isPressed:function jayus_keyboard_isPressed(id){jayus.debug.match("jayus.keyboard.isPressed",id,"id",2);if(!this.isKey(id))throw new RangeError("jayus.keyboard.isPressed() - Invalid id"+jayus.debug.toString(id)+" sent, unknown id");return!!this.pressed[id]},isKey:function jayus_keyboard_isKey(id){jayus.debug.match("jayus.keyboard.isKey",id,"id",2);return this.keys.indexOf(id)>=0}};jayus.debug.className="Shape";jayus.Shape=jayus.Dependency.extend({paintedWith:function Shape_paintedWith(brush){return new jayus.PaintedShape(this,brush)}});jayus.debug.className="Point";
jayus.Point=jayus.Dependency.extend({componentType:"POINT",x:0,y:0,init:function Point_init(x,y){if(arguments.length){jayus.debug.matchArgumentsAs("Point.init",arguments,4,"x","y");this.x=x;this.y=y}},setX:function Point_setX(x){jayus.debug.match("Point.setX",x,"x",4);if(this.actionsToAnimate){this.actionsToAnimate--;return new jayus.MethodAnimator(this,this.setX,this.x,x)}if(this.x!==x){this.x=x;this.dirty(2)}return this},setY:function Point_setY(y){jayus.debug.match("Point.setY",y,"y",4);if(this.actionsToAnimate){this.actionsToAnimate--;
return new jayus.MethodAnimator(this,this.setY,this.y,y)}if(this.y!==y){this.y=y;this.dirty(2)}return this},set:function Point_set(x,y){jayus.debug.matchCoordinate("Point.set",x,y);if(arguments.length===1){y=x.y;x=x.x}if(this.actionsToAnimate){this.actionsToAnimate--;return new jayus.MethodAnimator(this,this.set,[this.x,this.y],[x,y])}if(this.x!==x||this.y!==y){this.x=x;this.y=y;this.dirty(2)}return this},translate:function Point_translate(x,y){jayus.debug.matchCoordinate("Point.translate",x,y);if(arguments.length===
1){y=x.y;x=x.x}return this.set(this.x+x,this.y+y)},toString:function Point_toString(){return"(Point:"+this.x+","+this.y+")"},clone:function Point_clone(){return new jayus.Point(this.x,this.y)},equals:function Point_equals(x,y){jayus.debug.matchCoordinate("Point.equals",x,y);if(arguments.length===1){y=x.y;x=x.x}return this.x===x&&this.y===y}});jayus.debug.className="Rectangle";
jayus.Rectangle=jayus.Shape.extend({componentType:"RECTANGLE",shapeType:4,x:0,y:0,width:0,height:0,keepAligned:true,init:function Rectangle_init(x,y,width,height){if(arguments.length){jayus.debug.matchRectangle("Rectangle.init",x,y,width,height);if(arguments.length===2){height=y.height;width=y.width;y=x.y;x=x.x}else if(arguments.length===3){height=width;width=height;y=x.y;x=x.x}this.x=x;this.y=y;this.width=width;this.height=height}},getOrigin:function Rectangle_getOrigin(){return new jayus.Point(this.x,this.y)},
getOriginOnto:function Rectangle_getOriginOnto(ret){ret.x=this.x;ret.y=this.y;return ret},setX:jayus.Point.prototype.setX,setY:jayus.Point.prototype.setY,setOrigin:function Rectangle_setOrigin(x,y){jayus.debug.matchCoordinate("Rectangle.set",x,y);if(arguments.length===1){y=x.y;x=x.x}if(this.actionsToAnimate){this.actionsToAnimate--;return new jayus.MethodAnimator(this,this.setOrigin,[this.x,this.y],[x,y])}if(this.x!==x||this.y!==y){this.x=x;this.y=y;this.dirty(2)}return this},translate:function Rectangle_translate(x,
y){jayus.debug.matchCoordinate("Rectangle.translate",x,y);if(arguments.length===1){y=x.y;x=x.x}return this.setOrigin(this.x+x,this.y+y)},setWidth:function Rectangle_setWidth(width){jayus.debug.match("Rectangle.setWidth",width,"width",4);if(this.actionsToAnimate){this.actionsToAnimate--;return new jayus.MethodAnimator(this,this.setWidth,this.width,width)}if(this.width!==width){this.width=width;this.dirty(4)}return this},setHeight:function Rectangle_setHeight(height){jayus.debug.match("Rectangle.setHeight",
height,"height",4);if(this.actionsToAnimate){this.actionsToAnimate--;return new jayus.MethodAnimator(this,this.setHeight,this.height,height)}if(this.height!==height){this.height=height;this.dirty(4)}return this},setSize:function Rectangle_setSize(width,height){jayus.debug.matchSize("Rectangle.setSize",width,height);if(arguments.length===1){height=width.height;width=width.width}if(this.actionsToAnimate){this.actionsToAnimate--;return new jayus.MethodAnimator(this,this.setSize,[this.width,this.height],
[width,height])}if(this.width!==width||this.height!==height){this.width=width;this.height=height;this.dirty(4)}return this},expand:function Rectangle_expand(width,height){jayus.debug.matchArgumentsAs("Rectangle.expand",arguments,4,"width","height");return this.setSize(this.width+width,this.height+height)},getLeft:function Rectangle_getLeft(){return this.x},getRight:function Rectangle_getRight(){return this.x+this.width},getTop:function Rectangle_getTop(){return this.y},getBottom:function Rectangle_getBottom(){return this.y+
this.height},setLeft:function Rectangle_setLeft(left){jayus.debug.match("Rectangle.setLeft",left,"left",4);return this.setFrame(left,this.y,this.x+this.width-left,this.height)},setRight:function Rectangle_setRight(right){jayus.debug.match("Rectangle.setRight",right,"right",4);return this.setWidth(this.width+right-this.x)},setTop:function Rectangle_setTop(top){jayus.debug.match("Rectangle.setTop",top,"top",4);return this.setFrame(this.x,top,this.width,this.y+this.height-top)},setBottom:function Rectangle_setBottom(bottom){jayus.debug.match("Rectangle.setBottom",
bottom,"bottom",4);return this.setHeight(this.height+bottom-this.y)},setFrame:function Rectangle_setFrame(x,y,width,height){if(arguments.length===3){jayus.debug.matchArguments("Rectangle.setFrame",arguments,"origin",13,"width",4,"height",4);height=width;width=y;y=x.y;x=x.x}else jayus.debug.matchArgumentsAs("Rectangle.setFrame",arguments,4,"x","y","width","height");if(this.actionsToAnimate){this.actionsToAnimate--;return new jayus.MethodAnimator(this,this.setFrame,[this.x,this.y,this.width,this.height],
[x,y,width,height])}this.frozen++;this.setOrigin(x,y).setSize(width,height);this.frozen--;this.dirty(jayus.DIRTY.FRAME);return this},includePoint:function Rectangle_includePoint(x,y){jayus.debug.matchCoordinate("Rectangle.includePoint",x,y);if(arguments.length===1){y=x.y;x=x.x}var x1=Math.min(this.x,x),y1=Math.min(this.y,y),x2=Math.max(this.x+this.width,x),y2=Math.max(this.y+this.height,y);return this.setFrame(x1,y1,x2-x1,y2-y1)},includeRectangle:function Rectangle_includeRectangle(x,y,width,height){if(arguments.length===
1){jayus.debug.match("Rectangle.includeRectangle()",x,"section",20);height=x.height;width=x.width;y=x.y;x=x.x}else if(arguments.length===3){jayus.debug.matchArguments("Rectangle.includeRectangle()",arguments,"origin",13,"width",4,"height",4);height=width;width=y;y=x.y;x=x.x}else jayus.debug.matchArgumentsAs("Rectangle.includeRectangle()",arguments,4,"x","y","width","height");var x1=Math.min(this.x,x),y1=Math.min(this.y,y),x2=Math.max(this.x+this.width,x+width),y2=Math.max(this.y+this.height,y+height);
return this.setFrame(x1,y1,x2-x1,y2-y1)},alignToCanvas:function Rectangle_alignToCanvas(){return this.setFrame(Math.floor(this.x)+0.5,Math.floor(this.y)+0.5,Math.round(this.width),Math.round(this.height))},intersectsAt:function Rectangle_intersectsAt(x,y){jayus.debug.matchArgumentsAs("Rectangle.intersectsAt",arguments,4,"x","y");return this.x<=x&&x<=this.x+this.width&&this.y<=y&&y<=this.y+this.height},toString:function Rectangle_toString(){return"( Rectangle: "+this.x+", "+this.y+", "+this.width+
", "+this.height+" )"},getScope:function Rectangle_getScope(){return this.clone()},getTransformed:function Rectangle_getTransformed(matrix){jayus.debug.match("Rectangle.getTransformed",matrix,"matrix",10);return this.toPolygon().getTransformed(matrix)},clone:function Rectangle_clone(){return this.cloneOnto(new jayus.Rectangle)},cloneOnto:function Rectangle_cloneOnto(ret){jayus.debug.match("Rectangle.cloneOnto",ret,"ret",20);ret.x=this.x;ret.y=this.y;ret.width=this.width;ret.height=this.height;return ret},
toPolygon:function Rectangle_toPolygon(){return new jayus.Polygon.Rectangle(this.x,this.y,this.width,this.height)},etchOntoContext:function Rectangle_etchOntoContext(ctx){jayus.debug.matchContext("Rectangle.etchOntoContext",ctx);ctx.beginPath();if(this.keepAligned)ctx.rect(Math.round(this.x)+0.5,Math.round(this.y)+0.5,Math.round(this.width),Math.round(this.height));else ctx.rect(this.x,this.y,this.width,this.height);return this}});jayus.debug.className="Circle";
jayus.Circle=jayus.Shape.extend({shapeType:2,componentType:"CIRCLE",x:0,y:0,radius:1,init:function Circle_init(x,y,radius){if(arguments.length){if(arguments.length===2)jayus.debug.matchArguments("Circle.init",arguments,"center",13,"radius",13);else if(arguments.length===3)jayus.debug.matchArgumentsAs("Circle.init",arguments,4,"x","y","radius");else throw new TypeError("Circle.init() - Invalid number of parameters sent, 0, 2, or 3 required");if(arguments.length===2){radius=y;y=x.y;x=x.x}this.x=x;this.y=
y;this.radius=radius}},pointChanged:function Circle_pointChanged(){},getCenter:function Circle_getCenter(){return new jayus.Point(this.x,this.y)},setX:jayus.Point.prototype.setX,setY:jayus.Point.prototype.setY,setCenter:jayus.Point.prototype.set,translate:function Circle_translate(x,y){jayus.debug.matchCoordinate("Circle.translate",x,y);if(arguments.length===1){y=x.y;x=x.x}return this.setCenter(this.x+x,this.y+y)},alignToCanvas:function Circle_alignToCanvas(){return this},getRadius:function Circle_getRadius(){return this.radius},
setRadius:function Circle_setRadius(radius){jayus.debug.match("Circle.setRadius",radius,"radius",4);if(this.actionsToAnimate){this.actionsToAnimate--;return new jayus.MethodAnimator(this,this.setRadius,this.radius,radius)}if(this.radius!==radius){this.radius=radius;this.dirty(4)}return this},intersectsAt:function Circle_intersectsAt(x,y){jayus.debug.matchArgumentsAs("Circle.intersectsAt",arguments,4,"x","y");return(this.x-x)*(this.x-x)+(this.y-y)*(this.y-y)<=this.radius*this.radius},getScope:function Circle_getScope(){return new jayus.Rectangle(this.x-
this.radius,this.y-this.radius,this.radius*2,this.radius*2)},toString:function Circle_toString(){return"(Circle: "+this.x+","+this.y+","+this.radius+")"},clone:function Circle_clone(){return new jayus.Circle(this.x,this.y,this.radius)},cloneOnto:function Circle_cloneOnto(ret){ret.x=this.x;ret.y=this.y;ret.radius=this.radius;return ret},etchOntoContext:function Circle_etchOntoContext(ctx){jayus.debug.matchContext("Circle.etchOntoContext",ctx);ctx.beginPath();ctx.arc(this.x,this.y,this.radius,0,Math.PI*
2)}});jayus.debug.className="Polygon";
jayus.Polygon=jayus.Shape.extend({componentType:"POLYGON",shapeType:8,xPoints:null,yPoints:null,x1:0,y1:0,x2:0,y2:0,closed:true,frame:null,frameDirty:true,init:function Polygon_init(xPoints,yPoints){if(arguments.length===1){jayus.debug.matchArray("Polygon.init",xPoints,"xPoints",13);this.xPoints=[];this.yPoints=[];for(var i=0;i<xPoints.length;i++){this.xPoints[i]=xPoints[i].x;this.yPoints[i]=xPoints[i].y}}else if(arguments.length===2){jayus.debug.matchArray("Polygon.init",xPoints,"xPoints",4);jayus.debug.matchArray("Polygon.init",
yPoints,"yPoints",4);this.xPoints=xPoints;this.yPoints=yPoints}},translate:function Polygon_translate(x,y){jayus.debug.matchCoordinate("Polygon.translate",x,y);if(arguments.length===1){y=x.y;x=x.x}if(x||y){for(var i=0;i<this.xPoints.length;i++){this.xPoints[i]+=x;this.yPoints[i]+=y}this.frameDirty=true}return this},alignToCanvas:function Polygon_alignToCanvas(){return this},addPoint:function Polygon_addPoint(x,y){jayus.debug.matchCoordinate("Polygon.addPoint",x,y);if(arguments.length===1){y=x.y;x=
x.x}this.xPoints.push(x);this.yPoints.push(y);this.frameDirty=true;this.dirty(16);return this},addPoints:function Polygon_addPoints(xPoints,yPoints){if(arguments.length===1){jayus.debug.matchArray("Polygon.addPoints",xPoints,"xPoints",13);for(var i=0;i<xPoints.length;i++){this.xPoints.push(xPoints[i].x);this.yPoints.push(xPoints[i].y)}}else if(arguments.length===2){jayus.debug.matchArray("Polygon.addPoints",xPoints,"xPoints",4);jayus.debug.matchArray("Polygon.addPoints",yPoints,"yPoints",4);this.xPoints=
this.xPoints.concat(xPoints);this.yPoints=this.yPoints.concat(yPoints)}this.frameDirty=true;this.dirty(16);return this},insertPoint:function Polygon_insertPoint(index,x,y){if(arguments.length===2){jayus.debug.matchArguments("Polygon.insertPoint",arguments,"index",4,"point",13);y=x.y;x=x.x}else jayus.debug.matchArgumentsAs("Polygon.insertPoint",arguments,4,"index","x","y");this.xPoints.splice(index,0,x);this.yPoints.splice(index,0,y);this.frameDirty=true;this.dirty(16);return this},setPoint:function Polygon_setPoint(index,
x,y){if(arguments.length===2){jayus.debug.matchArguments("Polygon.setPoint",arguments,"index",4,"point",13);y=x.y;x=x.x}else jayus.debug.matchArgumentsAs("Polygon.setPoint",arguments,4,"index","x","y");this.xPoints[index]=x;this.yPoints[index]=y;this.frameDirty=true;this.dirty(16);return this},getLeft:function Shape_getLeft(){return this.getFrame().getLeft()},getTop:function Shape_getTop(){return this.getFrame().getTop()},getWidth:function Shape_getWidth(){return this.getFrame().getWidth()},getHeight:function Shape_getHeight(){return this.getFrame().getHeight()},
getScope:function Polygon_getScope(){return this.getFrame()},getFrame:function Polygon_getFrame(){if(this.frameDirty){this.reformFrame();this.frameDirty=false}return this.frame},reformFrame:function Polygon_reformFrame(){var i,x,y,x1=null,x2=null,y1=null,y2=null;for(i=0;i<this.xPoints.length;i++){x=this.xPoints[i];y=this.yPoints[i];if(x1===null||x<x1)x1=x;if(x2===null||x>x2)x2=x;if(y1===null||y<y1)y1=y;if(y2===null||y>y2)y2=y}if(this.frame===null)this.frame=new jayus.Rectangle;this.frame.setFrame(x1,
y1,x2-x1,y2-y1)},intersectsAt:function Polygon_intersectsAt(x,y){jayus.debug.matchArgumentsAs("Polygon.intersectsAt",arguments,4,"x","y");var ctx=jayus.getContext();ctx.save();this.etchOntoContext(ctx);var ret=ctx.isPointInPath(x,y);ctx.restore();return ret},setClosed:function Polygon_setClosed(on){jayus.debug.match("Polygon.setClosed",on,"on",1);if(this.closed!==on){this.closed=on;this.dirty(16)}return this},toString:function Polygon_toString(){var msg="(Polygon:";for(var i=0;i<this.xPoints.length;i++)msg+=
"("+this.xPoints[i]+","+this.yPoints[i]+"),";return msg.slice(0,msg.length-1)+")"},clone:function Polygon_clone(){return new jayus.Polygon(this.xPoints.slice(0),this.yPoints.slice(0))},cloneOnto:function Polygon_cloneOnto(ret){ret.xPoints=this.xPoints.slice(0);ret.yPoints=this.yPoints.slice(0);ret.frameDirty=true;return ret},transform:function Polygon_transform(matrix){jayus.debug.match("Polygon.transform",matrix,"matrix",10);var i,point=new jayus.Point;for(i=0;i<this.xPoints.length;i++){matrix.transformPointOnto(this.xPoints[i],
this.yPoints[i],point);this.xPoints[i]=point.x;this.yPoints[i]=point.y}this.frameDirty=true;return this},getTransformed:function Polygon_getTransformed(matrix){jayus.debug.match("Polygon.getTransformed",matrix,"matrix",10);return this.getTransformedOnto(matrix,new jayus.Polygon)},getTransformedOnto:function Polygon_getTransformedOnto(matrix,ret){jayus.debug.matchArguments("Polygon.getTransformedOnto",arguments,"matrix",10,"ret",15);var i,point=new jayus.Point;ret.xPoints=[];ret.yPoints=[];for(i=0;i<
this.xPoints.length;i++){matrix.transformPointOnto(this.xPoints[i],this.yPoints[i],point);ret.xPoints.push(point.x);ret.yPoints.push(point.y)}return ret},etchOntoContext:function Polygon_etchOntoContext(ctx){jayus.debug.matchContext("Polygon.etchOntoContext",ctx);if(this.xPoints.length){ctx.beginPath();ctx.moveTo(this.xPoints[0],this.yPoints[0]);for(var i=0;i<this.xPoints.length;i++)ctx.lineTo(this.xPoints[i],this.yPoints[i]);if(this.closed)ctx.closePath()}return this}});
jayus.Polygon.Line=function Polygon_Line(x1,y1,x2,y2){if(arguments.length===2){jayus.debug.matchArguments("Polygon.Line()",arguments,"start",13,"end",13);y2=y1.y;x2=y1.x;y1=x1.y;x1=x1.x}else jayus.debug.matchArgumentsAs("Polygon.Line",arguments,4,"x1","y1","x2","y2");return new jayus.Polygon([x1,x2],[y1,y2])};
jayus.Polygon.LineOnto=function Polygon_LineOnto(x1,y1,x2,y2,ret){jayus.debug.matchArgumentsAs("Polygon.LineOnto",arguments,4,"x1","y1","x2","y2");jayus.debug.match("Polygon.LineOnto",ret,"ret",15);ret.xPoints=[x1,x2];ret.yPoints=[y1,y2];ret.frameDirty=true;return ret};
jayus.Polygon.Rectangle=function Polygon_Rectangle(x,y,width,height){if(arguments.length===3){jayus.debug.matchArguments("Polygon.Rectangle",arguments,"origin",13,"width",4,"height",4);height=width;width=y;y=x.y;x=x.x}else jayus.debug.matchArgumentsAs("Polygon.Rectangle",arguments,4,"x","y","width","height");return new jayus.Polygon([x,x+width,x+width,x],[y,y,y+height,y+height])};
jayus.Polygon.Regular=function Polygon_Regular(count,radius){jayus.debug.matchArgumentsAs("Polygon.Regular",arguments,4,"count","radius");var i,poly=new jayus.Polygon,angle=0,step=Math.PI*2/count;for(i=0;i<count;i++){poly.addPoint(radius*Math.cos(angle),radius*Math.sin(angle));angle+=step}return poly};
jayus.Polygon.Star=function Polygon_Star(count,innerRadius,outerRadius){jayus.debug.matchArgumentsAs("Polygon.Star",arguments,4,"count","innerRadius","outerRadius");var i,poly=new jayus.Polygon,angle=0,step=Math.PI/count,atInner=true,radius=innerRadius;for(i=0;i<count*2;i++){poly.addPoint(radius*Math.cos(angle),radius*Math.sin(angle));radius+=atInner?outerRadius:innerRadius;atInner=!atInner;angle+=step}return poly};jayus.debug.className="Path";
jayus.Path=jayus.Shape.extend({shapeType:16,segments:null,x1:0,y1:0,x2:0,y2:0,frame:null,frameDirty:true,init:function Path_init(pathString){this.segments=[];if(arguments.length){jayus.debug.match("Path.init",pathString,"pathString",2);this.addSVS(pathString)}},translate:function Path_translate(x,y){jayus.debug.matchCoordinate("Path.translate",x,y);if(arguments.length===1){y=x.y;x=x.x}for(var i=0;i<this.segments.length;i++)this.moveSegment(i,x,y);return this},alignToCanvas:function Path_alignToCanvas(){return this},getScope:function Path_getScope(){if(this.segments.length===
0)return null;this.reformFrame();return new jayus.Rectangle(this.x1,this.y1,this.x2-this.x1,this.y2-this.y1)},reformFrame:function Path_reformFrame(){var i,x,y,point,x1=null,x2=null,y1=null,y2=null;for(i=0;i<this.segments.length;i++){point=this.getPoint(i);x=point.x;y=point.y;if(x1===null||x<x1)x1=x;if(x2===null||x>x2)x2=x;if(y1===null||y<y1)y1=y;if(y2===null||y>y2)y2=y}this.x1=x1;this.x2=x2;this.y1=y1;this.y2=y2},intersectsAt:function Path_intersectsAt(x,y){jayus.debug.matchCoordinate("Path.intersectsAt",
x,y);var ctx=jayus.getContext();ctx.save();this.etchOntoContext(ctx);var ret=ctx.isPointInPath(x,y);ctx.restore();return ret},moveTo:function Path_moveTo(x,y){jayus.debug.matchArgumentsAs("Path.moveTo",arguments,4,"x","y");return this.addSegment(["moveTo",x,y])},moveBy:function Path_moveBy(x,y){jayus.debug.matchArgumentsAs("Path.moveBy",arguments,4,"x","y");var pos=this.getCurrentPoint();return this.moveTo(pos.x+x,pos.y+y)},closePath:function Path_closePath(){return this.addSegment(["closePath"])},
lineTo:function Path_lineTo(x,y){jayus.debug.matchArgumentsAs("Path.lineTo",arguments,4,"x","y");return this.addSegment(["lineTo",x,y])},lineBy:function Path_lineBy(x,y){jayus.debug.matchArgumentsAs("Path.lineBy",arguments,4,"x","y");var pos=this.getCurrentPoint();return this.lineTo(pos.x+x,pos.y+y)},quadraticCurveTo:function Path_quadraticCurveTo(cpx,cpy,x,y){jayus.debug.matchArgumentsAs("Path.quadraticCurveTo",arguments,4,"cpx","cpy","x","y");return this.addSegment(["quadraticCurveTo",cpx,cpy,x,
y])},quadraticCurveBy:function Path_quadraticCurveBy(cpx,cpy,x,y){jayus.debug.matchArgumentsAs("Path.quadraticCurveBy",arguments,4,"cpx","cpy","x","y");var pos=this.getCurrentPoint();return this.quadraticCurveTo(pos.x+cpx,pos.y+cpy,pos.x+x,pos.y+y)},bezierCurveTo:function Path_bezierCurveTo(cp1x,cp1y,cp2x,cp2y,x,y){jayus.debug.matchArgumentsAs("Path.bezierCurveTo",arguments,4,"cp1x","cp1y","cp2x","cp2y","x","y");return this.addSegment(["bezierCurveTo",cp1x,cp1y,cp2x,cp2y,x,y])},bezierCurveBy:function Path_bezierCurveBy(cp1x,
cp1y,cp2x,cp2y,x,y){jayus.debug.matchArgumentsAs("Path.bezierCurveBy",arguments,4,"cp1x","cp1y","cp2x","cp2y","x","y");var pos=this.getCurrentPoint();return this.bezierCurveTo(pos.x+cp1x,pos.y+cp1y,pos.x+cp2x,pos.y+cp2y,pos.x+x,pos.y+y)},arcTo:function Path_arcTo(x1,y1,x2,y2,radius){jayus.debug.matchArgumentsAs("Path.arcTo",arguments,4,"x1","y1","x2","y2","radius");return this.addSegment(["arcTo",x1,y1,x2,y2,radius])},arcBy:function Path_arcBy(x1,y1,x2,y2,radius){jayus.debug.matchArgumentsAs("Path.arcBy",
arguments,4,"x1","y1","x2","y2","radius");var pos=this.getCurrentPoint();return this.arcTo(pos.x+x1,pos.y+y1,pos.x+x2,pos.y+y2,radius)},arc:function Path_arc(x,y,radius,startAngle,endAngle,anticlockwise){jayus.debug.matchArguments("Path.arc",arguments,"x",4,"y",4,"radius",4,"startAngle",4,"endAngle",4,"anticlockwise",1);return this.addSegment(["arc",x,y,radius,startAngle,endAngle,anticlockwise])},rect:function Path_rect(x,y,width,height){jayus.debug.matchArgumentsAs("Path.rect",arguments,4,"x","y",
"width","height");return this.addSegment(["rect",x,y,width,height])},ellipse:function Path_ellipse(x,y,radiusX,radiusY,rotation,startAngle,endAngle,anticlockwise){jayus.debug.matchArguments("Path.ellipse",arguments,"x",4,"y",4,"radiusX",4,"radiusY",4,"startAngle",4,"endAngle",4,"anticlockwise",1);return this.addSegment(["ellipse",x,y,radiusX,radiusY,startAngle,endAngle,anticlockwise])},horizontalLineTo:function Path_horizontalLineTo(x){jayus.debug.match("Path.horizontalLineTo",x,"x",4);return this.lineTo(x,
this.getCurrentPoint().y)},horizontalLineBy:function Path_horizontalLineBy(x){jayus.debug.match("Path.horizontalLineBy",x,"x",4);return this.lineBy(x,0)},verticalLineTo:function Path_verticalLineTo(y){jayus.debug.match("Path.verticalLineTo",y,"y",4);return this.lineTo(this.getCurrentPoint().x,y)},verticalLineBy:function Path_verticalLineBy(y){jayus.debug.match("Path.verticalLineBy",y,"y",4);return this.lineBy(0,y)},addSegment:function Path_addSegment(data){this.segments.push(data);return this},getInitialPoint:function Path_getInitialPoint(){return this.getPoint(0)},
getCurrentPoint:function Path_getCurrentPoint(){return this.getPoint(this.segments.length-1)},getPoint:function Path_getPoint(index){if(this.hasPointIndex(index)){var segment=this.segments[index];switch(segment[0]){case "moveTo":return new jayus.Point(segment[1],segment[2]);case "closePath":return this.getInitialPoint();case "lineTo":return new jayus.Point(segment[1],segment[2]);case "quadraticCurveTo":return new jayus.Point(segment[3],segment[4]);case "bezierCurveTo":return new jayus.Point(segment[5],
segment[6]);case "arcTo":return jayus.getFinalArcToPoint(this,segment);case "arc":var cx=segment[1],cy=segment[2],r=segment[3],startAngle=segment[4],endAngle=segment[5],anticlockwise=segment[6];return new jayus.Point(cx+r*Math.cos(endAngle),cy+r*Math.sin(endAngle));case "rect":return this.getPoint(index-1);case "ellipse":throw new Error('Path.getPoint() - Unimplemented for "ellipse"');}}else throw new RangeError("Path.getPoint() - Invalid index sent: "+index);},addSVG:function Path_addSVG(path){var i,
segment,data=this.parsePathString(path);for(i=0;i<data.length;i++){segment=data[i];switch(segment[0]){case "M":this.moveTo(segment[1],segment[2]);break;case "m":this.moveBy(segment[1],segment[2]);break;case "Z":case "z":this.closePath();break;case "L":this.lineTo(segment[1],segment[2]);break;case "l":this.lineBy(segment[1],segment[2]);break;case "H":this.horizontalLineTo(segment[1]);break;case "h":this.horizontalLineBy(segment[1]);break;case "V":this.verticalLineTo(segment[1]);break;case "v":this.verticalLineBy(segment[1]);
break;case "C":this.bezierCurveTo(segment[1],segment[2],segment[3],segment[4],segment[5],segment[6]);break;case "c":this.bezierCurveBy(segment[1],segment[2],segment[3],segment[4],segment[5],segment[6]);break;case "S":case "s":throw new Error("Path.addSVG() - Unimplemented for S/s commands");case "Q":this.quadraticCurveTo(segment[1],segment[2],segment[3],segment[4]);break;case "q":this.quadraticCurveBy(segment[1],segment[2],segment[3],segment[4]);break;case "T":case "t":throw new Error("Path.addSVG() - Unimplemented for T/t commands");
case "A":case "a":throw new Error("Path.addSVG() - Unimplemented for A/a commands");case "R":case "r":throw new Error("Path.addSVG() - Unimplemented for R/r commands");}}},parsePathString:function Path_parsePathString(path){path=path.replace(/ /g,",").replace(/-/g,",-");path=path.replace(/[MmZzLlHhVvCcSsQqTtAaRr]/g,function(match){return","+match+","});path=path.split(",");var i,item,paramCounts={a:7,c:6,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,z:0},segment,data=[],paramsNeeded=0;for(i=0;i<path.length;i++){item=
path[i];if(item!=="")if(paramsNeeded===0)if(paramCounts.hasOwnProperty(item.toLowerCase())){segment=[item];paramsNeeded=paramCounts[item.toLowerCase()];data.push(segment)}else return"ERROR: expected command, got: "+item;else{var param=parseFloat(item);if(!isNaN(param)){segment.push(param);paramsNeeded--}else return"ERROR: expected parameter, got: "+item}}return data},getSegmentCount:function Path_getSegmentCount(){return this.segments.length},hasPointIndex:function Path_hasPointIndex(index){jayus.debug.match("Path.hasPointIndex",
index,"index",4);return 0<=index&&index<this.segments.length},isClosed:function Path_isClosed(){return this.getInitialPoint().equals(this.getCurrentPoint())},toString:function Path_toString(){var i,str="(Path:[";for(i=0;i<this.getSegmentCount();i++)str+=jayus.debug.toString(this.segments[i]);return str+"])"},clone:function Path_clone(){var i,j,segment,newSegment,newSegments=[];for(i=0;i<this.segments.length;i++){segment=this.segments[i];newSegment=[];for(j=0;j<segment.length;j++)newSegment.push(segment[j]);
newSegments.push(newSegment)}var path=new jayus.Path;path.segments=newSegments;return path},getTransformed:function Path_getTransformed(matrix){var i,segment,newSegment,temp,newSegments=[];for(i=0;i<this.segments.length;i++){segment=this.segments[i];newSegment=[segment[0]];newSegments.push(newSegment);switch(segment[0]){case "moveTo":temp=matrix.transformPoint(segment[1],segment[2]);newSegment[1]=temp.x;newSegment[2]=temp.y;break;case "closePath":break;case "lineTo":temp=matrix.transformPoint(segment[1],
segment[2]);newSegment[1]=temp.x;newSegment[2]=temp.y;break;case "quadraticCurveTo":temp=matrix.transformPoint(segment[1],segment[2]);newSegment[1]=temp.x;newSegment[2]=temp.y;temp=matrix.transformPoint(segment[3],segment[4]);newSegment[3]=temp.x;newSegment[4]=temp.y;break;case "bezierCurveTo":temp=matrix.transformPoint(segment[1],segment[2]);newSegment[1]=temp.x;newSegment[2]=temp.y;temp=matrix.transformPoint(segment[3],segment[4]);newSegment[3]=temp.x;newSegment[4]=temp.y;temp=matrix.transformPoint(segment[5],
segment[6]);newSegment[5]=temp.x;newSegment[6]=temp.y;break;case "arcTo":case "arc":case "rect":case "ellipse":throw new Error("Path.getTransformed() - Unimplemented for command "+segment[0]);}}},etchOntoContext:function Path_etchOntoContext(ctx){ctx.beginPath();var i,segment,point=this.getPoint(0),x=point.x,y=point.y;for(i=0;i<this.segments.length;i++){segment=this.segments[i];switch(segment[0]){case "moveTo":x=segment[1];y=segment[2];ctx.moveTo(x,y);break;case "closePath":ctx.closePath();break;
case "lineTo":x=segment[1];y=segment[2];ctx.lineTo(x,y);break;case "bezierCurveTo":x=segment[5];y=segment[6];ctx.bezierCurveTo(segment[1],segment[2],segment[3],segment[4],x,y);break;case "quadraticCurveTo":x=segment[3];y=segment[4];ctx.quadraticCurveTo(segment[1],segment[2],x,y);break;case "arcTo":ctx.arcTo(segment[1],segment[2],segment[3],segment[4],segment[5]);point=this.getPoint(i);x=point.x;y=point.y;break;case "arc":ctx.arc(segment[1],segment[2],segment[3],segment[4],segment[5],segment[6]);point=
this.getPoint(i);x=point.x;y=point.y;break;case "rect":x=segment[1];y=segment[2];ctx.rect(x,y,segment[3],segment[4]);break;case "ellipse":throw new Error("Path.etchOntoContext() - Unimplemented for command ellipse");}}return this}});
jayus.Path.Circle=function Path_Circle(x,y,radius){if(arguments.length===2){jayus.debug.matchArguments("Path.Circle()",arguments,"center",13,"radius",4);radius=x;y=x.y;x=x.x}else jayus.debug.matchArgumentsAs("Path.Circle()",arguments,4,"x","y","radius");return(new jayus.Path).arc(x,y,radius,0,Math.PI*2,false)};
jayus.Path.Rectangle=function Path_Rectangle(x,y,width,height){if(arguments.length===3){jayus.debug.matchArguments("Path.Rectangle()",arguments,"origin",13,"width",4,"height",4);height=width;width=y;y=x.y;x=x.x}else jayus.debug.matchArgumentsAs("Path.Rectangle()",arguments,4,"x","y","width","height");return(new jayus.Path).rect(x,y,width,height)};
jayus.getFinalArcToPoint=function jayus_getFinalArcToPoint(path,segment){var p0=path.getPoint(segment-1);var x0=p0.x,y0=p0.y,x1=segment[1],y1=segment[2],x2=segment[3],y2=segment[4],r=segment[5];var angle1=Math.atan2(y0-y1,x0-x1),angle2=Math.atan2(y1-y2,x1-x2);var abs=Math.abs(angle1-angle2);var angleDiff=Math.min(Math.PI*2-abs,abs);var u=angleDiff/2;var z=r/Math.tan(u);var x=x1+z*Math.cos(angle2);var y=y1+z*Math.sin(angle2);return new jayus.Point(x,y)};
jayus.getPathScope=function jayus_getPathScope(path){var i,segment,scope=new jayus.Rectangle;for(i=0;i<path.segments.length;i++){segment=path.segments[i];switch(segment[0]){case "moveTo":scope.includeAt(segment[1],segment[2]);break;case "closePath":break;case "lineTo":scope.includeAt(segment[1],segment[2]);break;case "bezierCurveTo":scope.includeAt(segment[1],segment[2]);scope.includeAt(segment[3],segment[4]);scope.includeAt(segment[5],segment[6]);break;case "quadraticCurveTo":scope.includeAt(segment[1],
segment[2]);scope.includeAt(segment[3],segment[4]);break;case "arcTo":break;case "arc":break;case "rect":var x=segment[1],y=segment[2],w=segment[3],h=segment[4];scope.setLeft(Math.max(scope.getLeft(),x));scope.setRight(Math.max(scope.getRight(),x+w));scope.setTop(Math.max(scope.getTop(),y));scope.setBottom(Math.max(scope.getBottom(),y+h));break;case "ellipse":break}}};jayus.debug.className="Entity";jayus.applyObject(jayus.Dependency.prototype,jayus.Responder.prototype);
jayus.Entity=jayus.Responder.extend({componentType:"ENTITY",shapeType:0,isEntity:true,isRect:false,isParent:false,id:"",visible:true,alpha:1,dirtied:true,frozen:0,hasParent:false,parent:null,angle:0,xScale:1,yScale:1,xAnchor:0,yAnchor:0,trackCursor:true,canAcceptCursor:false,canReleaseCursor:true,underCursor:false,hasCursor:false,draggable:false,dragButton:"left",dragging:false,enableDragEvents:true,leftDragging:false,middleDragging:false,rightDragging:false,debugRenderer:null,exposingAll:false,expose:function Entity_expose(){this.debugRenderer=
jayus.debug.defaultDebugRenderer;this.dirty(jayus.DIRTY.ALL)},unexpose:function Entity_unexpose(){this.debugRenderer=null;this.dirty(jayus.DIRTY.ALL)},exposeAll:function Entity_exposeAll(){this.debugRenderer=jayus.debug.defaultDebugRenderer;this.exposingAll=true;if(this.isParent)this.forEachChild(function(){this.exposeAll()});this.dirty(jayus.DIRTY.ALL)},unexposeAll:function Entity_exposeAll(){this.debugRenderer=null;this.exposingAll=false;if(this.isParent)this.forEachChild(function(){this.unexposeAll()});
this.dirty(jayus.DIRTY.ALL)},isTransformed:false,transforms:null,init:function Entity_init(){if(this.enableDragEvents)this.handle({leftPress:function(e){this.leftDragging=true;return this.fire("leftDragStart",e)},leftRelease:function(e){if(this.leftDragging){this.leftDragging=false;return this.fire("leftDragEnd",e)}},middlePress:function(e){this.middleDragging=true;return this.fire("middleDragStart",e)},middleRelease:function(e){if(this.middleDragging){this.middleDragging=false;return this.fire("middleDragEnd",
e)}},rightPress:function(e){this.rightDragging=true;return this.fire("rightDragStart",e)},rightRelease:function(e){if(this.rightDragging){this.rightDragging=false;return this.fire("rightDragEnd",e)}},cursorMove:function(e){var ret=false;if(this.leftDragging)ret=this.fire("leftDrag",e)||ret;if(this.middleDragging)ret=this.fire("middleDrag",e)||ret;if(this.rightDragging)ret=this.fire("rightDrag",e)||ret;return ret},cursorOut:function(){if(this.leftDragging)this.fire("leftDragEnd");if(this.middleDragging)this.fire("middleDragEnd");
if(this.rightDragging)this.fire("rightDragEnd");this.leftDragging=this.middleDragging=this.rightDragging=false}})},setId:function Entity_setId(id){jayus.debug.match("Entity.setId",id,"id",0);this.id=id;return this},dirty:function Entity_dirty(type){if(typeof type!=="number")throw new Error("Entity.dirty() - No type specified");if(!this.frozen){if(type&2){this.matrixDirty=true;this.fire("moved")}this.dirtied=true;this.informDependents(type)}return this},getAbsoluteParent:function Entity_getAbsoluteParent(){return this.hasParent?
this.parent.getAbsoluteParent():this},setParent:function Entity_setParent(parent){if(this.hasParent)throw new Error("Entity.setParent() - Entity already has a parent");if(parent.exposingAll)this.expose();this.hasParent=true;this.parent=parent;this.attach(parent);this.fire("added")},removeParent:function Entity_removeParent(){this.hasParent=false;this.parent=null;this.underCursor=false;this.detach(parent);this.fire("removed")},setVisible:function Entity_setVisible(on){jayus.debug.match("Entity.setVisible",
on,"on",1);if(this.visible!==on){this.visible=on;this.dirty(1)}return this},show:function Entity_show(){return this.setVisible(true)},hide:function Entity_hide(){return this.setVisible(false)},setAlpha:function Entity_setAlpha(alpha){jayus.debug.match("Entity.setAlpha",alpha,"alpha",4);if(this.actionsToAnimate){this.actionsToAnimate--;return new jayus.MethodAnimator(this,this.setAlpha,this.alpha,alpha)}if(this.alpha!==alpha){this.alpha=alpha;this.dirty(16)}return this},updateCursor:function Entity_updateCursor(x,
y){if(this.underCursor)if(!this.intersectsAt(x,y)){this.underCursor=false;this.fire("cursorOut");if(this.isParent)this.removeCursorFromChildren()}else{if(this.isParent)this.updateCursorOnChildren(x,y)}else if(this.intersectsAt(x,y)){this.underCursor=true;this.fire("cursorOver");if(this.isParent)this.updateCursorOnChildren(x,y)}},removeCursor:function Entity_removeCursor(){if(this.underCursor){this.underCursor=false;this.fire("cursorOut");if(this.isParent)this.removeCursorFromChildren()}},setDragButton:function Entity_setDragButton(button){if(this.dragButton!==
button){this.dragButton=button;if(this.draggable){this.setDraggable(false);this.setDraggable(true)}}return this},setDraggable:function Entity_setDraggable(on){jayus.debug.match("Entity.setDraggable",on,"on",1);if(!this.draggable&&on){this.addHandler(this.dragButton+"Press",function(e){this.dragging=true;this.canReleaseCursor=false;this.fire("dragStart");jayus.interceptNextEvent(this.dragButton+"Release",function(e){this.dragging=false;this.canReleaseCursor=true;this.display.updateCursor(this.display.cursor.x,
this.display.cursor.y)},{context:this});this.display=e.display;var that=this;var dragHandler=function(e){if(that.dragging)that.translate(e.deltaX,e.deltaY);else that.display.removeHandler("cursorMove","dragHandler");return true};e.display.addHandler("cursorMove",dragHandler,{id:"dragHandler"})});this.draggable=true}else if(this.draggable&&!on);return this},matrix:null,matrixDirty:true,getMatrix:function Entity_getMatrix(){if(this.matrixDirty){if(this.matrix===null)this.matrix=new jayus.Matrix;else this.matrix.identity();
this.applyTransforms(this.matrix);this.matrixDirty=false}return this.matrix},applyTransforms:function Entity_applyTransforms(ctx){if(this.isTransformed)if(this.xAnchor||this.yAnchor){ctx.translate(this.xAnchor,this.yAnchor);if(this.xScale!==1||this.yScale!==1)ctx.scale(this.xScale,this.yScale);if(this.angle!==0)ctx.rotate(this.angle);ctx.translate(-this.xAnchor,-this.yAnchor)}else{if(this.xScale!==1||this.yScale!==1)ctx.scale(this.xScale,this.yScale);if(this.angle!==0)ctx.rotate(this.angle)}return this},
setAngle:function Entity_setAngle(angle){jayus.debug.match("Entity.setAngle",angle,"angle",4);if(this.actionsToAnimate){this.actionsToAnimate--;return jayus.MethodAnimator(this,this.setAngle,this.angle,angle)}if(this.angle!==angle){this.angle=angle;this.isTransformed=true;this.matrixDirty=true;this.dirty(8)}return this},rotate:function Entity_rotate(angle){jayus.debug.match("Entity.rotate",angle,"angle",4);return this.setAngle(this.angle+angle)},setScale:function Entity_setScale(x,y){if(arguments.length===
1)y=x;if(this.actionsToAnimate){this.actionsToAnimate--;return new jayus.MethodAnimator(this,this.setScale,[this.xScale,this.yScale],[x,y])}if(this.xScale!==x||this.yScale!==y){this.xScale=x;this.yScale=y;this.isTransformed=true;this.matrixDirty=true;this.dirty(8)}return this},scale:function Entity_scale(x,y){if(arguments.length===1){jayus.debug.match("Entity.scale",x,"scale",4);y=x}else jayus.debug.matchArgumentsAs("Entity.scale",arguments,4,"x","y");return this.setScale(this.xScale*x,this.yScale*
y)},setAnchor:function Entity_setAnchor(x,y){jayus.debug.matchCoordinate("Entity.setAnchor",x,y);if(arguments.length===1){y=x.y;x=x.x}if(this.xAnchor!==x||this.yAnchor!==y){this.xAnchor=x;this.yAnchor=y;this.matrixDirty=true;this.dirty(8)}return this},screenToLocal:function Entity_screenToLocal(x,y){jayus.debug.matchCoordinate("Entity.screenToLocal",x,y);if(arguments.length===1){y=x.y;x=x.x}if(this.hasParent){var pos=this.parent.screenToLocal(x,y);return this.parentToLocal(pos)}return new jayus.Point(x,
y)},parentToLocal:function Entity_parentToLocal(x,y){jayus.debug.matchCoordinate("Entity.parentToLocal",x,y);if(arguments.length===1){y=x.y;x=x.x}if(this.hasParent){x-=this.x;y-=this.y;x/=this.xScale;y/=this.yScale;if(this.angle!==0){var x2=x,y2=y,cos=Math.cos(this.angle),sin=Math.sin(this.angle);x=cos*x2-sin*y2;y=cos*y2+sin*x2}}return new jayus.Point(x,y)},localToScreen:function Entity_localToScreen(x,y){jayus.debug.matchCoordinate("Entity.localToScreen",x,y);if(arguments.length===1){y=x.y;x=x.x}if(this.hasParent)return this.parent.localToScreen(this.localToParent(x,
y));return new jayus.Point(x,y)},localToScreenOnto:function Entity_localToScreenOnto(x,y,ret){jayus.debug.matchArguments("Entity.localToScreenOnto",arguments,"x",4,"y",4,"ret",13);if(this.hasParent){this.localToParentOnto(x,y,ret);this.parent.localToScreenOnto(ret.x,ret.y,ret)}else{ret.x=x;ret.y=y}return ret},localToParent:function Entity_localToParent(x,y){jayus.debug.matchCoordinate("Entity.localToParent",x,y);if(arguments.length===1){y=x.y;x=x.x}var ret=new jayus.Point;this.localToParentOnto(x,
y,ret);return ret},localToParentOnto:function Entity_localToParentOnto(x,y,ret){jayus.debug.matchArguments("Entity.localToParentOnto",arguments,"x",4,"y",4,"ret",13);if(this.angle!==0){var x2=x,y2=y,cos=Math.cos(this.angle),sin=Math.sin(this.angle);x=cos*x2-sin*y2;y=cos*y2+sin*x2}x*=this.xScale;y*=this.yScale;x+=this.x;y+=this.y;ret.x=x;ret.y=y;return ret},localToParentOntoORIGINAL:function Entity_localToParentOntoORIGINAL(x,y,ret){jayus.debug.matchArguments("Entity.localToParentOntoORIGINAL",arguments,
"x",4,"y",4,"ret",13);if(this.hasParent){if(this.angle!==0){var x2=x,y2=y,cos=Math.cos(this.angle),sin=Math.sin(this.angle);x=cos*x2-sin*y2;y=cos*y2+sin*x2}x*=this.xScale;y*=this.yScale;x+=this.x;y+=this.y}ret.x=x;ret.y=y;return ret},running:false,xVelocity:0,yVelocity:0,setVelocity:function Entity_setVelocity(x,y){jayus.debug.matchCoordinate("Entity.setVelocity",x,y);if(arguments.length===1){y=x.y;x=x.x}this.xVelocity=x;this.yVelocity=y;if(!this.running){jayus.animators.push(this);this.running=true}},
clearVelocity:function Entity_clearVelocity(){this.velocity=null;jayus.animators.splice(jayus.animators.indexOf(this),1);this.running=false},tick:function Entity_tick(now,elapsed){this.translate(this.xVelocity*elapsed,this.yVelocity*elapsed)},intersects:function Entity_intersects(object){return jayus.intersectTest(this,object)},intersectCount:function Entity_intersectCount(entities){jayus.debug.matchArray("Entity.intersectCount",entities,"entities",12);if(!entities.length)throw new RangeError("Entity.intersectCount() - Invalid entities"+
jayus.debug.toString(entities)+" sent, length of at least 1 required");var i,count=0;for(i=0;i<entities.length;i++)if(jayus.intersectTest(this,entities[i]))count++;return count},intersectsAny:function Entity_intersectsAny(entities){if(entities instanceof jayus.List)entities=entities.items;jayus.debug.matchArray("Entity.intersectsAny",entities,"entities",12);for(var i=0;i<entities.length;i++)if(jayus.intersectTest(this,entities[i]))return true;return false},intersectsAll:function Entity_intersectsAll(entities){if(entities instanceof
jayus.List)entities=entities.items;jayus.debug.matchArray("Entity.intersectsAll",entities,"entities",12);if(!entities.length)throw new RangeError("Entity.intersectsAll() - Invalid entities"+jayus.debug.toString(entities)+" sent, length of at least 1 required");for(var i=0;i<entities.length;i++)if(!jayus.intersectTest(this,entities[i]))return false;return true},intersectsWhich:function Entity_intersectsWhich(entities){if(entities instanceof jayus.List)entities=entities.items;jayus.debug.matchArray("Entity.intersectsWhich",
entities,"entities",12);var i,ret=[];for(i=0;i<entities.length;i++)if(jayus.intersectTest(this,entities[i]))ret.push(entities[i]);return ret},rasterize:function Entity_rasterize(){var scope=this.getScope(),surface=new jayus.Surface(scope.width,scope.height),x=this.x,y=this.y;this.x=0;this.y=0;this.drawOnto(surface);this.x=x;this.y=y;return surface},drawOnto:function Entity_drawOnto(surface){var ctx=surface.context;ctx.save();this.drawOntoContext(ctx,0,0);ctx.restore();return this}});
jayus.applyObject(jayus.Animatable.prototype,jayus.Entity.prototype);jayus.debug.className="RectEntity";
jayus.RectEntity=jayus.Entity.extend({shapeType:4,isRect:true,x:0,y:0,width:0,height:0,bg:null,hasBg:false,alignBg:false,bounds:null,boundsClone:null,body:null,setX:jayus.Rectangle.prototype.setX,setY:jayus.Rectangle.prototype.setY,getOrigin:jayus.Rectangle.prototype.getOrigin,setOrigin:jayus.Rectangle.prototype.setOrigin,translate:jayus.Rectangle.prototype.translate,getLeft:jayus.Rectangle.prototype.getLeft,getRight:jayus.Rectangle.prototype.getRight,getTop:jayus.Rectangle.prototype.getTop,getBottom:jayus.Rectangle.prototype.getBottom,
setLeft:jayus.Rectangle.prototype.setLeft,setRight:jayus.Rectangle.prototype.setRight,setTop:jayus.Rectangle.prototype.setTop,setBottom:jayus.Rectangle.prototype.setBottom,getPosAt:function RectEntity_getPosAt(anchorX,anchorY){jayus.debug.matchCoordinate("RectEntity.getPosAt",anchorX,anchorY);if(arguments.length===1){anchorY=anchorX.y;anchorX=anchorX.x}return this.localToParent(anchorX*this.width,anchorY*this.height)},setPosAt:function RectEntity_setPosAt(anchorX,anchorY,x,y){if(arguments.length===
3){y=x.y;x=x.x}jayus.debug.matchArgumentsAs("RectEntity.setPosAt",[anchorX,anchorY,x,y],4,"anchorX","anchorY","x","y");return this.translate(x-(this.x+anchorX*this.width),y-(this.y+anchorY*this.height))},setRelativeAnchor:function Entity_setRelativeAnchor(x,y){jayus.debug.matchCoordinate("RectEntity.setRelativeAnchor",x,y);if(arguments.length===1){y=x.y;x=x.x}return this.setAnchor(this.width*x,this.height*y)},setBody:function RectEntity_setBody(body){jayus.debug.match("RectEntity.setBody",body,"body",
5);if(this.body!==null)delete this.body.entity;else{jayus.box2d.physicalEntities.push(this);this.setAnchor(this.width/2,this.height/2)}this.body=body;this.body.entity=this;return this},removeBody:function RectEntity_removeBody(){if(this.body!==null){delete this.body.entity;this.body=null;jayus.box2d.physicalEntities.splice(jayus.box2d.physicalEntities.indexOf(this))}return this},updateFromBody:function RectEntity_updateFromBody(){var awake=this.body.IsAwake();if(awake){var pos=this.body.GetPosition();
this.setPosAt(0.5,0.5,pos.x,pos.y);this.angle=this.body.GetAngle();this.matrixDirty=true}},changeSize:function RectEntity_changeSize(width,height){if(width!==this.width||height!==this.height){if(typeof this.formContents==="function")this.formContents(width,height);this.width=width;this.height=height;this.fire("resized");this.dirty(4)}},setWidth:function RectEntity_setWidth(width){jayus.debug.match("RectEntity.setWidth",width,"width",4);if(this.hasFlexibleWidth()){if(width!==this.width)this.changeSize(width,
this.height);return this}throw new Error("RectEntity.setWidth() - Entity width is not flexible");},setHeight:function RectEntity_setHeight(height){jayus.debug.match("RectEntity.setHeight",height,"height",4);if(this.hasFlexibleHeight()){if(height!==this.height)this.changeSize(this.width,height);return this}throw new Error("RectEntity.setHeight() - Entity height is not flexible");},setSize:function RectEntity_setSize(width,height){jayus.debug.matchSize("RectEntity.setSize",width,height);if(arguments.length===
1){height=width.height;width=width.width}if(this.hasFlexibleWidth()&&this.hasFlexibleHeight()){this.changeSize(width,height);return this}throw new Error("RectEntity.setSize() - Entity size is not flexible");},setSizeFromParent:function(width,height){this.frozen--;this.setSize(width,height);this.frozen++},intersectsAt:function RectEntity_intersectsAt(x,y){return this.getBounds().intersectsAt(x,y);if(this.bounds!==null)return this.boundsClone.intersectsAt(x,y);if(this.isTransformed)return this.getFrame().intersectsAt(x,
y);return this.x<=x&&x<=this.x+this.width&&this.y<=y&&y<=this.y+this.height},getUnFrame:function RectEntity_getUnFrame(){return new jayus.Rectangle(this.x,this.y,this.width,this.height)},getFrame:function RectEntity_getFrame(){if(this.isTransformed)return(new jayus.Polygon.Rectangle(0,0,this.width,this.height)).transform(this.getMatrix());return new jayus.Rectangle(this.x,this.y,this.width,this.height)},getScope:function RectEntity_getScope(){return this.getFrame().getScope()},getBounds:function RectEntity_getBounds(){if(this.bounds!==
null){this.bounds.cloneOnto(this.boundsClone);return this.boundsClone.translate(this.x,this.y)}return this.getFrame().getScope()},setBounds:function RectEntity_setBounds(shape){jayus.debug.match("RectEntity.setBounds",shape,"shape",19);if(this.bounds!==null)this.bounds.detach(this);this.bounds=shape;this.bounds.attach(this);this.boundsClone=this.bounds.clone();this.shapeType=0;return this},clearBounds:function RectEntity_clearBounds(){if(this.bounds!==null){this.bounds.detach(this);this.bounds=null;
this.boundsClone=null;this.shapeType=4}return this},componentDirtied:function RectEntity_componentDirtied(componentType,component,type){if(component===this.bounds)this.bounds.cloneOnto(this.boundsClone)},setBg:function RectEntity_setBg(brush){jayus.debug.match("RectEntity.setBg",brush,"brush",5);if(this.hasBg)this.bg.detach(this);if(!(brush instanceof jayus.Brush))brush=new jayus.Brush(brush);this.bg=brush;this.bg.attach(this);this.hasBg=true;return this.dirty(jayus.DIRTY.BACKGROUND)},clearBg:function RectEntity_clearBg(){if(this.hasBg){this.bg.detach(this);
this.bg=null;this.hasBg=false;this.dirty(jayus.DIRTY.BACKGROUND)}return this},buffered:false,bufferBg:true,canvas:null,context:null,setBuffering:function RectEntity_setBuffering(on){jayus.debug.match("RectEntity.setBuffering",on,"on",1);if(!this.buffered&&on){this.canvas=document.createElement("canvas");this.context=this.canvas.getContext("2d");this.refreshBuffer()}else if(this.buffered&&!on){this.canvas=null;this.context=null}this.buffered=on;return this},refreshBuffer:function RectEntity_refreshBuffer(){if(this.buffered){var canvas=
this.canvas;if(this.width!==canvas.width||this.height!==canvas.height){canvas.width=this.width;canvas.height=this.height}this.fullyRefreshBuffer()}},fullyRefreshBuffer:function RectEntity_fullyRefreshBuffer(){if(this.buffered){var ctx=this.context;ctx.clearRect(0,0,this.width,this.height);ctx.save();if(this.bufferBg&&this.hasBg)this.bg.paintRect(ctx,0,0,this.width,this.height);this.paintContents(ctx);ctx.restore();if(this.showDamage)this.paintDamage(this)}},keepAligned:false,applyTransforms:function RectEntity_applyTransforms(ctx){if(this.xScale!==
1||this.yScale!==1||this.angle)if(this.xAnchor||this.yAnchor){if(this.keepAligned)ctx.translate(Math.round(this.x)+this.xAnchor,Math.round(this.y)+this.yAnchor);else ctx.translate(this.x+this.xAnchor,this.y+this.yAnchor);if(this.xScale!==1||this.yScale!==1)ctx.scale(this.xScale,this.yScale);if(this.angle!==0)ctx.rotate(this.angle);ctx.translate(-this.xAnchor,-this.yAnchor)}else{if(this.keepAligned)ctx.translate(Math.round(this.x),Math.round(this.y));else ctx.translate(this.x,this.y);if(this.xScale!==
1||this.yScale!==1)ctx.scale(this.xScale,this.yScale);if(this.angle!==0)ctx.rotate(this.angle)}else if(this.x||this.y)if(this.keepAligned)ctx.translate(Math.round(this.x),Math.round(this.y));else ctx.translate(this.x,this.y);return this},drawOntoContext:function RectEntity_drawOntoContext(ctx){jayus.debug.matchContext("RectEntity.drawOntoContext",ctx);ctx.save();if(this.alpha!==1)ctx.globalAlpha*=this.alpha;this.applyTransforms(ctx);if(this.buffered){if(this.dirtied)this.refreshBuffer();if(!this.bufferBg&&
this.hasBg)if(this.alignBg)this.bg.paintRect(ctx,0.5,0.5,Math.round(this.width),Math.round(this.height));else this.bg.paintRect(ctx,0,0,this.width,this.height);ctx.drawImage(this.canvas,0,0)}else{if(this.hasBg)if(this.alignBg)this.bg.paintRect(ctx,0.5,0.5,Math.round(this.width),Math.round(this.height));else this.bg.paintRect(ctx,0,0,this.width,this.height);this.paintContents(ctx)}this.dirtied=false;ctx.restore();if(this.debugRenderer!==null)this.debugRenderer(ctx);return this}});jayus.debug.className="PaintedShape";
jayus.PaintedShape=jayus.Entity.extend({shape:null,brush:null,hasBrush:false,init:function PaintedShape_init(shape,brush){jayus.Entity.prototype.init.apply(this);this.shape=shape;shape.attach(this);if(brush!==undefined)this.setBrush(brush)},componentDirtied:function PaintedShape_componentDirtied(componentType,component,type){this.dirty(16)},translate:function PaintedShape_translate(x,y){this.shape.translate.call(this.shape,x,y);this.dirty(2)},intersectsAt:function PaintedShape_intersectsAt(x,y){if(this.isTransformed){var pos=
this.getMatrix().inverseTransformPoint(x,y);x=pos.x;y=pos.y}return this.shape.intersectsAt(x,y)},setShape:function PaintedShape_setShape(shape){jayus.debug.match("PaintedShape.setShape",shape,"shape",19);if(this.shape!==shape){this.shape.detach(this);this.shape=shape;shape.attach(this);this.dirty(jayus.DIRTY.ALL)}return this},setBrush:function PaintedShape_setBrush(brush){jayus.debug.match("PaintedShape.setBrush",brush,"brush",5);if(this.hasBrush)this.brush.detach(this);if(!(brush instanceof jayus.Brush))brush=
new jayus.Brush(brush);this.brush=brush;brush.attach(this);this.hasBrush=true;return this.dirty(16)},clearBrush:function PaintedShape_clearBrush(){if(this.hasBrush){this.brush.detach(this);this.brush=null;this.hasBrush=false;this.dirty(16)}return this},getScope:function PaintedShape_getScope(){if(!this.isTransformed)return this.shape.getScope();var scope=this.shape.getScope().getTransformed(this.getMatrix()).getScope();if(this.brush.stroking||this.brush.shadowing){var scale=Math.max(this.xScale,this.yScale),
left=0,right=0,top=0,bottom=0;if(this.brush.stroking){var width=this.brush.lineWidth*scale/2;left=right=top=bottom=Math.sqrt(width*width*2);var miterLimit;if(this.brush.miterLimit===undefined)miterLimit=10;else miterLimit=this.brush.miterLimit;left=right=top=bottom=miterLimit*scale/1.5}if(this.brush.shadowing){left=Math.max(left,left+this.brush.shadowBlur-this.brush.shadowOffsetX);right=Math.max(right,right+this.brush.shadowBlur+this.brush.shadowOffsetX);top=Math.max(top,top+this.brush.shadowBlur-
this.brush.shadowOffsetY);bottom=Math.max(bottom,bottom+this.brush.shadowBlur+this.brush.shadowOffsetY)}scope.setSize(scope.width+left+right,scope.height+top+bottom);scope.translate(-left,-top)}return scope},getBounds:function PaintedShape_getBounds(){return this.shape},drawOntoContext:function PaintedShape_drawOntoContext(ctx){jayus.debug.matchContext("PaintedShape.drawOntoContext",ctx);if(this.hasBrush){ctx.save();if(this.alpha!==1)ctx.globalAlpha*=this.alpha;this.applyTransforms(ctx);this.shape.etchOntoContext(ctx);
this.brush.paintShape(ctx);ctx.restore();if(this.debugRenderer!==null)this.debugRenderer(ctx)}}});jayus.debug.className="Text";
jayus.Text=jayus.RectEntity.extend({text:"",font:"12pt sans-serif",brush:null,hasBrush:false,alignment:0,fontDesc:null,lines:null,lineWidths:null,init:function Text_init(text,font,brush){jayus.Entity.prototype.init.apply(this);if(arguments.length===1)jayus.debug.match("Text.init",text,"text",2);else if(arguments.length===2)jayus.debug.matchArguments("Text.init",arguments,"text",2,"font",2);else if(arguments.length===3)jayus.debug.matchArguments("Text.init",arguments,"text",2,"font",2,"brush",5);if(arguments.length){this.text=
text;if(arguments.length>1){this.font=font;if(arguments.length>2)this.setBrush(brush)}}this.refreshMetrics()},componentDirtied:function Text_componentDirtied(){this.dirty(16)},hasFlexibleWidth:function Text_hasFlexibleWidth(){return false},hasFlexibleHeight:function Text_hasFlexibleHeight(){return false},refreshMetrics:function Text_refreshMetrics(){if(this.fontDesc===null)this.fontDesc=jayus.getFontDescriptor(this.font);this.lines=this.text.split("\n");if(this.lineWidths===null)this.lineWidths=[];
else this.lineWidths.length=this.lines.length;var tempRet={};for(var i=0;i<this.lines.length;i++)this.lineWidths[i]=jayus.measureTextOnto(this.lines[i],this.font,tempRet).width;this.changeSize(jayus.math.max(this.lineWidths),this.lines.length*this.fontDesc.height)},getScope:function Text_getScope(){var scope=this.getFrame().getScope();if(this.hasBrush)if(this.brush.stroking||this.brush.shadowing){var scale=Math.max(this.xScale,this.yScale),left=0,right=0,top=0,bottom=0;if(this.brush.stroking){var width=
this.brush.lineWidth*scale/2;left=right=top=bottom=Math.sqrt(width*width*2)}if(this.brush.shadowing){left=Math.max(left,left+this.brush.shadowBlur-this.brush.shadowOffsetX);right=Math.max(right,right+this.brush.shadowBlur+this.brush.shadowOffsetX);top=Math.max(top,top+this.brush.shadowBlur-this.brush.shadowOffsetY);bottom=Math.max(bottom,bottom+this.brush.shadowBlur+this.brush.shadowOffsetY)}scope.setSize(scope.width+left+right,scope.height+top+bottom);scope.translate(-left,-top)}return scope},setText:function Text_setText(text){jayus.debug.match("Text.setText",
text,"text",2);if(this.text!==text){this.text=text;this.refreshMetrics();this.dirty(16)}return this},setFont:function Text_setFont(font){jayus.debug.match("Text.setFont",font,"font",2);if(this.font!==font){this.font=font;this.fontDesc=null;this.refreshMetrics()}return this},setAlignment:function TextBox_setAlignment(alignment){jayus.debug.match("TextBox.setAlignment",alignment,"alignment",4);if(this.alignment!==alignment){this.alignment=alignment;if(this.lines.length>1)this.dirty(16)}return this},
setBrush:function Text_setBrush(brush){jayus.debug.match("Text.setBrush",brush,"brush",5);if(this.hasBrush)this.brush.detach(this);if(!(brush instanceof jayus.Brush))brush=new jayus.Brush(brush);this.brush=brush;this.brush.attach(this);this.hasBrush=true;return this.dirty(jayus.DIRTY.ALL)},clearBrush:function Text_clearBrush(){if(this.hasBrush){this.brush.detach(this);this.brush=null;this.hasBrush=false;this.dirty(jayus.DIRTY.ALL)}return this},paintContents:function Text_paintContents(ctx){var ascent=
this.fontDesc.ascent,height=this.fontDesc.height;this.brush.applyTo(ctx);ctx.font=this.font;var i,line,x;for(i=0;i<this.lines.length;i++){line=this.lines[i];x=(this.width-this.lineWidths[i])*this.alignment;if(this.brush.stroking&&this.brush.strokeFirst)ctx.strokeText(line,x,ascent+i*height);if(this.brush.filling)ctx.fillText(line,x,ascent+i*height);if(this.brush.stroking&&!this.brush.strokeFirst)ctx.strokeText(line,x,ascent+i*height)}}});jayus.debug.className="TextBox";
jayus.TextBox=jayus.Text.extend({hasFlexibleWidth:function TextBox_hasFlexibleWidth(){return true},hasFlexibleHeight:function TextBox_hasFlexibleHeight(){return true},refreshMetrics:function TextBox_refreshMetrics(){if(this.fontDesc===null)this.fontDesc=jayus.getFontDescriptor(this.font);var tempRet={},font=this.font,getWordLen=function(str){return jayus.measureTextOnto(str,font,tempRet).width},divideText=function(str,delims){var i,out=[],curr="";for(i=0;i<str.length;i++)if(delims.indexOf(str[i])>=0){out.push(curr);
out.push(str[i]);curr=""}else curr+=str[i];out.push(curr);return out},lines=[],lineWidths=[],words=divideText(this.text," \n"),i=0,currentLine,currentLineLength,nextWord,nextWordLength;while(i!==words.length){currentLine="\n";currentLineLength=0;nextWord=words[i];nextWordLength=getWordLen(nextWord);do{if(nextWord==="\n"){i++;break}currentLine+=nextWord;currentLineLength+=nextWordLength;i++;if(i===words.length)break;nextWord=words[i];nextWordLength=getWordLen(nextWord)}while(currentLineLength+nextWordLength<
this.width);if(currentLine.length){lines.push(currentLine);lineWidths.push(currentLineLength)}}this.lines=lines;this.lineWidths=lineWidths}});jayus.debug.className="Grid";
jayus.Grid=jayus.RectEntity.extend({isParent:true,slotWidth:10,slotHeight:10,xPadding:0,yPadding:0,items:null,init:function Grid_init(){jayus.RectEntity.prototype.init.apply(this);this.items=[[null]]},childMoved:function(){this.dirty()},childDirtied:function(){this.dirty()},updateSize:function Grid_updateSize(){return this.updateWidth().updateHeight()},updateWidth:function Grid_updateWidth(){return this.setWidth(this.items[0].length*this.slotWidth+(this.items[0].length-1)*this.xPadding)},updateHeight:function Grid_updateHeight(){return this.setHeight(this.items.length*
this.slotHeight+(this.items.length-1)*this.yPadding)},setSlotWidth:function Grid_setSlotWidth(width){jayus.debug.match("Grid.setSlotWidth",width,"width",4);if(this.slotWidth!==width){this.slotWidth=width;this.updateSize()}return this},setSlotHeight:function Grid_setSlotHeight(height){jayus.debug.match("Grid.setSlotHeight",height,"height",4);if(this.slotHeight!==height){this.slotHeight=height;this.updateSize()}return this},setSlotSize:function Grid_setSlotSize(width,height){jayus.debug.matchSize("Grid.setSlotSize",
width,height);if(arguments.length===1){height=width.height;width=width.width}if(this.slotWidth!==width||this.slotHeight!==height){this.slotWidth=width;this.slotHeight=height;this.updateSize()}return this},setPadding:function Grid_setPadding(x,y){jayus.debug.matchCoordinate("Grid.setPadding",x,y);if(arguments.length===1){y=x.y;x=x.x}this.xPadding=x;this.yPadding=y},count:function Grid_count(){var i,j,count=0;for(i=0;i<this.getRowCount();i++)for(j=0;j<this.getColumnCount();j++)if(this.items[i][j]!==
null)count++;return count},slotCount:function Grid_slotCount(){return this.items.length*this.items[0].length},hasSlot:function Grid_hasSlot(x,y){jayus.debug.matchCoordinate("Grid.hasSlot",x,y);if(arguments.length===1){y=x.y;x=x.x}return this.hasColumn(x)&&this.hasRow(y)},hasColumn:function Grid_hasColumn(x){jayus.debug.match("Grid.hasColumn",x,"x",4);return 0<=x&&x<this.items[0].length},hasRow:function Grid_hasRow(y){jayus.debug.match("Grid.hasRow",y,"y",4);return 0<=y&&y<this.items.length},hasChild:function Grid_hasChild(item){var i,
j;if(item instanceof jayus.Entity)for(i=0;i<this.getRowCount();i++){if(this.items[0].indexOf(item)>=0)return true}else for(i=0;i<this.getRowCount();i++)for(j=0;j<this.getColumnCount();j++)if(this.items[i][j].id===item)return true;return false},indexOf:function Grid_indexOf(item){var i,j;if(item instanceof jayus.Entity)for(i=0;i<this.getRowCount();i++){j=this.items[0].indexOf(item);if(j>=0)return new jayus.Point(j,i)}else for(i=0;i<this.getRowCount();i++)for(j=0;j<this.getColumnCount();j++)if(this.get(j,
i).id===id)return new jayus.Point(j,i);return null},getChild:overloadArgumentType({object:function Grid_getChild(index){jayus.debug.match("Grid.getChild",index,"index",5);return this.getChild(index.y,index.x)},number:function Grid_getChild(x,y){jayus.debug.matchArgumentsAs("Grid.getChild",arguments,4,"row","column");if(this.hasSlot(x,y))return this.items[y][x];return null},string:function Grid_getChild(id){jayus.debug.match("Grid.getChild",id,"id",0);var i,j;for(i=0;i<this.getRowCount();i++)for(j=
0;j<this.getColumnCount();j++)if(this.getChildAt(j,i).id===id)return this.items[i][j];return null}}),setChild:overloadArgumentCount({2:function Grid_setChild(index,child){jayus.debug.matchArguments("Grid.setChild",arguments,"index",4,"child",12);return this.setChild(index.x,index.y,child)},3:function Grid_setChild(x,y,child){jayus.debug.matchArguments("Grid.setChild",arguments,"x",4,"y",4,"child",12);if(this.hasSlot(x,y)){var old=this.items[y][x];if(old!==null)old.removeParent();this.items[y][x]=
child;if(child!==null){child.setParent(this);child.translate(x*this.slotWidth+x*this.xPadding,y*this.slotHeight+y*this.yPadding)}this.dirty()}return this}}),getChildAt:function Grid_getChildAt(x,y){jayus.debug.matchCoordinate("Grid.getChildAt",x,y);if(arguments.length===1){y=x.y;x=x.x}var child=null;this.forEach(function(){if(this.intersectsAt(x,y)){child=this;return null}});return child},getSlotAt:function Grid_getSlotAt(x,y){jayus.debug.matchCoordinate("Grid.getSlotAt",x,y);if(arguments.length===
1){y=x.y;x=x.x}x-=this.x;y-=this.y;return new jayus.Point(Math.floor(x/this.slotWidth),Math.floor(y/this.slotHeight))},getSlotFrame:function Grid_getSlotFrame(x,y){jayus.debug.matchCoordinate("Grid.getSlotFrame",x,y);if(arguments.length===1){y=x.y;x=x.x}return this.hasSlot(x,y)?new jayus.Rectangle(this.x+x*(this.slotWidth+this.xPadding),this.y+y*(this.slotHeight+this.yPadding),this.slotWidth,this.slotHeight):null},removeChild:overloadArgumentType({object:function Grid_removeChild(child){for(var i=
0;i<this.getRowCount();i++)for(var j=0;j<this.getColumnCount();j++)if(this.getChild(i,j)===child){child.removeParent();this.items[i][j]=null;return this}return this},string:function Grid_removeChild(id){for(var i=0;i<this.getRowCount();i++)for(var j=0;j<this.getColumnCount();j++)if(this.getChild(i,j).id===id){var child=this.items[i][j];child.removeParent();this.items[i][j]=null;return this}return this},number:function Grid_removeChild(row,col){if(this.has(row,col)){var item=this.items[row][col];item.removeParent();
this.items[row][col]=null}return this}}),setGridSize:function Grid_setGridSize(columns,rows){return this.setColumnCount(columns).setRowCount(rows)},getRowCount:function Grid_getRowCount(){return this.items.length},setRowCount:function Grid_setRowCount(rows){jayus.debug.match("Grid.setRowCount",rows,"rows",4);while(rows<this.getRowCount())this.removeRow();while(rows>this.getRowCount())this.addRow();return this},addRow:function Grid_addRow(row){if(!arguments.length)row=[];while(row.length<this.getColumnCount())row.push(null);
this.items.push(row);this.updateSize();return this.dirty()},removeRow:function Grid_removeRow(index){jayus.debug.match("Grid.removeRow",index,"index",4);this.forEachInRow(index,function(){this.removeParent()});if(this.getRowCount()>1&&this.hasRow(index))this.items.splice(index,1);this.updateSize();return this.dirty()},getColumnCount:function Grid_getColumnCount(){return this.items[0].length},setColumnCount:function Grid_setColumnCount(cols){jayus.debug.match("Grid.setColumnCount",cols,"cols",4);while(cols<
this.getColumnCount())this.removeColumn();while(cols>this.getColumnCount())this.addColumn();return this},addColumn:function Grid_addColumn(col){if(!arguments.length)col=[];while(col.length<this.getRowCount())col.push(null);for(var i=0;i<this.getRowCount();i++)this.items[i].push(col[i]);this.updateSize();return this.dirty()},removeColumn:function Grid_removeColumn(index){jayus.debug.match("Grid.removeColumn",index,"index",4);this.forEachInColumn(index,function(){this.removeParent()});if(this.getColumnCount()>
1&&this.hasColumn(index))for(var i=0;i<this.getRowCount();i++)this.items[i].splice(index,1);this.updateSize();return this.dirty()},onEach:function Grid_onEach(method,args){jayus.debug.match("Grid.onEach",method,"method",2);return this.forEachSlot(function(item){if(item!==null)item[method].apply(item,args)})},forEach:function Grid_forEach(func,args){jayus.debug.match("Grid.forEach",func,"func",3);return this.forEachSlot(function(row,col,item){if(item!==null)func.call(this,row,col,item)})},forEachInRow:function Grid_forEachInRow(row,
func,args){jayus.debug.matchArguments("Grid.forEachInRow",arguments,"row",4,"func",3);if(this.hasRow(row))for(var j=0,item;j<this.getColumnCount();j++){item=this.items[row][j];if(item!==null)func.apply(item,args)}return this},forEachInColumn:function Grid_forEachInColumn(col,func,args){jayus.debug.matchArguments("Grid.forEachInColumn",arguments,"col",4,"func",3);if(this.hasColumn(col))for(var i=0,item;i<this.getRowCount();i++){item=this.items[i][col];if(item!==null)func.apply(item,args)}return this},
forEachSlot:function Grid_forEachSlot(func){jayus.debug.match("Grid.forEachSlot",func,"func",3);for(var i=0;i<this.items.length;i++)for(var j=0;j<this.items[0].length;j++)if(func.call(this,i,j,this.items[i][j])===null)return this;return this},findCursorAcceptor:function Grid_findCursorAcceptor(){var ret=null;this.forEach(function(x,y,item){if(item.underCursor)if(item.isParent){acceptor=item.findCursorAcceptor();if(acceptor!==null){ret=acceptor;return null}if(item.canAcceptCursor){ret=item;return null}}else if(item.canAcceptCursor){ret=
item;return null}});return ret},fireOnEach:function Grid_fireOnEach(event,data){jayus.debug.match("Grid.fireOnEach",event,"event",2);var i,j;for(i=0;i<this.getRowCount();i++)for(j=0;j<this.getColumnCount();j++)if(this.has(i,j))if(this.get(i,j).fire(event,data))return true;return false},fireOnCursor:function Grid_fireOnCursor(event,data){jayus.debug.match("Grid.fireOnCursor",event,"event",2);var i,j,item;for(i=0;i<this.items.length;i++)for(j=0;j<this.items[i].length;j++){item=this.items[i];if(item.underCursor){if(item.isParent&&
item.fireOnCursor(event,data))return true;if(item.fire(event,data))return true}}return false},updateCursorOnChildren:function Grid_updateCursorOnChildren(x,y,data){var pos=this.parentToLocal(x,y);if(this.isTransformed)pos=this.getMatrix().inverseTransformPoint(pos.x,pos.y);x=pos.x;y=pos.y;this.forEach(function(i,j,item){if(item.trackCursor)jayus.util.updateCursorOnChild(item,x,y)})},removeCursorFromChildren:function Grid_removeCursorFromChildren(data){this.forEach(function(x,y,item){item.removeCursor()})},
runOnCursor:function Grid_runOnCursor(func,args){jayus.debug.match("Grid.runOnCursor",func,"func",3);this.forEach(function(i,j,item){if(item.underCursor){if(item.isParent&&item.runOnCursor(func,args))return true;if(func.apply(item,args))return true}})},paintContents:function Grid_paintContents(ctx){jayus.debug.matchContext("Grid.paintContents",ctx);var i,j,item;for(i=0;i<this.items.length;i++)for(j=0;j<this.items[i].length;j++){item=this.items[i][j];if(item!==null&&item.visible)item.drawOntoContext(ctx)}}});jayus.debug.className="Image";
jayus.Image=jayus.RectEntity.extend({image:null,hasSection:false,section:null,keepAligned:false,loaded:false,init:function Image_init(image){jayus.Entity.prototype.init.apply(this);if(typeof image==="string"){var filepath=image;if(jayus.images.isLoaded(filepath)){this.loaded=true;this.image=jayus.images.images[filepath];this.width=this.image.width;this.height=this.image.height}else{var that=this;jayus.addHandler("imageLoaded",function(data){if(data.filepath===filepath){that.loaded=true;that.image=
data.image;if(!that.hasSection)that.changeSize(data.image.width,data.image.height)}});jayus.images.load(filepath)}}else{this.loaded=true;this.image=image;this.width=this.image.width;this.height=this.image.height}},hasFlexibleWidth:function Image_hasFlexibleWidth(){return false},hasFlexibleHeight:function Image_hasFlexibleHeight(){return false},setSource:function Image_setSource(image){if(typeof image==="string"){var filepath=image;if(jayus.images.isLoaded(filepath)){this.loaded=true;this.image=jayus.images.images[filepath];
this.changeSize(this.image.width,this.image.height)}else{var that=this;jayus.images.load(filepath,function(source,image){that.loaded=true;that.image=jayus.images.images[filepath];that.changeSize(image.width,image.height)})}}else{this.loaded=true;this.image=image;this.changeSize(this.image.width,this.image.height)}},setSection:function Image_setSection(x,y,width,height){if(arguments.length===1){jayus.debug.match("Image.setSection()",x,"section",20);height=x.height;width=x.width;y=x.y;x=x.x}else if(arguments.length===
3){jayus.debug.matchArguments("Image.setSection()",arguments,"origin",13,"width",4,"height",4);height=width;width=y;y=x.y;x=x.x}else jayus.debug.matchArgumentsAs("Image.setSection()",arguments,4,"x","y","width","height");this.hasSection=true;if(this.width!==width||this.height!==height){this.sectionY=y;this.sectionX=x;this.changeSize(width,height)}else if(this.sectionX!==x||this.sectionY!==y){this.sectionY=y;this.sectionX=x;this.dirty(16)}return this},clearSection:function Image_clearSection(){if(this.hasSection){this.hasSection=
false;this.changeSize(this.image.width,this.image.height)}return this},toString:function Image_toString(){return"(Image:"+this.image+")"},toPattern:function Image_toPattern(repetition){if(!arguments.length)repetition="repeat";jayus.debug.match("Image.toPattern",repetition,"repetition",2);if(["repeat","repeat-x","repeat-y","no-repeat"].indexOf(repetition)===-1)throw new Error("Image.toPattern() - Invalid repetition"+jayus.debug.toString(repetition)+' sent, "repeat", "repeat-x", "repeat-y", or "no-repeat" required');
return this.rasterize().toPattern(repetition)},paintContents:function Image_paintContents(ctx){jayus.debug.matchContext("Image.paintContents",ctx);if(!this.loaded){console.warn("Image.paintContents() - Image not yet loaded");return}var image=this.image;if(image instanceof jayus.Surface)image=image.canvas;if(this.hasSection)ctx.drawImage(image,this.sectionX,this.sectionY,this.width,this.height,0,0,this.width,this.height);else ctx.drawImage(image,0,0);return this}});jayus.debug.className="Sprite";
jayus.Sprite=jayus.Image.extend({animation:null,animator:null,spriteIndexX:null,spriteIndexY:null,setSpriteSheet:function Sprite_setSpriteSheet(sheet){this.sheet=sheet;return this},setSprite:function Sprite_setSprite(x,y){jayus.debug.matchCoordinate("Sprite.setSprite",x,y);if(arguments.length===1){y=x.y;x=x.x}if(this.sheet!==null||typeof this.image.sheet==="object"){if(this.spriteIndexX!==x||this.spriteIndexY!==y){var sheet=this.sheet||this.image.sheet;this.spriteIndexX=x;this.spriteIndexY=y;this.setSection(sheet.marginX+
x*sheet.spriteWidth,sheet.marginY+y*sheet.spriteHeight,sheet.spriteWidth,sheet.spriteHeight);this.dirty(4)}}else console.warn("Sprite.setSprite() - Image does not contain attached spritesheet");return this},playAnimation:function Sprite_playAnimation(name,func){jayus.debug.match("Sprite.playAnimation",name,"name",2);jayus.debug.matchOptional("Sprite.playAnimation",func,"func",3);this.setAnimation(name,false);if(arguments.length>1)this.animator.addHandler("finished",func);return this},loopAnimation:function Sprite_loopAnimation(name){jayus.debug.match("Sprite.loopAnimation",
name,"name",2);return this.setAnimation(name,true)},stopAnimation:function Sprite_stopAnimation(){if(this.animator!==null)this.animator.stop()},setAnimation:function Sprite_setAnimation(name,looped){jayus.debug.matchArguments("Sprite.setAnimation",arguments,"name",2,"looped",1);if(this.sheet!==null||typeof this.image.sheet==="object"){var sheet=this.sheet||this.image.sheet;if(sheet.hasAnimation(name)){if(this.animator!==null)this.animator.stop();this.animation=name;var data=sheet.animations[name],
sequence=data.sprites,sprite=this;if(data.flipX||data.flipY){this.setAnchor(this.width/2,this.height/2);if(data.flipX)this.setScale(-1,this.yScale);else this.setScale(1,this.yScale);if(data.flipY)this.setScale(this.xScale,-1);else this.setScale(this.xScale,1)}else this.setScale(1,1);this.animator=new jayus.Animator.Discrete(sequence.length,function(index){sprite.setSprite(sequence[index])});this.animator.setDuration(sheet.animations[name].duration).setLooped(looped).start()}else throw new Error("Sprite.setAnimation() - Spritesheet does not contain sprite/animation: "+
name);}else throw new Error("Sprite.setAnimation() - Image does not contain attached spritesheet");return this},playSequence:function Sprite_playSequence(names){var i,anim,seq=new jayus.AnimatorSequence,sheet=this.sheet||this.image.sheet;for(i=0;i<names.length;i++)seq.add((new jayus.Sprite.SpriteSequence(this,sheet.animations[names[i]].sprites)).setDuration(sheet.animations[names[i]].duration));this.animator.stop();this.animator=seq;anim=this.animation;this.animation=names;seq.addHandler("finished",
function(e){this.setAnimation(anim)},{context:this});seq.start();return seq}});jayus.debug.className="SpriteSheet";
jayus.SpriteSheet=jayus.Dependency.extend({spriteWidth:32,spriteHeight:32,spacingX:0,spacingY:0,marginX:0,marginY:0,animations:null,init:function SpriteSheet_init(filepath){this.animations={};if(arguments.length){jayus.debug.match("SpriteSheet.init",filepath,"filepath",2);jayus.images.images[filepath].sheet=this}},setSpriteSize:function SpriteSheet_setSpriteSize(width,height){jayus.debug.matchSize("SpriteSheet.setSpriteSize",width,height);if(arguments.length===1){height=width.height;width=width.width}if(this.spriteWidth!==
width||this.spriteHeight!==height){this.spriteWidth=width;this.spriteHeight=height;this.dirty(4)}return this},setSpacing:function SpriteSheet_setSpacing(x,y){jayus.debug.matchCoordinate("SpriteSheet.setSpacing",x,y);if(arguments.length===1){y=x.y;x=x.x}if(this.spacingX!==x||this.spacingY!==y){this.spacingX=x;this.spacingY=y}return this},setMargin:function SpriteSheet_setMargin(x,y){jayus.debug.matchCoordinate("SpriteSheet.setMargin",x,y);if(arguments.length===1){y=x.y;x=x.x}if(this.marginX!==x||this.marginY!==
y){this.marginX=x;this.marginY=y}return this},hasAnimation:function SpriteSheet_hasAnimation(name){return typeof this.animations[name]==="object"},addAnimation:function SpriteSheet_addAnimation(name,sprites,duration){if(arguments.length===2){duration=1E3;arguments[2]=duration}jayus.debug.matchArguments("SpriteSheet.addAnimation",arguments,"name",2,"sprites",6,"duration",4);this.animations[name]={sprites:sprites,duration:duration,flipX:false,flipY:false};return this},add:function SpriteSheet_add(animations){for(var key in animations)if(animations.hasOwnProperty(key)){var animation=
animations[key];if(typeof animation.flipX==="undefined")animation.flipX=false;if(typeof animation.flipY==="undefined")animation.flipY=false;if(typeof animation.duration==="undefined")animation.duration=1E3;this.animations[key]=animation}return this},setAnimationDuration:function SpriteSheet_setAnimationDuration(animation,duration){jayus.debug.matchArguments("SpriteSheet.setAnimationDuration",arguments,"animation",2,"duration",4);if(!this.hasAnimation(animation))throw new Error("SpriteSheet.setAnimationDuration() - Invalid animation"+
jayus.debug.toString(animation)+" sent, unknown animation");this.animations[animation].duration=duration;return this},setAnimationFlipping:function SpriteSheet_setAnimationFlipping(animation,flipX,flipY){jayus.debug.matchArguments("SpriteSheet.setAnimationFlipping",arguments,"animation",2,"flipX",1,"flipY",1);if(!this.hasAnimation(animation))throw new Error("SpriteSheet.setAnimationFlipping() - Invalid animation"+jayus.debug.toString(animation)+" sent, unknown animation");this.animations[animation].flipX=
flipX;this.animations[animation].flipY=flipY;return this}});jayus.debug.className="Surface";
jayus.Surface=jayus.RectEntity.extend({width:300,height:150,canvas:null,context:null,negateBlur:false,init:function Surface_init(width,height){jayus.Entity.prototype.init.apply(this);if(arguments.length===2){jayus.debug.matchArgumentsAs("Surface.init",arguments,4,"width","height");this.width=width;this.height=height}this.canvas=document.createElement("canvas");this.canvas.width=this.width;this.canvas.height=this.height;this.context=this.canvas.getContext("2d")},hasFlexibleWidth:function Surface_hasFlexibleWidth(){return true},hasFlexibleHeight:function Surface_hasFlexibleHeight(){return true},
formContents:function Display_formContents(width,height){this.canvas.width=width;this.canvas.height=height},clear:function Surface_clear(){this.context.clearRect(0,0,this.width,this.height);return this},fill:overloadArgumentCount({1:function Surface_fill(color){return this.fill(color.r,color.g,color.b,color.a)},2:function Surface_fill(color,alpha){return this.fill(color.r,color.g,color.b,color.a*alpha)},3:function Surface_fill(r,g,b){return this.fill(r,g,b,1)},4:function Surface_fill(r,g,b,a){jayus.debug.matchArgumentsAs("Surface.fill",
arguments,4,"r","g","b","a");var ctx=this.context;ctx.save();ctx.fillStyle="rgba("+r+","+g+","+b+","+a+")";ctx.globalCompositeOperation="copy";ctx.fillRect(0,0,this.width,this.height);ctx.restore();return this}}),getBuffer:function Surface_getBuffer(x,y,width,height){if(arguments.length===0){height=this.height;width=this.width;y=0;x=0}else if(arguments.length===1){jayus.debug.match("Surface.getBuffer()",x,"section",20);height=x.height;width=x.width;y=x.y;x=x.x}else if(arguments.length===3){jayus.debug.matchArguments("Surface.getBuffer()",
arguments,"origin",13,"width",4,"height",4);height=width;width=y;y=x.y;x=x.x}else jayus.debug.matchArgumentsAs("Surface.getBuffer()",arguments,4,"x","y","width","height");return this.context.getImageData(x,y,width,height)},putBuffer:function Surface_putBuffer(x,y,buffer){if(arguments.length===1){jayus.debug.match("Surface.putBuffer",x,"buffer",21);buffer=x;y=0;x=0}else if(arguments.length===2){jayus.debug.matchArguments("Surface.putBuffer",arguments,"position",13,"buffer",21);buffer=y;y=x.y;x=x.x}else jayus.debug.matchArguments("Surface.putBuffer",
arguments,"x",4,"y",4,"buffer",21);this.context.putImageData(buffer,x,y);return this.dirty(16)},getPixel:function Surface_getPixel(x,y){jayus.debug.matchCoordinate("Surface.getPixel",x,y);if(arguments.length===1){y=x.y;x=x.x}var data=this.getBuffer(x,y,1,1).data;return new jayus.Color(data[0],data[1],data[2],data[3]/255)},setPixel:overloadArgumentCount({2:function Surface_setPixel(pixel,color){jayus.debug.matchArguments("Surface.setPixel",arguments,"pixel",13,"color",8);return this.setPixel(pixel.x,
pixel.y,color.r,color.g,color.b,color.a)},3:function Surface_setPixel(x,y,color){jayus.debug.matchArguments("Surface.setPixel",arguments,"x",4,"y",4,"color",8);return this.setPixel(x,y,color.r,color.g,color.b,color.a)},4:function Surface_setPixel(pixel,r,g,b){jayus.debug.matchArguments("Surface.setPixel",arguments,"pixel",13,"r",4,"g",4,"b",4);return this.setPixel(pixel.x,pixel.y,r,g,b,1)},5:function Surface_setPixel(x,y,r,g,b){jayus.debug.matchArgumentsAs("Surface.setPixel",arguments,4,"x","y","r",
"g","b");return this.setPixel(x,y,r,g,b,1)},6:function Surface_setPixel(x,y,r,g,b,a){jayus.debug.matchArgumentsAs("Surface.setPixel",arguments,4,"x","y","r","g","b","a");var buffer=this.context.createImageData(1,1),data=buffer.data;data[0]=r;data[1]=g;data[2]=b;data[3]=a*255;return this.putBuffer(x,y,buffer)}}),getPixelFrame:function Surface_getPixelFrame(x,y){jayus.debug.matchCoordinate("Surface.getPixelFrame",x,y);if(arguments.length===1){y=x.y;x=x.x}return new jayus.Rectangle(this.x+x*this.xScale,
this.y+y*this.yScale,this.xScale,this.yScale)},getPixelAt:function Surface_getPixelAt(x,y){jayus.debug.matchCoordinate("Surface.getPixelAt",x,y);if(arguments.length===1){y=x.y;x=x.x}if(this.intersectsAt(x,y)){if(x===this.getRight())x--;if(y===this.getBottom())y--;return new jayus.Point(Math.floor((x-this.getLeft())/this.xScale),Math.floor((y-this.getTop())/this.yScale))}return null},blurImage:function Surface_blurImage(intensity){jayus.debug.match("Surface.blurImage",intensity,"intensity",4);var data=
this.getBuffer().data,w=this.width,h=this.height,newBuffer=this.context.createImageData(w,h),newData=newBuffer.data,x,y,sx,sy,r,b,g,a,c,z,i=0;for(y=0;y<h;y++)for(x=0;x<w;x++){r=g=b=a=c=0;for(sy=y-intensity;sy<y+1+intensity;sy++)if(sy>=0&&sy<h)for(sx=x-intensity;sx<x+1+intensity;sx++)if(sx>=0&&sx<w){z=(sy*w+sx)*4;r+=data[z];g+=data[z+1];b+=data[z+2];a+=data[z+3];c++}newData[i]=r/c;newData[i+1]=g/c;newData[i+2]=b/c;newData[i+3]=a/c;i+=4}return this.putBuffer(newBuffer).dirty()},exportPNG:function Surface_exportPNG(){window.open(this.canvas.toDataURL("image/png"),
"_blank");return this},toString:function Surface_toString(){return"(Surface:"+this.width+","+this.height+")"},toPattern:function Surface_toPattern(repetition){if(!arguments.length)repetition="repeat";else{jayus.debug.match("Surface.toPattern",repetition,"repetition",2);if(["repeat","repeat-x","repeat-y","no-repeat"].indexOf(repetition)===-1)throw new Error("Surface.toPattern() - Invalid repetition"+jayus.debug.toString(repetition)+' sent, "repeat", "repeat-x", "repeat-y", or "no-repeat" required');
}return this.context.createPattern(this.canvas,repetition)},paintContents:function Surface_paintContents(ctx){if(this.negateBlur){var data=this.getBuffer().data,x,y,pos;for(y=0;y<this.height;y++)for(x=0;x<this.width;x++){pos=4*(x+this.width*y);ctx.fillStyle="rgba("+data[pos]+","+data[pos+1]+","+data[pos+2]+","+data[pos+3]/255+")";ctx.fillRect(this.x+x,this.y+y,1,1)}}else ctx.drawImage(this.canvas,0,0)}});jayus.Group={isParent:true,propagateCursor:true,findChild:function Group_findChild(id){jayus.debug.match("Entity.setId",id,"id",0);var i,item;for(i=0;i<this.children.items.length;i++){item=this.children.items[i];if(item.id===id)return item;if(item.isParent){item=item.findChild(id);if(item!==null)return item}}return null},getAllChildren:function Group_getAllChildren(parentsAfter){var i,item,children=[];for(i=0;i<this.children.items.length;i++){item=this.children.items[i];if(item.isParent)if(parentsAfter)children=
children.concat(item,item.getAllChildren(parentsAfter));else children=children.concat(item.getAllChildren(parentsAfter),item);else children.push(item)}return children},getChildrenUnderCursor:function Group_getChildrenUnderCursor(){var i,ret=[];for(i=0;i<this.children.items.length;i++)if(this.children.items[i].underCursor)ret.push(this.children.items[i]);return ret},getChildrenAt:function Group_getChildrenAt(x,y){jayus.debug.matchCoordinate("Group.getChildrenAt",x,y);if(arguments.length===1){y=x.y;
x=x.x}var i,ret=[];for(i=0;i<this.children.items.length;i++)if(this.children.items[i].intersectsAt(x,y))ret.push(this.children.items[i]);return ret},runOnCursor:function Group_runOnCursor(func,args){jayus.debug.match("Group.runOnCursor",func,"func",3);var i,item;for(i=this.children.items.length-1;i>=0;i--){item=this.children.items[i];if(item.underCursor){if(item.isParent&&item.runOnCursor(func,args))return true;if(func.apply(item,args))return true}}return false},forEachChild:function Scene_forEachChild(func,
args){jayus.debug.match("Scene.forEachChild",func,"func",3);return this.children.forEach(func,args)},fireOnChildren:function Group_fireOnChildren(event,data){jayus.debug.match("Group.fireOnChildren",event,"event",2);var i,item;for(i=0;i<this.children.items.length;i++){item=this.children.items[i];if(item.isParent&&item.fireOnChildren(event,data))return true;if(item.fire(event,data))return true}return false},fireOnCursor:function Group_fireOnCursor(event,data){jayus.debug.match("Group.fireOnCursor",
event,"event",2);var i,item;for(i=this.children.items.length-1;i>=0;i--){item=this.children.items[i];if(item.underCursor){if(item.isParent&&item.fireOnCursor(event,data))return true;if(item.fire(event,data))return true}}return false},updateCursorOnChildren:function Group_updateCursorOnChildren(x,y){var pos,i,item;if(this.propagateCursor){pos=this.parentToLocal(x,y);x=pos.x;y=pos.y;for(i=this.children.items.length-1;i>=0;i--){item=this.children.items[i];if(item.trackCursor)item.updateCursor(x,y)}}},
findCursorAcceptor:function Group_findCursorAcceptor(){var i,item,acceptor;for(i=this.children.items.length-1;i>=0;i--){item=this.children.items[i];if(item.underCursor)if(item.isParent){acceptor=item.findCursorAcceptor();if(acceptor!==null)return acceptor;if(item.canAcceptCursor)return item}else if(item.canAcceptCursor)return item}return null},removeCursorFromChildren:function Group_removeCursorFromChildren(){var i,item;for(i=0;i<this.children.items.length;i++){item=this.children.items[i];if(item.underCursor){item.underCursor=
false;item.fire("cursorOut");if(item.isParent)item.removeCursorFromChildren()}}}};jayus.Wrapper={isParent:false,child:null,propagateCursor:true,updateCursorOnChildren:function Wrapper_updateCursorOnChildren(x,y){this.localX=x;this.localY=y;if(this.propagateCursor){var pos=this.parentToLocal(x,y);jayus.util.updateCursorOnChild(this.child,pos.x,pos.y)}},removeCursorFromChildren:function Wrapper_removeCursorFromChildren(){this.child.removeCursor()},findCursorAcceptor:function Group_findCursorAcceptor(){if(this.child.underCursor)if(this.child.isParent){var acceptor=this.child.findCursorAcceptor();
if(acceptor!==null)return acceptor;if(this.child.canAcceptCursor)return this.child}else return this.child;return null},getChild:function Wrapper_getChild(){return this.child},hasChild:function Wrapper_hasChild(){return this.isParent},setChild:function Wrapper_setChild(child){jayus.debug.match("Wrapper.setChild",child,"child",12);this.child=child;child.setParent(this);this.isParent=true;return this},removeChild:function Wrapper_removeChild(){this.child.removeParent();this.child=null;this.isParent=
false;return this},findChild:function Wrapper_findChild(id){if(this.isParent){if(this.child.id===id)return this.child;if(this.child.isParent)return this.child.findChild(id)}return null},onEachChild:function Wrapper_onEachChild(method,args){jayus.debug.match("Wrapper.onEachChild",method,"method",2);return this.child[method].apply(this.child,args)},forEachChild:function Wrapper_forEachChild(func,args){jayus.debug.match("Wrapper.forEachChild",func,"func",3);return func.apply(this.child,args)},runOnCursor:function Wrapper_runOnCursor(func,
args){if(this.child.underCursor){if(this.child.isParent&&this.child.runOnCursor(func,args))return true;if(func.apply(this.child,args))return true}return false},fireOnChildren:function Wrapper_fireOnChildren(event,data){jayus.debug.match("Wrapper.fireOnChildren",event,"event",2);return this.child.fire(event,data)},fireOnCursor:function Wrapper_fireOnCursor(event,data){jayus.debug.match("Wrapper.fireOnCursor",event,"event",2);if(this.child.trackCursor&&this.child.underCursor){if(this.child.isParent&&
this.child.fireOnCursor(event,data))return true;return this.child.fire(event,data)}return false}};jayus.debug.className="Layer";
jayus.Layer=jayus.Entity.extend({x:0,y:0,childrenAdded:null,componentDirtied:function Layer_componentDirtied(componentType,component,type){if(componentType==="ENTITY"){if(type&jayus.DIRTY.SCOPE)component.scopeChanged=true;this.scopeClean=false}this.dirty(16)},listItemAdded:function Layer_listItemAdded(list,item){if(this.childrenAdded===null)this.childrenAdded=[];this.childrenAdded.push(item);item.prevScope=item.getScope();item.setParent(this);this.dirty(16)},listItemsAdded:function Layer_listItemsAdded(list,items){if(this.childrenAdded===
null)this.childrenAdded=[];for(var item,i=0;i<items.length;i++){item=items[i];item.setParent(this);this.childrenAdded.push(item);item.prevScope=item.getScope()}this.dirty(16)},listItemRemoved:function Layer_listItemRemoved(list,item){item.removeParent();this.redrawAll=true;this.dirty(16)},listItemsRemoved:function Layer_listItemsRemoved(list,items){for(var i=0;i<items.length;i++)items[i].removeParent();this.redrawAll=true;this.dirty(16)},init:function Layer_init(width,height){jayus.Entity.prototype.init.apply(this);
this.children=new jayus.List(this);this.scope=new jayus.Rectangle;this.children.typeId=12;if(arguments.length===2){jayus.debug.matchArgumentsAs("Layer.init",arguments,4,"width","height");this.width=width;this.height=height}},scope:null,scopeClean:false,getScope:function Layer_getScope(){var i,scope,x1,y1,x2,y2;if(!this.scopeClean)if(this.children.items.length){x1=null;y1=null;x2=null;y2=null;for(i=0;i<this.children.items.length;i++){scope=this.children.items[i].getScope();if(x1===null||scope.x<x1)x1=
scope.x;if(x2===null||scope.x+scope.width>x2)x2=scope.x+scope.width;if(y1===null||scope.y<y1)y1=scope.y;if(y2===null||scope.y+scope.height>y2)y2=scope.y+scope.height}this.scope.setFrame(x1,y1,x2-x1,y2-y1)}else this.scope.setFrame(0,0,0,0);return this.scope},translate:function Layer_translate(x,y){var i,item;for(i=0;i<this.children.items.length;i++){item=this.children.items[i];item.translate(x,y)}},intersectsAt:function Layer_intersectsAt(x,y){return true},drawOntoContext:function Layer_drawOntoContext(ctx){var i,
item;for(i=0;i<this.children.items.length;i++){item=this.children.items[i];if(item.visible)item.drawOntoContext(ctx)}}});jayus.applyObject(jayus.Group,jayus.Layer.prototype);jayus.debug.className="Scene";
jayus.Scene=jayus.RectEntity.extend({hasWorld:false,world:null,childrenAdded:null,componentDirtied:function Scene_componentDirtied(componentType,component,type){if(componentType==="ENTITY")if(type&jayus.DIRTY.SCOPE)component.scopeChanged=true;jayus.RectEntity.prototype.componentDirtied.call(this,componentType,component,type);this.dirty(16)},listItemAdded:function Scene_listItemAdded(list,item){if(this.childrenAdded===null)this.childrenAdded=[];this.childrenAdded.push(item);item.prevScope=item.getScope();
item.setParent(this);this.dirty(16)},listItemsAdded:function Scene_listItemsAdded(list,items){if(this.childrenAdded===null)this.childrenAdded=[];for(var item,i=0;i<items.length;i++){item=items[i];item.setParent(this);this.childrenAdded.push(item);item.prevScope=item.getScope()}this.dirty(16)},listItemRemoved:function Scene_listItemRemoved(list,item){item.removeParent();this.redrawAll=true;this.dirty(16)},listItemsRemoved:function Scene_listItemsRemoved(list,items){for(var i=0;i<items.length;i++)items[i].removeParent();
this.redrawAll=true;this.dirty(16)},hasFlexibleWidth:function Scene_hasFlexibleWidth(){return true},hasFlexibleHeight:function Scene_hasFlexibleHeight(){return true},formContents:function Scene_formContents(width,height){if(this.buffered){this.canvas.width=width;this.canvas.height=height}},init:function Scene_init(width,height){jayus.Entity.prototype.init.apply(this);this.children=new jayus.List(this);this.children.typeId=12;if(arguments.length){jayus.debug.matchArgumentsAs("Scene.init",arguments,
4,"width","height");this.width=width;this.height=height}},optimizeBuffering:false,groupDamagedRegions:true,damagedRegionPadding:2,setOptimizedBuffering:function Scene_setOptimizedBuffering(on){jayus.debug.match("Scene.setOptimizedBuffering",on,"on",1);if(this.optimizeBuffering!==on){this.optimizeBuffering=on;this.redrawAll=true;this.dirty(16)}return this},refreshBuffer:function Scene_refreshBuffer(){if(this.buffered){var width=this.width,height=this.height,canvas=this.canvas,ctx=this.context;if(width!==
canvas.width||height!==canvas.height){canvas.width=width;canvas.height=height}if(this.optimizeBuffering&&!this.redrawAll)this.optimizedRefreshBuffer();else{this.fullyRefreshBuffer();this.redrawAll=false}this.dirtied=false}},optimizedRefreshBuffer:function Scene_optimizedRefreshBuffer(){if(this.buffered){var ctx=this.context,i,item,region,damagedRegions=[];for(i=0;i<this.children.items.length;i++){item=this.children.items[i];item.clean=true;if(item.scopeChanged){damagedRegions.push(item.getScope().includeRectangle(item.prevScope));
item.prevScope=item.getScope();item.scopeChanged=false;item.clean=false}else if(item.dirtied){damagedRegions.push(item.getScope());item.dirtied=false;item.clean=false}}var done=false;if(this.groupDamagedRegions)while(!done){done=true;for(i=0;i<damagedRegions.length;i++){region=damagedRegions[i];for(i2=0;i2<damagedRegions.length;i2++){region2=damagedRegions[i2];if(region!==region2&&jayus.intersectTest(region,region2)){damagedRegions[i].includeRectangle(region2);damagedRegions.splice(i2,1);done=false;
if(i>=i2)i--;i2--}}}}var padding=this.damagedRegionPadding;for(i=0;i<damagedRegions.length;i++){region=damagedRegions[i];region.translate(-padding,-padding);region.setSize(region.width+padding*2,region.height+padding*2)}for(i=0;i<damagedRegions.length;i++){region=damagedRegions[i];for(i2=0;i2<this.children.items.length;i2++){item=this.children.items[i2];if(item.clean&&jayus.intersectTest(item,region))item.clean=false}}if(this.showDamage)this.clearDamage();ctx.save();for(i=0;i<damagedRegions.length;i++){region=
damagedRegions[i];ctx.clearRect(region.x,region.y,region.width,region.height)}ctx.beginPath();for(i=0;i<damagedRegions.length;i++){region=damagedRegions[i];ctx.rect(region.x,region.y,region.width,region.height)}ctx.clip();if(this.bufferBg&&this.hasBg)if(this.alignBg)this.bg.paintRect(ctx,0.5,0.5,Math.round(this.width),Math.round(this.height));else this.bg.paintRect(ctx,0,0,this.width,this.height);for(i=0;i<this.children.items.length;i++){item=this.children.items[i];if(!item.clean&&item.visible){item.drawOntoContext(ctx);
if(this.showDamage)this.paintRedraw(item)}}if(this.showDamage)for(i=0;i<damagedRegions.length;i++)this.paintDamage(damagedRegions[i]);ctx.restore()}},paintContents:function Scene_paintContents(ctx){var i,item;for(i=0;i<this.children.items.length;i++){item=this.children.items[i];if(item.visible)item.drawOntoContext(ctx)}}});jayus.applyObject(jayus.Group,jayus.Scene.prototype);jayus.debug.className="Display";
jayus.Display=jayus.Scene.extend({buffered:true,cursor:new jayus.Point,suppressContextMenu:true,suppressSelection:true,pendMousemoveEvents:true,hasPendingMousemoveEvent:false,pendingMousemoveEvent:null,init:function Display_init(width,height){jayus.Entity.prototype.init.apply(this);this.children=new jayus.List(this);this.children.typeId=12;if(arguments.length)if(arguments.length===1)jayus.debug.match("Display.init",width,"canvas",23);else if(arguments.length===2)jayus.debug.matchArguments("Display.init",arguments,
"width",4,"height",4);else throw new TypeError("Display.init() - Invalid number of arguments sent, 0, 1, or 2 required");if(arguments.length===1){var canvas=width;canvas.parentElement.style.position="relative"}else{var canvas=document.createElement("canvas");if(arguments.length){canvas.width=width;canvas.height=height}}this.canvas=canvas;this.width=canvas.width;this.height=canvas.height;this.context=canvas.getContext("2d");jayus.displays.push(this);this.hookCursorListeners(this.canvas);this.addDefaultHandlers()},
setBuffering:function Display_setBuffering(){},formContents:function RectEntity_formContents(width,height){this.canvas.width=width;this.canvas.height=height;this.redrawAll=true;this.dirty(4)},processPendingMousemove:function Display_processPendingMousemove(e){this.hasPendingMousemoveEvent=false;return this.processMousemove(this.pendingMousemoveEvent)},processMousemove:function Display_processMousemove(e){if(!this.underCursor){this.underCursor=true;this.fire("cursorOver")}var x=e.offsetX===undefined?
e.layerX:e.offsetX,y=e.offsetY===undefined?e.layerY:e.offsetY,data={display:this,event:e,x:x,y:y,deltaX:x-this.cursor.x,deltaY:y-this.cursor.y};this.cursor.x=x;this.cursor.y=y;if(this.cursor.dependentCount)this.cursor.dirty(2);if(!this.fireOnCursor("cursorMove",data))this.fire("cursorMove",data);this.startCursorUpdate()},hookCursorListeners:function Display_hookCursorListeners(canvas){var display=this,cursorEventObject={event:null,display:display,x:null,y:null},scrollEventObject={event:null,display:display,
x:null,y:null,scroll:null,xScroll:null,yScroll:null},updateCursorEventObject=function(e){cursorEventObject.event=e;cursorEventObject.x=e.offsetX===undefined?e.layerX:e.offsetX;cursorEventObject.y=e.offsetY===undefined?e.layerY:e.offsetY},updateScrollEventObject=function(e,scroll,xScroll,yScroll){scrollEventObject.event=e;scrollEventObject.x=e.offsetX===undefined?e.layerX:e.offsetX;scrollEventObject.y=e.offsetY===undefined?e.layerY:e.offsetY;scrollEventObject.scroll=scroll;scrollEventObject.xScroll=
xScroll;scrollEventObject.yScroll=yScroll},getButtonName=function(e){if(e.button===0)return"left";if(e.button===1)return"middle";if(e.button===2)return"right";return"unknown"},mousemoveHandler=function Display_mousemoveHandler(e){if(display.pendMousemoveEvents){display.pendingMousemoveEvent=e;display.hasPendingMousemoveEvent=true}else display.processMousemove(e)},mouseoutHandler=function Display_mouseoutHandler(e){display.processPendingMousemove();updateCursorEventObject(e);for(var i=0,buttonName;i<
3;i++){buttonName=getButtonName(i);if(jayus[buttonName+"Down"]){jayus[buttonName+"Down"]=false;jayus.fire(buttonName+"Release",cursorEventObject);display.fireOnCursor(buttonName+"Release",cursorEventObject)}}if(jayus.cursorFocus!==null){jayus.cursorFocus.fire("cursorLeave");jayus.cursorFocus=null}display.underCursor=false;display.fire("cursorOut");display.removeCursorFromChildren()};canvas.addEventListener("mousemove",mousemoveHandler);canvas.addEventListener("mouseleave",mouseoutHandler);if(this.suppressSelection){canvas.style.webkitUserSelect=
"none";canvas.style.mozUserSelect="none";canvas.onselectstart=function(){return false}}canvas.addEventListener("focus",function(e){display.fire("focused",{event:e,display:display});display.focused=true;jayus.focusedDisplay=display;jayus.hasFocus=true});canvas.addEventListener("blur",function(e){display.fire("blurred",{event:e,display:display});display.focused=false;jayus.focusedDisplay=null;jayus.hasFocus=false});canvas.setAttribute("tabindex","1");canvas.style.outline=0;canvas.addEventListener("mousedown",
function Display_mousedownHandler(e){if(display.hasPendingMousemoveEvent)display.processPendingMousemove();display.focus();if(!display.underCursor){display.underCursor=true;display.fire("cursorOver")}updateCursorEventObject(e);var buttonName=getButtonName(e),eventName=buttonName+"Press";jayus[buttonName+"Down"]=true;if(jayus.fire(eventName,cursorEventObject)||display.fireOnCursor(eventName,cursorEventObject)||display.fire(eventName,cursorEventObject)){e.stopPropagation();e.preventDefault();return false}});
canvas.addEventListener("mouseup",function Display_mouseupHandler(e){if(display.hasPendingMousemoveEvent)display.processPendingMousemove();updateCursorEventObject(e);var buttonName=getButtonName(e),eventName=buttonName+"Release";jayus[buttonName+"Down"]=false;jayus.fire(eventName,cursorEventObject);display.fireOnCursor(eventName,cursorEventObject);display.fire(eventName,cursorEventObject)});canvas.addEventListener("click",function Display_clickHandler(e){if(display.hasPendingMousemoveEvent)display.processPendingMousemove();
if(!display.underCursor){display.canvas.focus();display.underCursor=true;display.fire("cursorOver")}updateCursorEventObject(e);var buttonName=getButtonName(e);if(!jayus.fire(buttonName+"Click",cursorEventObject))if(!display.fireOnCursor(buttonName+"Click",cursorEventObject))display.fire(buttonName+"Click",cursorEventObject)});canvas.addEventListener("dblclick",function Display_dblclickHandler(e){if(display.hasPendingMousemoveEvent)display.processPendingMousemove();if(!display.underCursor){display.underCursor=
true;display.fire("cursorOver")}updateCursorEventObject(e);var buttonName=getButtonName(e);if(!jayus.fire(buttonName+"DoubleClick",cursorEventObject))if(!display.fireOnCursor(buttonName+"DoubleClick",cursorEventObject))display.fire(buttonName+"DoubleClick",cursorEventObject)});canvas.addEventListener("contextmenu",function Display_contextmenuHandler(e){if(display.suppressContextMenu)e.preventDefault()});if(jayus.ua.browser==="Firefox")canvas.addEventListener("wheel",function Display_DOMMouseScrollHandler(e){if(display.hasPendingMousemoveEvent)display.processPendingMousemove();
if(!display.underCursor){display.underCursor=true;display.fire("cursorOver")}updateScrollEventObject(e,NaN,e.deltaX,e.deltaY);if(jayus.fire("scroll",scrollEventObject)||display.fireOnCursor("scroll",scrollEventObject)||display.fire("scroll",scrollEventObject))e.preventDefault()});else if(jayus.ua.browser==="IE")canvas.onmousewheel=function Display_onmousewheelHandler(e){if(display.hasPendingMousemoveEvent)display.processPendingMousemove();if(!display.underCursor){display.underCursor=true;display.fire("cursorOver")}updateScrollEventObject(e,
e.wheelDelta,e.wheelDeltaX,e.wheelDeltaY);if(jayus.fire("scroll",scrollEventObject)||display.fireOnCursor("scroll",scrollEventObject)||display.fire("scroll",scrollEventObject))return false};else canvas.addEventListener("mousewheel",function Display_mousewheelHandler(e){if(display.hasPendingMousemoveEvent)display.processPendingMousemove();if(!display.underCursor){display.underCursor=true;display.fire("cursorOver")}updateScrollEventObject(e,-e.wheelDelta/120,e.wheelDeltaX/120,-e.wheelDeltaY/120);if(jayus.fire("scroll",
scrollEventObject)||display.fireOnCursor("scroll",scrollEventObject)||display.fire("scroll",scrollEventObject))e.preventDefault()})},addDefaultHandlers:function Display_addDefaultHandlers(){var display=this;jayus.addHandler("keyPress",function(e){if(display.underCursor&&e.key==="grave"){var i,target,targets=display.getChildrenUnderCursor();if(targets.length===0)targets.push(display);for(i=0;i<targets.length;i++){target=targets[i];if(e.event.shiftKey)if(target.exposingAll)target.exposeAll();else target.unexposeAll();
else if(target.debugRenderer===null)target.expose();else target.unexpose()}}})},startCursorUpdate:function Display_startCursorUpdate(){var acceptor;if(this.underCursor&&this.propagateCursor){this.updateCursorOnChildren(this.cursor.x,this.cursor.y);acceptor=this.findCursorAcceptor();this.cursorFocus=acceptor;if(jayus.cursorFocus!==acceptor)if(jayus.cursorFocus===null||jayus.cursorFocus.canReleaseCursor){if(jayus.cursorFocus!==null)jayus.cursorFocus.fire("cursorLeave");if(acceptor!==null)acceptor.fire("cursorEnter");
jayus.cursorFocus=acceptor}}},getTopCanvas:function Display_getTopCanvas(){return this.hasOverlay?this.overlayCanvas:this.canvas},showDamage:false,hasOverlay:false,overlayCanvas:null,overlayContext:null,overlayFadeAnimator:null,initOverlay:function Display_initOverlay(){if(this.showDamage&&!this.hasOverlay){var canvas=document.createElement("canvas");canvas.width=this.width;canvas.height=this.height;canvas.style.position="absolute";canvas.style.left=this.canvas.offsetLeft;canvas.style.top=this.canvas.offsetTop;
canvas.style.opacity="0.5";this.overlayCanvas=canvas;this.overlayContext=canvas.getContext("2d");this.overlayContext.lineWidth=4;this.canvas.parentElement.appendChild(this.overlayCanvas);this.hasOverlay=true;this.hookCursorListeners(canvas);this.overlayFadeAnimator=(new jayus.Animator(function update(pos){canvas.style.opacity=0.5-0.5*pos})).setDuration(500)}},clearDamage:function Display_clearDamage(){if(this.showDamage){this.initOverlay();var ctx=this.overlayContext;ctx.clearRect(0,0,this.width,
this.height)}},paintDamage:function Display_paintDamage(rect){this.paintOverlayRect(rect,"red")},paintRedraw:function Display_paintRedraw(rect){this.paintOverlayRect(rect,"yellow")},paintOverlayRect:function Display_paintOverlayRect(rect,color){if(this.showDamage){this.initOverlay();var ctx=this.overlayContext;ctx.fillStyle=color;ctx.fillRect(rect.x,rect.y,rect.width,rect.height);this.overlayCanvas.style.opacity="0.5";this.overlayFadeAnimator.start()}},setVisible:function Display_setVisible(on){jayus.debug.match("Display.setVisible",
on,"on",1);this.visible=on;if(on)this.canvas.style.visibility="";else this.canvas.style.visibility="hidden";return this},setAlpha:function Display_setAlpha(alpha){jayus.debug.match("Display.setAlpha",alpha,"alpha",4);if(this.actionsToAnimate){this.actionsToAnimate--;return new jayus.MethodAnimator(this,this.setAlpha,this.alpha,alpha)}if(this.alpha!==alpha){this.alpha=alpha;this.canvas.style.opacity=alpha}return this},setInto:function Display_setInto(element){element.style.position="relative";if(this.visible)element.appendChild(this.canvas);
return this},focus:function Display_focus(){this.canvas.focus();return this},blur:function Display_blur(){this.canvas.blur();return this},isFullScreen:function Display_isFullScreen(){return(document.fullscreenEnabled||document.mozFullScreenEnabled||document.webkitFullScreenEnabled)&&this.canvas===(document.fullscreenElement||document.mozFullScreenElement||document.webkitFullScreenElement)},requestFullScreen:function Display_requestFullScreen(){var canvas=this.canvas;if(canvas.requestFullScreen)canvas.requestFullScreen();
else if(canvas.mozRequestFullScreen)canvas.mozRequestFullScreen();else if(canvas.webkitRequestFullScreen)canvas.webkitRequestFullScreen();return this.isFullScreen()},cancelFullScreen:function Display_cancelFullScreen(){if(document.cancelFullScreen)document.cancelFullScreen();else if(document.mozCancelFullScreen)document.mozCancelFullScreen();else if(document.webkitCancelFullScreen)document.webkitCancelFullScreen();return this},getCursor:function Display_getCursor(){return this.customIcon?this.customCursor:
this.getTopCanvas().style.cursor},setCursor:function Display_setCursor(cursor){if(typeof cursor==="string"){jayus.debug.match("Display.setCursor",cursor,"cursor",2);this.getTopCanvas().style.cursor=cursor;this.hasCustomCursor=false}else{jayus.debug.match("Display.setCursor",cursor,"cursor",12);this.getTopCanvas().style.cursor="none";this.hasCustomCursor=true;this.customCursor=cursor}return this},resetCursor:function Display_resetCursor(){this.getTopCanvas().style.cursor="";this.hasCustomCursor=false;
this.customCursor=null}});jayus.debug.className="Frame";
jayus.Frame=jayus.RectEntity.extend(jayus.applyObject({brush:null,hasBrush:false,marginLeft:6,marginRight:6,marginTop:6,marginBottom:6,updateCursorOnChildren:function Frame_updateCursorOnChildren(x,y){if(this.propagateCursor){var pos=this.parentToLocal(x,y);x=pos.x;y=pos.y;this.localX=x;this.localY=y;this.child.updateCursor(x-this.marginLeft,y-this.marginTop)}},init:function Frame_init(child){jayus.debug.match("Frame.init",child,"child",12);jayus.chart.tallyInit(12);jayus.Entity.prototype.init.apply(this);
this.setChild(child)},setChild:function Frame_setChild(child){jayus.Wrapper.setChild.call(this,child);this.changeSize(child.width+this.marginLeft+this.marginRight,child.height+this.marginTop+this.marginBottom);return this},setBrush:function Frame_setBrush(brush){jayus.debug.match("Frame.setBrush",brush,"brush",5);if(this.hasBrush)this.brush.detach(this);if(!(brush instanceof jayus.Brush))brush=new jayus.Brush(brush);this.brush=brush;this.brush.attach(this);this.hasBrush=true;return this.dirty(16)},
clearBrush:function Frame_clearBrush(){if(this.hasBrush){this.brush.detach(this);this.brush=null;this.hasBrush=false;this.dirty(16)}return this},hasFlexibleWidth:function Frame_hasFlexibleWidth(){return this.child.hasFlexibleWidth()},hasFlexibleHeight:function Frame_hasFlexibleHeight(){return this.child.hasFlexibleHeight()},childSizeChanged:function Frame_childSizeChanged(child){this.width=this.child.width+this.marginLeft+this.marginRight;this.height=this.child.height+this.marginTop+this.marginBottom;
this.fire("resized");if(this.hasParent)this.parent.childSizeChanged(this)},formContents:function Frame_formContents(width,height){this.child.frozen--;this.child.setOrigin(this.marginLeft,this.marginTop);this.child.changeSize(width-this.marginLeft-this.marginRight,height-this.marginTop-this.marginBottom);this.child.frozen++},setMargin:function Frame_setMargin(left,right,top,bottom){if(arguments.length===1){jayus.debug.match("Frame.setMargin",left,"margin",4);bottom=top=right=left}else jayus.debug.matchArgumentsAs("Frame.setMargin",
arguments,4,"left","right","top","bottom");this.marginLeft=left;this.marginRight=right;this.marginTop=top;this.marginBottom=bottom;this.child.frozen++;if(this.child.hasFlexibleWidth())this.child.setWidth(this.width-this.marginLeft-this.marginRight);else this.changeSize(this.child.width+left+right,this.child.height);if(this.child.hasFlexibleHeight())this.child.setHeight(this.height-this.marginTop-this.marginBottom);else this.changeSize(this.child.width,this.child.height+top+bottom);this.child.frozen--;
return this},setMarginLeft:function Frame_setMarginLeft(margin){jayus.debug.match("Frame.setMarginLeft",margin,"margin",4);return this.setMargin(margin,this.marginRight,this.marginTop,this.marginBottom)},setMarginRight:function Frame_setMarginRight(margin){jayus.debug.match("Frame.setMarginRight",margin,"margin",4);return this.setMargin(this.marginLeft,margin,this.marginTop,this.marginBottom)},setMarginTop:function Frame_setMarginTop(margin){jayus.debug.match("Frame.setMarginTop",margin,"margin",
4);return this.setMargin(this.marginLeft,this.marginRight,margin,this.marginBottom)},setMarginBottom:function Frame_setMarginBottom(margin){jayus.debug.match("Frame.setMarginBottom",margin,"margin",4);return this.setMargin(this.marginLeft,this.marginRight,this.marginTop,margin)},paintContents:function Frame_paintContents(ctx){jayus.debug.matchContext("Frame.paintContents",ctx);if(this.hasBrush)if(this.brush.fill||this.brush.stroking){ctx.save();this.brush.applyTo(ctx);ctx.beginPath();ctx.rect(0,0,
this.width,this.height);if(this.brush.stroking&&this.brush.strokeFirst)ctx.stroke();if(this.brush.filling)ctx.fill();if(this.brush.stroking&&!this.brush.strokeFirst)ctx.stroke();ctx.restore()}ctx.save();this.child.drawOntoContext(ctx);this.child.dirtied=false;ctx.restore()}},jayus.copyObject(jayus.Wrapper)));jayus.debug.className="EditableFrame";
jayus.EditableFrame=jayus.Frame.extend({minW:20,minH:20,maxW:Infinity,maxH:Infinity,enabledHandles:{nw:1,n:1,ne:1,e:1,se:1,s:1,sw:1,w:1},cornerThreshold:6,edgeThreshold:5,state:"",display:null,init:function EditableFrame_init(child){jayus.debug.match("Frame.init",child,"child",12);jayus.Entity.prototype.init.apply(this);this.setChild(child);this.initHandlers()},initHandlers:function EditableFrame_initHandlers(){this.addHandler("cursorMove",function(e){if(!this.dragging){this.state="";this.display=
e.display;var cursor=e.display.cursor,varWidth=this.child.hasFlexibleWidth(),varHeight=this.child.hasFlexibleHeight();if(varWidth&&varHeight)if(this.enabledHandles.nw&&jayus.distance(this.getPosAt(0,0),cursor)<this.cornerThreshold)this.state="nw";else if(this.enabledHandles.ne&&jayus.distance(this.getPosAt(1,0),cursor)<this.cornerThreshold)this.state="ne";else if(this.enabledHandles.sw&&jayus.distance(this.getPosAt(0,1),cursor)<this.cornerThreshold)this.state="sw";else if(this.enabledHandles.se&&
jayus.distance(this.getPosAt(1,1),cursor)<this.cornerThreshold)this.state="se";if(this.state===""&&varWidth)if(this.enabledHandles.w&&Math.abs(this.x-e.x)<this.edgeThreshold)this.state="w";else if(this.enabledHandles.e&&Math.abs(this.x+this.width-e.x)<this.edgeThreshold)this.state="e";if(this.state===""&&varHeight)if(this.enabledHandles.n&&Math.abs(this.y-e.y)<this.edgeThreshold)this.state="n";else if(this.enabledHandles.s&&Math.abs(this.y+this.height-e.y)<this.edgeThreshold)this.state="s";if(this.state!==
"")this.display.setCursor(this.state+"-resize");else this.display.resetCursor()}});this.addHandler("cursorOut",function(e){if(!this.dragging){this.display.resetCursor();this.state=""}});this.addHandler("leftPress",function(e){this.dragging=true;if(this.state===""){this.display.setCursor("move");this.fire("dragStart")}else if(this.state==="nw")this.start=this.getPosAt(1,1);else if(this.state==="n"||this.state==="e"||this.state==="ne")this.start=this.getPosAt(0,1);else if(this.state==="sw"||this.state===
"w")this.start=this.getPosAt(1,0);else if(this.state==="s"||this.state==="se")this.start=this.getPosAt(0,0);var that=this;jayus.interceptNextEvent("leftRelease",function(e){this.dragging=false;if(this.state===""){this.fire("dragEnd");this.display.resetCursor()}},{context:this});var dragHandler=function(e){if(that.dragging){if(that.state==="")that.translate(e.deltaX,e.deltaY);else{var width=null,height=null,anchorX=0,anchorY=0;if(that.state==="nw"){anchorX=1;anchorY=1;width=that.start.x-e.x;height=
that.start.y-e.y}else if(that.state==="n"){anchorY=1;height=that.start.y-e.y}else if(that.state==="ne"){anchorY=1;width=e.x-that.start.x;height=that.start.y-e.y}else if(that.state==="sw"){anchorX=1;width=that.start.x-e.x;height=e.y-that.start.y}else if(that.state==="s")height=e.y-that.start.y;else if(that.state==="se"){width=e.x-that.start.x;height=e.y-that.start.y}else if(that.state==="e")width=e.x-that.start.x;else if(that.state==="w"){anchorX=1;width=that.start.x-e.x}var pos=that.getPosAt(anchorX,
anchorY);if(width!==null)if(width<that.minW+that.marginLeft+that.marginRight)width=that.minW+that.marginLeft+that.marginRight;else if(width>that.maxW+that.marginLeft+that.marginRight)width=that.maxW+that.marginLeft+that.marginRight;if(height!==null)if(height<that.minH+that.marginTop+that.marginBottom)height=that.minH+that.marginTop+that.marginBottom;else if(height>that.maxH+that.marginTop+that.marginBottom)height=that.maxH+that.marginTop+that.marginBottom;if(width===null)width=that.width;if(height===
null)height=that.height;that.changeSize(width,height);that.setPosAt(anchorX,anchorY,pos)}that.display.interceptNextEvent("cursorMove",dragHandler);return true}};e.display.interceptNextEvent("cursorMove",dragHandler);return true})},setMinimumSize:function EditableFrame_setMinimumSize(width,height){jayus.debug.matchArgumentsAs("EditableFrame.setMinimumSize",arguments,4,"width","height");this.minW=width;this.minH=height;return this}});jayus.debug.className="FlowLayout";
jayus.FlowLayout=jayus.RectEntity.extend({alignment:0,width:100,height:100,init:function FlowLayout_init(){jayus.Entity.prototype.init.apply(this);this.children=new jayus.List(this);this.children.typeId=12},hasFlexibleWidth:function Scene_hasFlexibleWidth(){return true},hasFlexibleHeight:function Scene_hasFlexibleHeight(){return false},componentDirtied:function Box_componentDirtied(component,componentType,type){if(type===4)this.reform();else this.dirty(16)},listItemAdded:function FlowLayout_listItemAdded(list,item){item.setParent(this);
this.reform()},listItemsAdded:function FlowLayout_listItemsAdded(list,items){for(var i=0;i<items.length;i++)items[i].setParent(this);this.reform()},listItemRemoved:function FlowLayout_listItemRemoved(list,item){item.removeParent();this.reform()},listItemsRemoved:function FlowLayout_listItemsRemoved(list,items){for(var i=0;i<items.length;i++)items[i].removeParent();this.reform()},setAlignment:function FlowLayout_setAlignment(alignment){jayus.debug.match("FlowLayout.setAlignment",alignment,"alignment",
4);if(this.alignment!==alignment){this.alignment=alignment;this.reform()}return this},getAlignment:function FlowLayout_getAlignment(){return this.alignment},reform:function FlowLayout_reform(){this.formContents(this.width,this.height);this.dirty(4)},formContents:function FlowLayout_formContents(width,height){if(width===this.width&&height>this.height)return;var i=0,j,y=0,currentLine,currentLineWidth,h,x,item,nextItem,nextItemWidth,lineHeights=[];while(i!==this.children.items.length){currentLine=[];
currentLineWidth=0;h=0;x=0;nextItem=this.children.items[i];nextItemWidth=nextItem.width;do{nextItem.x=x;nextItem.y=y;currentLine.push(nextItem);currentLineWidth+=nextItemWidth;x+=nextItemWidth;if(nextItem.height>h)h=nextItem.height;i++;if(i===this.children.items.length)break;nextItem=this.children.items[i];nextItemWidth=nextItem.width}while(currentLineWidth+nextItemWidth<width);if(this.alignment!==0)for(j=0;j<currentLine.length;j++){item=currentLine[j];item.x+=(width-currentLineWidth)*this.alignment}for(j=
0;j<currentLine.length;j++){item=currentLine[j];if(typeof item.verticalAlign==="number")item.y=item.y+item.verticalAlign*(h-item.height)}y+=h;lineHeights.push(h)}for(i=0;i<this.children.items.length;i++){item=this.children.items[i];item.fire("moved")}this.lineHeights=lineHeights},paintContents:jayus.Scene.prototype.paintContents});jayus.applyObject(jayus.Group,jayus.FlowLayout.prototype);jayus.debug.className="Stack";
jayus.Stack=jayus.RectEntity.extend({spacing:8,reversed:false,isParent:true,listItemAdded:function Stack_listItemAdded(list,item){this.formSelf()},listItemRemoved:function Stack_listItemRemoved(list,item){this.formSelf()},listItemsAdded:function Stack_listItemsAdded(list,items){for(var i=0;i<items.length;i++)this.listItemAdded(list,items[i])},listItemsRemoved:function Stack_listItemsRemoved(list,items){for(var i=0;i<items.length;i++)this.listItemRemoved(list,items[i])},childDirtied:function Stack_childDirtied(){this.dirty()},
childMoved:function Stack_childMoved(){this.dirty()},childSizeChanged:function Stack_childSizeChanged(){this.formSelf()},init:function Stack_init(){jayus.Entity.prototype.init.apply(this,arguments);this.children=new jayus.List(this);this.children.typeId=12},hasFlexibleWidth:function Stack_hasFlexibleWidth(){return false},hasFlexibleHeight:function Stack_hasFlexibleHeight(){return false},setReversed:function Stack_setReversed(on){jayus.debug.match("Stack.setReversed",on,"on",1);if(this.reversed!==
on){this.reversed=on;this.formSelf()}return this},setSpacing:function Stack_setSpacing(spacing){jayus.debug.match("Stack.setSpacing",spacing,"spacing",4);if(this.spacing!==spacing){this.spacing=spacing;this.formSelf()}return this},findGreatestMinimalChildWidth:function Stack_findGreatestMinimalChildWidth(){var i,width=0;for(i=0;i<this.children.items.length;i++)width=Math.max(width,this.children.items[i].minW);return width},findGreatestMinimalChildHeight:function Stack_findGreatestMinimalChildHeight(){var i,
height=0;for(i=0;i<this.children.items.length;i++)height=Math.max(height,this.children.items[i].minH);return height},reform:function Stack_reform(){this.formSelf(this.width,this.height)},paintContents:jayus.Scene.prototype.paintContents});jayus.applyObject(jayus.Group,jayus.Stack.prototype);
jayus.hStack=jayus.Stack.extend({automaticHeight:true,formSelf:function hStack_formSelf(){var w=0,h=0,newH,i,item;if(this.reversed)for(i=this.children.items.length-1;i>=0;i--){item=this.children.items[i];item.setX(w);w+=item.width+this.spacing;if(this.automaticHeight){newH=item.height;if(newH>h)h=newH}}else for(i=0;i<this.children.items.length;i++){item=this.children.items[i];item.setX(w);w+=item.width+this.spacing;if(this.automaticHeight){newH=item.height;if(newH>h)h=newH}}var width=w-this.spacing,
heigth=this.height;if(this.automaticHeight)height=h;this.changeSize(width,height)}});
jayus.vStack=jayus.Stack.extend({automaticWidth:true,getAutomaticWidth:function vStack_getAutomaticWidth(){return this.automaticWidth},setAutomaticWidth:function vStack_setAutomaticWidth(on){jayus.debug.match("vStack.setAutomaticWidth",on,"on",1);if(this.automaticWidth!==on){this.automaticWidth=on;this.reform()}return this},formSelf:function vStack_formSelf(){var h=0,w=0;for(var i=0;i<this.children.items.length;i++){var item=this.children.items[i];item.frozen++;item.setY(h);item.frozen--;h+=item.height+
this.spacing;if(this.automaticWidth){var newW=item.width;if(newW>w)w=newW}}var height=h-this.spacing,width=this.width;if(this.automaticWidth)width=w;this.changeSize(width,height)}});jayus.debug.className="Box";
jayus.Box=jayus.RectEntity.extend({width:100,height:100,spacing:8,reversed:false,isParent:true,init:function Box_init(){jayus.Entity.prototype.init.apply(this,arguments);this.children=new jayus.List(this);this.children.typeId=12},componentDirtied:function Box_componentDirtied(component,componentType,type){if(type===4)this.reform();else this.dirty(16)},listItemAdded:function Box_listItemAdded(list,item){item.setParent(this);this.reform()},listItemsAdded:function Box_listItemsAdded(list,items){for(var i=
0;i<items.length;i++)items[i].setParent(this);this.reform()},listItemRemoved:function Box_listItemRemoved(list,item){item.removeParent();this.reform()},listItemsRemoved:function Box_listItemsRemoved(list,items){for(var i=0;i<items.length;i++)items[i].removeParent();this.reform()},reform:function Box_reform(){this.formContents(this.width,this.height);this.dirty(4)},setReversed:function Box_setReversed(on){jayus.debug.match("Box.setReversed",on,"on",1);if(this.reversed!==on){this.reversed=on;this.reform()}return this},
setSpacing:function Box_setSpacing(spacing){jayus.debug.match("Box.setSpacing",spacing,"spacing",4);if(this.spacing!==spacing){this.spacing=spacing;this.reform()}return this},findGreatestMinimalChildWidth:function Box_findGreatestMinimalChildWidth(){var width=0;for(var i=0;i<this.children.items.length;i++)width=Math.max(width,this.children.items[i].minW);return width},findGreatestMinimalChildHeight:function Box_findGreatestMinimalChildHeight(){var height=0;for(var i=0;i<this.children.items.length;i++)height=
Math.max(height,this.children.items[i].minH);return height},paintContents:jayus.Scene.prototype.paintContents});jayus.applyObject(jayus.Group,jayus.Box.prototype);jayus.debug.className="hBox";
jayus.hBox=jayus.Box.extend({hasFlexibleWidth:function hBox_hasFlexibleWidth(){if(!this.children.items.length)return true;var i,item;for(i=0;i<this.children.items.length;i++){item=this.children.items[i];if(item.hasFlexibleWidth())return true}return false},hasFlexibleHeight:function hBox_hasFlexibleHeight(){return true},formContents:function hBox_formContents(width,height){var i,item,x=0,space=width-(this.children.items.length-1)*this.spacing,totalWeight=0,totalFixedSize=0,itemWidth,itemHeight;for(i=
0;i<this.children.items.length;i++){item=this.children.items[i];if(typeof item.policy!=="object")item.policy=new jayus.SizePolicy;if(item.hasFlexibleWidth()){totalFixedSize+=item.policy.size;if(item.policy.expand)totalWeight+=item.policy.weight}else totalFixedSize+=item.width}var extraSpace=space-totalFixedSize;for(i=0;i<this.children.items.length;i++){item=this.children.items[i];if(item.hasFlexibleHeight())itemHeight=height;else itemHeight=item.height;if(item.hasFlexibleWidth())if(item.policy.expand)itemWidth=
item.policy.size+extraSpace*(item.policy.weight/totalWeight);else itemWidth=item.policy.size;else itemWidth=item.width;item.x=x;x+=itemWidth+this.spacing;item.frozen--;item.changeSize(itemWidth,itemHeight);item.frozen++}}});jayus.debug.className="vBox";
jayus.vBox=jayus.Box.extend({hasFlexibleWidth:function vBox_hasFlexibleWidth(){return true},hasFlexibleHeight:function vBox_hasFlexibleHeight(){if(!this.children.items.length)return true;var i,item;for(i=0;i<this.children.items.length;i++){item=this.children.items[i];if(item.hasFlexibleHeight())return true}return false},formContents:function vBox_formContents(width,height){var i,item,y=0,space=height-(this.children.items.length-1)*this.spacing,totalWeight=0,totalFixedSize=0,itemWidth,itemHeight;for(i=
0;i<this.children.items.length;i++){item=this.children.items[i];if(typeof item.policy!=="object")item.policy=new jayus.SizePolicy;if(item.hasFlexibleHeight()){totalFixedSize+=item.policy.size;if(item.policy.expand)totalWeight+=item.policy.weight}else totalFixedSize+=item.height}var extraSpace=space-totalFixedSize;for(i=0;i<this.children.items.length;i++){item=this.children.items[i];if(item.hasFlexibleWidth())itemWidth=width;else itemWidth=item.width;if(item.hasFlexibleHeight())if(item.policy.expand)itemHeight=
item.policy.size+extraSpace*(item.policy.weight/totalWeight);else itemHeight=item.policy.size;else itemHeight=item.height;item.y=y;y+=itemHeight+this.spacing;item.frozen--;item.changeSize(itemWidth,itemHeight);item.frozen++}}});jayus.debug.className="TiledMap";
jayus.TiledMap=jayus.RectEntity.extend({loaded:false,filename:null,map:null,tileWidth:0,tileHeight:0,init:function TiledMap_init(map){jayus.Entity.prototype.init.apply(this);if(arguments.length)this.setMap(map)},checkLoaded:function TiledMap_checkLoaded(){if(!this.loaded)throw new Error("TiledMap.checkLoaded() - Error, map not yet loaded");},setMap:overloadArgumentType({object:function TiledMap_setMap(map){this.map=map;this.loaded=true},string:function TiledMap_setMap(filepath){this.map=jayus.objects.get(filepath);
for(var i=0;i<this.map.tilesets.length;i++){var data=this.map.tilesets[i];jayus.images.load(data.image);var sheet=new jayus.SpriteSheet;sheet.setSpriteSize(data.tilewidth,data.tileheight);jayus.images.get(data.image).sheet=sheet;this.tileWidth=data.tilewidth;this.tileHeight=data.tileheight}this.loaded=true;this.changeSize(this.map.width*this.map.tilewidth,this.map.height*this.map.tileheight)}}),getTileAt:function TiledMap_getTileAt(x,y){jayus.debug.matchCoordinate("TiledMap.getTileAt",x,y);if(arguments.length===
1){y=x.y;x=x.x}x-=this.x;y-=this.y;return new jayus.Point(Math.floor(x/this.map.tilewidth),Math.floor(y/this.map.tileheight))},getSlotFrame:function TiledMap_getSlotFrame(x,y){jayus.debug.matchCoordinate("TiledMap.getSlotFrame",x,y);this.checkLoaded();if(arguments.length===1){y=x.y;x=x.x}return new jayus.Rectangle(this.x+x*this.map.tilewidth,this.y+y*this.map.tileheight,this.map.tilewidth,this.map.tileheight)},isLayerVisible:function TiledMap_isLayerVisible(index){jayus.debug.match("TiledMap.isLayerVisible",
index,"index",4);this.checkLoaded();return this.map.layers[index].visible},setLayerVisibility:function TiledMap_setLayerVisibility(index,visible){jayus.debug.matchArguments("TiledMap.setLayerVisibility",arguments,"index",4,"visible",1);this.checkLoaded();var layer=this.map.layers[index];if(layer.visible!==visible){layer.visible=visible;this.dirty()}return this},showLayer:function TiledMap_showLayer(index){jayus.debug.match("TiledMap.showLayer",index,"index",4);this.checkLoaded();return this.setLayerVisibility(index,
true)},hideLayer:function TiledMap_hideLayer(index){jayus.debug.match("TiledMap.hideLayer",index,"index",4);this.checkLoaded();return this.setLayerVisibility(index,false)},paintContents:function TiledMap_paintContents(ctx){jayus.debug.matchContext("TiledMap.paintContents",ctx);if(!this.loaded)console.warn("TiledMap.paintContents() - Map data not loaded!");var i,image,tileset=this.map.tilesets[0],tileSheet=jayus.images.get(tileset.image),sheetInfo=tileSheet.sheet,tileWidth=sheetInfo.spriteWidth,tileHeight=
sheetInfo.spriteHeight,layer,tileY,tileX,index,sourceTileX,sourceTileY,x,y;for(i=0;i<this.map.tilesets.length;i++){tileset=this.map.tilesets[i];if(!jayus.images.isLoaded(tileset.image))console.warn('TiledMap.paintContents() - Tileset "'+tileset.image+'" not yet loaded')}for(i=0;i<this.map.layers.length;i++){layer=this.map.layers[i];if(layer.type==="tilelayer"&&layer.visible)for(tileY=0;tileY<layer.height;tileY++)for(tileX=0;tileX<layer.width;tileX++){index=layer.data[tileY*layer.width+tileX]-1;if(index!==
-1){sourceTileX=index%(tileset.imagewidth/tileset.tilewidth);sourceTileY=(index-sourceTileX)/(tileset.imagewidth/tileset.tilewidth);x=sheetInfo.marginX+sourceTileX*tileWidth;y=sheetInfo.marginY+sourceTileY*tileHeight;ctx.drawImage(tileSheet,x,y,tileWidth,tileHeight,tileX*tileWidth,tileY*tileHeight,tileWidth,tileHeight)}}}}});
